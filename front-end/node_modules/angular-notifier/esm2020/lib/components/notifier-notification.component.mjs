import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output } from '@angular/core';
import { NotifierTimerService } from '../services/notifier-timer.service';
import * as i0 from "@angular/core";
import * as i1 from "../services/notifier.service";
import * as i2 from "../services/notifier-timer.service";
import * as i3 from "../services/notifier-animation.service";
import * as i4 from "@angular/common";
/**
 * Notifier notification component
 * -------------------------------
 * This component is responsible for actually displaying the notification on screen. In addition, it's able to show and hide this
 * notification, in particular to animate this notification in and out, as well as shift (move) this notification vertically around.
 * Furthermore, the notification component handles all interactions the user has with this notification / component, such as clicks and
 * mouse movements.
 */
export class NotifierNotificationComponent {
    /**
     * Constructor
     *
     * @param elementRef               Reference to the component's element
     * @param renderer                 Angular renderer
     * @param notifierService          Notifier service
     * @param notifierTimerService     Notifier timer service
     * @param notifierAnimationService Notifier animation service
     */
    constructor(elementRef, renderer, notifierService, notifierTimerService, notifierAnimationService) {
        this.config = notifierService.getConfig();
        this.ready = new EventEmitter();
        this.dismiss = new EventEmitter();
        this.timerService = notifierTimerService;
        this.animationService = notifierAnimationService;
        this.renderer = renderer;
        this.element = elementRef.nativeElement;
        this.elementShift = 0;
    }
    /**
     * Component after view init lifecycle hook, setts up the component and then emits the ready event
     */
    ngAfterViewInit() {
        this.setup();
        this.elementHeight = this.element.offsetHeight;
        this.elementWidth = this.element.offsetWidth;
        this.ready.emit(this);
    }
    /**
     * Get the notifier config
     *
     * @returns Notifier configuration
     */
    getConfig() {
        return this.config;
    }
    /**
     * Get notification element height (in px)
     *
     * @returns Notification element height (in px)
     */
    getHeight() {
        return this.elementHeight;
    }
    /**
     * Get notification element width (in px)
     *
     * @returns Notification element height (in px)
     */
    getWidth() {
        return this.elementWidth;
    }
    /**
     * Get notification shift offset (in px)
     *
     * @returns Notification element shift offset (in px)
     */
    getShift() {
        return this.elementShift;
    }
    /**
     * Show (animate in) this notification
     *
     * @returns Promise, resolved when done
     */
    show() {
        return new Promise((resolve) => {
            // Are animations enabled?
            if (this.config.animations.enabled && this.config.animations.show.speed > 0) {
                // Get animation data
                const animationData = this.animationService.getAnimationData('show', this.notification);
                // Set initial styles (styles before animation), prevents quick flicker when animation starts
                const animatedProperties = Object.keys(animationData.keyframes[0]);
                for (let i = animatedProperties.length - 1; i >= 0; i--) {
                    this.renderer.setStyle(this.element, animatedProperties[i], animationData.keyframes[0][animatedProperties[i]]);
                }
                // Animate notification in
                this.renderer.setStyle(this.element, 'visibility', 'visible');
                const animation = this.element.animate(animationData.keyframes, animationData.options);
                animation.onfinish = () => {
                    this.startAutoHideTimer();
                    resolve(); // Done
                };
            }
            else {
                // Show notification
                this.renderer.setStyle(this.element, 'visibility', 'visible');
                this.startAutoHideTimer();
                resolve(); // Done
            }
        });
    }
    /**
     * Hide (animate out) this notification
     *
     * @returns Promise, resolved when done
     */
    hide() {
        return new Promise((resolve) => {
            this.stopAutoHideTimer();
            // Are animations enabled?
            if (this.config.animations.enabled && this.config.animations.hide.speed > 0) {
                const animationData = this.animationService.getAnimationData('hide', this.notification);
                const animation = this.element.animate(animationData.keyframes, animationData.options);
                animation.onfinish = () => {
                    resolve(); // Done
                };
            }
            else {
                resolve(); // Done
            }
        });
    }
    /**
     * Shift (move) this notification
     *
     * @param   distance         Distance to shift (in px)
     * @param   shiftToMakePlace Flag, defining in which direction to shift
     * @returns Promise, resolved when done
     */
    shift(distance, shiftToMakePlace) {
        return new Promise((resolve) => {
            // Calculate new position (position after the shift)
            let newElementShift;
            if ((this.config.position.vertical.position === 'top' && shiftToMakePlace) ||
                (this.config.position.vertical.position === 'bottom' && !shiftToMakePlace)) {
                newElementShift = this.elementShift + distance + this.config.position.vertical.gap;
            }
            else {
                newElementShift = this.elementShift - distance - this.config.position.vertical.gap;
            }
            const horizontalPosition = this.config.position.horizontal.position === 'middle' ? '-50%' : '0';
            // Are animations enabled?
            if (this.config.animations.enabled && this.config.animations.shift.speed > 0) {
                const animationData = {
                    // TODO: Extract into animation service
                    keyframes: [
                        {
                            transform: `translate3d( ${horizontalPosition}, ${this.elementShift}px, 0 )`,
                        },
                        {
                            transform: `translate3d( ${horizontalPosition}, ${newElementShift}px, 0 )`,
                        },
                    ],
                    options: {
                        duration: this.config.animations.shift.speed,
                        easing: this.config.animations.shift.easing,
                        fill: 'forwards',
                    },
                };
                this.elementShift = newElementShift;
                const animation = this.element.animate(animationData.keyframes, animationData.options);
                animation.onfinish = () => {
                    resolve(); // Done
                };
            }
            else {
                this.renderer.setStyle(this.element, 'transform', `translate3d( ${horizontalPosition}, ${newElementShift}px, 0 )`);
                this.elementShift = newElementShift;
                resolve(); // Done
            }
        });
    }
    /**
     * Handle click on dismiss button
     */
    onClickDismiss() {
        this.dismiss.emit(this.notification.id);
    }
    /**
     * Handle mouseover over notification area
     */
    onNotificationMouseover() {
        if (this.config.behaviour.onMouseover === 'pauseAutoHide') {
            this.pauseAutoHideTimer();
        }
        else if (this.config.behaviour.onMouseover === 'resetAutoHide') {
            this.stopAutoHideTimer();
        }
    }
    /**
     * Handle mouseout from notification area
     */
    onNotificationMouseout() {
        if (this.config.behaviour.onMouseover === 'pauseAutoHide') {
            this.continueAutoHideTimer();
        }
        else if (this.config.behaviour.onMouseover === 'resetAutoHide') {
            this.startAutoHideTimer();
        }
    }
    /**
     * Handle click on notification area
     */
    onNotificationClick() {
        if (this.config.behaviour.onClick === 'hide') {
            this.onClickDismiss();
        }
    }
    /**
     * Start the auto hide timer (if enabled)
     */
    startAutoHideTimer() {
        if (this.config.behaviour.autoHide !== false && this.config.behaviour.autoHide > 0) {
            this.timerService.start(this.config.behaviour.autoHide).then(() => {
                this.onClickDismiss();
            });
        }
    }
    /**
     * Pause the auto hide timer (if enabled)
     */
    pauseAutoHideTimer() {
        if (this.config.behaviour.autoHide !== false && this.config.behaviour.autoHide > 0) {
            this.timerService.pause();
        }
    }
    /**
     * Continue the auto hide timer (if enabled)
     */
    continueAutoHideTimer() {
        if (this.config.behaviour.autoHide !== false && this.config.behaviour.autoHide > 0) {
            this.timerService.continue();
        }
    }
    /**
     * Stop the auto hide timer (if enabled)
     */
    stopAutoHideTimer() {
        if (this.config.behaviour.autoHide !== false && this.config.behaviour.autoHide > 0) {
            this.timerService.stop();
        }
    }
    /**
     * Initial notification setup
     */
    setup() {
        // Set start position (initially the exact same for every new notification)
        if (this.config.position.horizontal.position === 'left') {
            this.renderer.setStyle(this.element, 'left', `${this.config.position.horizontal.distance}px`);
        }
        else if (this.config.position.horizontal.position === 'right') {
            this.renderer.setStyle(this.element, 'right', `${this.config.position.horizontal.distance}px`);
        }
        else {
            this.renderer.setStyle(this.element, 'left', '50%');
            // Let's get the GPU handle some work as well (#perfmatters)
            this.renderer.setStyle(this.element, 'transform', 'translate3d( -50%, 0, 0 )');
        }
        if (this.config.position.vertical.position === 'top') {
            this.renderer.setStyle(this.element, 'top', `${this.config.position.vertical.distance}px`);
        }
        else {
            this.renderer.setStyle(this.element, 'bottom', `${this.config.position.vertical.distance}px`);
        }
        // Add classes (responsible for visual design)
        this.renderer.addClass(this.element, `notifier__notification--${this.notification.type}`);
        this.renderer.addClass(this.element, `notifier__notification--${this.config.theme}`);
    }
}
NotifierNotificationComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.1", ngImport: i0, type: NotifierNotificationComponent, deps: [{ token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i1.NotifierService }, { token: i2.NotifierTimerService }, { token: i3.NotifierAnimationService }], target: i0.ɵɵFactoryTarget.Component });
NotifierNotificationComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.1", type: NotifierNotificationComponent, selector: "notifier-notification", inputs: { notification: "notification" }, outputs: { ready: "ready", dismiss: "dismiss" }, host: { listeners: { "click": "onNotificationClick()", "mouseout": "onNotificationMouseout()", "mouseover": "onNotificationMouseover()" }, classAttribute: "notifier__notification" }, providers: [
        // We provide the timer to the component's local injector, so that every notification components gets its own
        // instance of the timer service, thus running their timers independently from each other
        NotifierTimerService,
    ], ngImport: i0, template: "<ng-container\n  *ngIf=\"notification.template; else predefinedNotification\"\n  [ngTemplateOutlet]=\"notification.template\"\n  [ngTemplateOutletContext]=\"{ notification: notification }\"\n>\n</ng-container>\n\n<ng-template #predefinedNotification>\n  <p class=\"notifier__notification-message\">{{ notification.message }}</p>\n  <button\n    class=\"notifier__notification-button\"\n    type=\"button\"\n    title=\"dismiss\"\n    *ngIf=\"config.behaviour.showDismissButton\"\n    (click)=\"onClickDismiss()\"\n  >\n    <svg class=\"notifier__notification-button-icon\" viewBox=\"0 0 24 24\" width=\"20\" height=\"20\">\n      <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\" />\n    </svg>\n  </button>\n</ng-template>\n", dependencies: [{ kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.1", ngImport: i0, type: NotifierNotificationComponent, decorators: [{
            type: Component,
            args: [{ changeDetection: ChangeDetectionStrategy.OnPush, host: {
                        '(click)': 'onNotificationClick()',
                        '(mouseout)': 'onNotificationMouseout()',
                        '(mouseover)': 'onNotificationMouseover()',
                        class: 'notifier__notification',
                    }, providers: [
                        // We provide the timer to the component's local injector, so that every notification components gets its own
                        // instance of the timer service, thus running their timers independently from each other
                        NotifierTimerService,
                    ], selector: 'notifier-notification', template: "<ng-container\n  *ngIf=\"notification.template; else predefinedNotification\"\n  [ngTemplateOutlet]=\"notification.template\"\n  [ngTemplateOutletContext]=\"{ notification: notification }\"\n>\n</ng-container>\n\n<ng-template #predefinedNotification>\n  <p class=\"notifier__notification-message\">{{ notification.message }}</p>\n  <button\n    class=\"notifier__notification-button\"\n    type=\"button\"\n    title=\"dismiss\"\n    *ngIf=\"config.behaviour.showDismissButton\"\n    (click)=\"onClickDismiss()\"\n  >\n    <svg class=\"notifier__notification-button-icon\" viewBox=\"0 0 24 24\" width=\"20\" height=\"20\">\n      <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\" />\n    </svg>\n  </button>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i1.NotifierService }, { type: i2.NotifierTimerService }, { type: i3.NotifierAnimationService }]; }, propDecorators: { notification: [{
                type: Input
            }], ready: [{
                type: Output
            }], dismiss: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpZXItbm90aWZpY2F0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXItbm90aWZpZXIvc3JjL2xpYi9jb21wb25lbnRzL25vdGlmaWVyLW5vdGlmaWNhdGlvbi5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyLW5vdGlmaWVyL3NyYy9saWIvY29tcG9uZW50cy9ub3RpZmllci1ub3RpZmljYXRpb24uY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFpQix1QkFBdUIsRUFBRSxTQUFTLEVBQWMsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFPdEksT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7Ozs7OztBQUUxRTs7Ozs7OztHQU9HO0FBaUJILE1BQU0sT0FBTyw2QkFBNkI7SUEyRHhDOzs7Ozs7OztPQVFHO0lBQ0gsWUFDRSxVQUFzQixFQUN0QixRQUFtQixFQUNuQixlQUFnQyxFQUNoQyxvQkFBMEMsRUFDMUMsd0JBQWtEO1FBRWxELElBQUksQ0FBQyxNQUFNLEdBQUcsZUFBZSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzFDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxZQUFZLEVBQWlDLENBQUM7UUFDL0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO1FBQzFDLElBQUksQ0FBQyxZQUFZLEdBQUcsb0JBQW9CLENBQUM7UUFDekMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLHdCQUF3QixDQUFDO1FBQ2pELElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDLGFBQWEsQ0FBQztRQUN4QyxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FB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QVEsRUFBRSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDO1NBQy9GO1FBRUQsOENBQThDO1FBQzlDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsMkJBQTJCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUMxRixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLDJCQUEyQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDdkYsQ0FBQzs7MEhBbFZVLDZCQUE2Qjs4R0FBN0IsNkJBQTZCLGtVQVI3QjtRQUNULDZHQUE2RztRQUM3Ryx5RkFBeUY7UUFDekYsb0JBQW9CO0tBQ3JCLDBCQzdCSCx1eEJBcUJBOzJGRFlhLDZCQUE2QjtrQkFoQnpDLFNBQVM7c0NBQ1MsdUJBQXVCLENBQUMsTUFBTSxRQUN6Qzt3QkFDSixTQUFTLEVBQUUsdUJBQXVCO3dCQUNsQyxZQUFZLEVBQUUsMEJBQTBCO3dCQUN4QyxhQUFhLEVBQUUsMkJBQTJCO3dCQUMxQyxLQUFLLEVBQUUsd0JBQXdCO3FCQUNoQyxhQUNVO3dCQUNULDZHQUE2Rzt3QkFDN0cseUZBQXlGO3dCQUN6RixvQkFBb0I7cUJBQ3JCLFlBQ1MsdUJBQXVCO2lPQVExQixZQUFZO3NCQURsQixLQUFLO2dCQU9DLEtBQUs7c0JBRFgsTUFBTTtnQkFPQSxPQUFPO3NCQURiLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBOb3RpZmllckFuaW1hdGlvbkRhdGEgfSBmcm9tICcuLi9tb2RlbHMvbm90aWZpZXItYW5pbWF0aW9uLm1vZGVsJztcbmltcG9ydCB7IE5vdGlmaWVyQ29uZmlnIH0gZnJvbSAnLi4vbW9kZWxzL25vdGlmaWVyLWNvbmZpZy5tb2RlbCc7XG5pbXBvcnQgeyBOb3RpZmllck5vdGlmaWNhdGlvbiB9IGZyb20gJy4uL21vZGVscy9ub3RpZmllci1ub3RpZmljYXRpb24ubW9kZWwnO1xuaW1wb3J0IHsgTm90aWZpZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvbm90aWZpZXIuc2VydmljZSc7XG5pbXBvcnQgeyBOb3RpZmllckFuaW1hdGlvblNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9ub3RpZmllci1hbmltYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBOb3RpZmllclRpbWVyU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL25vdGlmaWVyLXRpbWVyLnNlcnZpY2UnO1xuXG4vKipcbiAqIE5vdGlmaWVyIG5vdGlmaWNhdGlvbiBjb21wb25lbnRcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIFRoaXMgY29tcG9uZW50IGlzIHJlc3BvbnNpYmxlIGZvciBhY3R1YWxseSBkaXNwbGF5aW5nIHRoZSBub3RpZmljYXRpb24gb24gc2NyZWVuLiBJbiBhZGRpdGlvbiwgaXQncyBhYmxlIHRvIHNob3cgYW5kIGhpZGUgdGhpc1xuICogbm90aWZpY2F0aW9uLCBpbiBwYXJ0aWN1bGFyIHRvIGFuaW1hdGUgdGhpcyBub3RpZmljYXRpb24gaW4gYW5kIG91dCwgYXMgd2VsbCBhcyBzaGlmdCAobW92ZSkgdGhpcyBub3RpZmljYXRpb24gdmVydGljYWxseSBhcm91bmQuXG4gKiBGdXJ0aGVybW9yZSwgdGhlIG5vdGlmaWNhdGlvbiBjb21wb25lbnQgaGFuZGxlcyBhbGwgaW50ZXJhY3Rpb25zIHRoZSB1c2VyIGhhcyB3aXRoIHRoaXMgbm90aWZpY2F0aW9uIC8gY29tcG9uZW50LCBzdWNoIGFzIGNsaWNrcyBhbmRcbiAqIG1vdXNlIG1vdmVtZW50cy5cbiAqL1xuQENvbXBvbmVudCh7XG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLCAvLyAoI3BlcmZtYXR0ZXJzKVxuICBob3N0OiB7XG4gICAgJyhjbGljayknOiAnb25Ob3RpZmljYXRpb25DbGljaygpJyxcbiAgICAnKG1vdXNlb3V0KSc6ICdvbk5vdGlmaWNhdGlvbk1vdXNlb3V0KCknLFxuICAgICcobW91c2VvdmVyKSc6ICdvbk5vdGlmaWNhdGlvbk1vdXNlb3ZlcigpJyxcbiAgICBjbGFzczogJ25vdGlmaWVyX19ub3RpZmljYXRpb24nLFxuICB9LFxuICBwcm92aWRlcnM6IFtcbiAgICAvLyBXZSBwcm92aWRlIHRoZSB0aW1lciB0byB0aGUgY29tcG9uZW50J3MgbG9jYWwgaW5qZWN0b3IsIHNvIHRoYXQgZXZlcnkgbm90aWZpY2F0aW9uIGNvbXBvbmVudHMgZ2V0cyBpdHMgb3duXG4gICAgLy8gaW5zdGFuY2Ugb2YgdGhlIHRpbWVyIHNlcnZpY2UsIHRodXMgcnVubmluZyB0aGVpciB0aW1lcnMgaW5kZXBlbmRlbnRseSBmcm9tIGVhY2ggb3RoZXJcbiAgICBOb3RpZmllclRpbWVyU2VydmljZSxcbiAgXSxcbiAgc2VsZWN0b3I6ICdub3RpZmllci1ub3RpZmljYXRpb24nLFxuICB0ZW1wbGF0ZVVybDogJy4vbm90aWZpZXItbm90aWZpY2F0aW9uLmNvbXBvbmVudC5odG1sJyxcbn0pXG5leHBvcnQgY2xhc3MgTm90aWZpZXJOb3RpZmljYXRpb25Db21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcbiAgLyoqXG4gICAqIElucHV0OiBOb3RpZmljYXRpb24gb2JqZWN0LCBjb250YWlucyBhbGwgZGV0YWlscyBuZWNlc3NhcnkgdG8gY29uc3RydWN0IHRoZSBub3RpZmljYXRpb25cbiAgICovXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBub3RpZmljYXRpb246IE5vdGlmaWVyTm90aWZpY2F0aW9uO1xuXG4gIC8qKlxuICAgKiBPdXRwdXQ6IFJlYWR5IGV2ZW50LCBoYW5kbGVzIHRoZSBpbml0aWFsaXphdGlvbiBzdWNjZXNzIGJ5IGVtaXR0aW5nIGEgcmVmZXJlbmNlIHRvIHRoaXMgbm90aWZpY2F0aW9uIGNvbXBvbmVudFxuICAgKi9cbiAgQE91dHB1dCgpXG4gIHB1YmxpYyByZWFkeTogRXZlbnRFbWl0dGVyPE5vdGlmaWVyTm90aWZpY2F0aW9uQ29tcG9uZW50PjtcblxuICAvKipcbiAgICogT3V0cHV0OiBEaXNtaXNzIGV2ZW50LCBoYW5kbGVzIHRoZSBjbGljayBvbiB0aGUgZGlzbWlzcyBidXR0b24gYnkgZW1pdHRpbmcgdGhlIG5vdGlmaWNhdGlvbiBJRCBvZiB0aGlzIG5vdGlmaWNhdGlvbiBjb21wb25lbnRcbiAgICovXG4gIEBPdXRwdXQoKVxuICBwdWJsaWMgZGlzbWlzczogRXZlbnRFbWl0dGVyPHN0cmluZz47XG5cbiAgLyoqXG4gICAqIE5vdGlmaWVyIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjb25maWc6IE5vdGlmaWVyQ29uZmlnO1xuXG4gIC8qKlxuICAgKiBOb3RpZmllciB0aW1lciBzZXJ2aWNlXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IHRpbWVyU2VydmljZTogTm90aWZpZXJUaW1lclNlcnZpY2U7XG5cbiAgLyoqXG4gICAqIE5vdGlmaWVyIGFuaW1hdGlvbiBzZXJ2aWNlXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGFuaW1hdGlvblNlcnZpY2U6IE5vdGlmaWVyQW5pbWF0aW9uU2VydmljZTtcblxuICAvKipcbiAgICogQW5ndWxhciByZW5kZXJlciwgdXNlZCB0byBwcmVzZXJ2ZSB0aGUgb3ZlcmFsbCBET00gYWJzdHJhY3Rpb24gJiBpbmRlcGVuZGVuY2VcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgcmVuZGVyZXI6IFJlbmRlcmVyMjtcblxuICAvKipcbiAgICogTmF0aXZlIGVsZW1lbnQgcmVmZXJlbmNlLCB1c2VkIGZvciBtYW5pcHVsYXRpbmcgRE9NIHByb3BlcnRpZXNcbiAgICovXG4gIHByaXZhdGUgcmVhZG9ubHkgZWxlbWVudDogSFRNTEVsZW1lbnQ7XG5cbiAgLyoqXG4gICAqIEN1cnJlbnQgbm90aWZpY2F0aW9uIGhlaWdodCwgY2FsY3VsYXRlZCBhbmQgY2FjaGVkIGhlcmUgKCNwZXJmbWF0dGVycylcbiAgICovXG4gIHByaXZhdGUgZWxlbWVudEhlaWdodDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBDdXJyZW50IG5vdGlmaWNhdGlvbiB3aWR0aCwgY2FsY3VsYXRlZCBhbmQgY2FjaGVkIGhlcmUgKCNwZXJmbWF0dGVycylcbiAgICovXG4gIHByaXZhdGUgZWxlbWVudFdpZHRoOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIEN1cnJlbnQgbm90aWZpY2F0aW9uIHNoaWZ0LCBjYWxjdWxhdGVkIGFuZCBjYWNoZWQgaGVyZSAoI3BlcmZtYXR0ZXJzKVxuICAgKi9cbiAgcHJpdmF0ZSBlbGVtZW50U2hpZnQ6IG51bWJlcjtcblxuICAvKipcbiAgICogQ29uc3RydWN0b3JcbiAgICpcbiAgICogQHBhcmFtIGVsZW1lbnRSZWYgICAgICAgICAgICAgICBSZWZlcmVuY2UgdG8gdGhlIGNvbXBvbmVudCdzIGVsZW1lbnRcbiAgICogQHBhcmFtIHJlbmRlcmVyICAgICAgICAgICAgICAgICBBbmd1bGFyIHJlbmRlcmVyXG4gICAqIEBwYXJhbSBub3RpZmllclNlcnZpY2UgICAgICAgICAgTm90aWZpZXIgc2VydmljZVxuICAgKiBAcGFyYW0gbm90aWZpZXJUaW1lclNlcnZpY2UgICAgIE5vdGlmaWVyIHRpbWVyIHNlcnZpY2VcbiAgICogQHBhcmFtIG5vdGlmaWVyQW5pbWF0aW9uU2VydmljZSBOb3RpZmllciBhbmltYXRpb24gc2VydmljZVxuICAgKi9cbiAgcHVibGljIGNvbnN0cnVjdG9yKFxuICAgIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBub3RpZmllclNlcnZpY2U6IE5vdGlmaWVyU2VydmljZSxcbiAgICBub3RpZmllclRpbWVyU2VydmljZTogTm90aWZpZXJUaW1lclNlcnZpY2UsXG4gICAgbm90aWZpZXJBbmltYXRpb25TZXJ2aWNlOiBOb3RpZmllckFuaW1hdGlvblNlcnZpY2UsXG4gICkge1xuICAgIHRoaXMuY29uZmlnID0gbm90aWZpZXJTZXJ2aWNlLmdldENvbmZpZygpO1xuICAgIHRoaXMucmVhZHkgPSBuZXcgRXZlbnRFbWl0dGVyPE5vdGlmaWVyTm90aWZpY2F0aW9uQ29tcG9uZW50PigpO1xuICAgIHRoaXMuZGlzbWlzcyA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuICAgIHRoaXMudGltZXJTZXJ2aWNlID0gbm90aWZpZXJUaW1lclNlcnZpY2U7XG4gICAgdGhpcy5hbmltYXRpb25TZXJ2aWNlID0gbm90aWZpZXJBbmltYXRpb25TZXJ2aWNlO1xuICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgdGhpcy5lbGVtZW50U2hpZnQgPSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXBvbmVudCBhZnRlciB2aWV3IGluaXQgbGlmZWN5Y2xlIGhvb2ssIHNldHRzIHVwIHRoZSBjb21wb25lbnQgYW5kIHRoZW4gZW1pdHMgdGhlIHJlYWR5IGV2ZW50XG4gICAqL1xuICBwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuc2V0dXAoKTtcbiAgICB0aGlzLmVsZW1lbnRIZWlnaHQgPSB0aGlzLmVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgIHRoaXMuZWxlbWVudFdpZHRoID0gdGhpcy5lbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgIHRoaXMucmVhZHkuZW1pdCh0aGlzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIG5vdGlmaWVyIGNvbmZpZ1xuICAgKlxuICAgKiBAcmV0dXJucyBOb3RpZmllciBjb25maWd1cmF0aW9uXG4gICAqL1xuICBwdWJsaWMgZ2V0Q29uZmlnKCk6IE5vdGlmaWVyQ29uZmlnIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWc7XG4gIH1cblxuICAvKipcbiAgICogR2V0IG5vdGlmaWNhdGlvbiBlbGVtZW50IGhlaWdodCAoaW4gcHgpXG4gICAqXG4gICAqIEByZXR1cm5zIE5vdGlmaWNhdGlvbiBlbGVtZW50IGhlaWdodCAoaW4gcHgpXG4gICAqL1xuICBwdWJsaWMgZ2V0SGVpZ2h0KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudEhlaWdodDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbm90aWZpY2F0aW9uIGVsZW1lbnQgd2lkdGggKGluIHB4KVxuICAgKlxuICAgKiBAcmV0dXJucyBOb3RpZmljYXRpb24gZWxlbWVudCBoZWlnaHQgKGluIHB4KVxuICAgKi9cbiAgcHVibGljIGdldFdpZHRoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudFdpZHRoO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBub3RpZmljYXRpb24gc2hpZnQgb2Zmc2V0IChpbiBweClcbiAgICpcbiAgICogQHJldHVybnMgTm90aWZpY2F0aW9uIGVsZW1lbnQgc2hpZnQgb2Zmc2V0IChpbiBweClcbiAgICovXG4gIHB1YmxpYyBnZXRTaGlmdCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRTaGlmdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IChhbmltYXRlIGluKSB0aGlzIG5vdGlmaWNhdGlvblxuICAgKlxuICAgKiBAcmV0dXJucyBQcm9taXNlLCByZXNvbHZlZCB3aGVuIGRvbmVcbiAgICovXG4gIHB1YmxpYyBzaG93KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgLy8gQXJlIGFuaW1hdGlvbnMgZW5hYmxlZD9cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5hbmltYXRpb25zLmVuYWJsZWQgJiYgdGhpcy5jb25maWcuYW5pbWF0aW9ucy5zaG93LnNwZWVkID4gMCkge1xuICAgICAgICAvLyBHZXQgYW5pbWF0aW9uIGRhdGFcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uRGF0YTogTm90aWZpZXJBbmltYXRpb25EYXRhID0gdGhpcy5hbmltYXRpb25TZXJ2aWNlLmdldEFuaW1hdGlvbkRhdGEoJ3Nob3cnLCB0aGlzLm5vdGlmaWNhdGlvbik7XG5cbiAgICAgICAgLy8gU2V0IGluaXRpYWwgc3R5bGVzIChzdHlsZXMgYmVmb3JlIGFuaW1hdGlvbiksIHByZXZlbnRzIHF1aWNrIGZsaWNrZXIgd2hlbiBhbmltYXRpb24gc3RhcnRzXG4gICAgICAgIGNvbnN0IGFuaW1hdGVkUHJvcGVydGllczogQXJyYXk8c3RyaW5nPiA9IE9iamVjdC5rZXlzKGFuaW1hdGlvbkRhdGEua2V5ZnJhbWVzWzBdKTtcbiAgICAgICAgZm9yIChsZXQgaTogbnVtYmVyID0gYW5pbWF0ZWRQcm9wZXJ0aWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsIGFuaW1hdGVkUHJvcGVydGllc1tpXSwgYW5pbWF0aW9uRGF0YS5rZXlmcmFtZXNbMF1bYW5pbWF0ZWRQcm9wZXJ0aWVzW2ldXSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBbmltYXRlIG5vdGlmaWNhdGlvbiBpblxuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuICAgICAgICBjb25zdCBhbmltYXRpb246IEFuaW1hdGlvbiA9IHRoaXMuZWxlbWVudC5hbmltYXRlKGFuaW1hdGlvbkRhdGEua2V5ZnJhbWVzLCBhbmltYXRpb25EYXRhLm9wdGlvbnMpO1xuICAgICAgICBhbmltYXRpb24ub25maW5pc2ggPSAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5zdGFydEF1dG9IaWRlVGltZXIoKTtcbiAgICAgICAgICByZXNvbHZlKCk7IC8vIERvbmVcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFNob3cgbm90aWZpY2F0aW9uXG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XG4gICAgICAgIHRoaXMuc3RhcnRBdXRvSGlkZVRpbWVyKCk7XG4gICAgICAgIHJlc29sdmUoKTsgLy8gRG9uZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGUgKGFuaW1hdGUgb3V0KSB0aGlzIG5vdGlmaWNhdGlvblxuICAgKlxuICAgKiBAcmV0dXJucyBQcm9taXNlLCByZXNvbHZlZCB3aGVuIGRvbmVcbiAgICovXG4gIHB1YmxpYyBoaWRlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgdGhpcy5zdG9wQXV0b0hpZGVUaW1lcigpO1xuXG4gICAgICAvLyBBcmUgYW5pbWF0aW9ucyBlbmFibGVkP1xuICAgICAgaWYgKHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuZW5hYmxlZCAmJiB0aGlzLmNvbmZpZy5hbmltYXRpb25zLmhpZGUuc3BlZWQgPiAwKSB7XG4gICAgICAgIGNvbnN0IGFuaW1hdGlvbkRhdGE6IE5vdGlmaWVyQW5pbWF0aW9uRGF0YSA9IHRoaXMuYW5pbWF0aW9uU2VydmljZS5nZXRBbmltYXRpb25EYXRhKCdoaWRlJywgdGhpcy5ub3RpZmljYXRpb24pO1xuICAgICAgICBjb25zdCBhbmltYXRpb246IEFuaW1hdGlvbiA9IHRoaXMuZWxlbWVudC5hbmltYXRlKGFuaW1hdGlvbkRhdGEua2V5ZnJhbWVzLCBhbmltYXRpb25EYXRhLm9wdGlvbnMpO1xuICAgICAgICBhbmltYXRpb24ub25maW5pc2ggPSAoKSA9PiB7XG4gICAgICAgICAgcmVzb2x2ZSgpOyAvLyBEb25lXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNvbHZlKCk7IC8vIERvbmVcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaGlmdCAobW92ZSkgdGhpcyBub3RpZmljYXRpb25cbiAgICpcbiAgICogQHBhcmFtICAgZGlzdGFuY2UgICAgICAgICBEaXN0YW5jZSB0byBzaGlmdCAoaW4gcHgpXG4gICAqIEBwYXJhbSAgIHNoaWZ0VG9NYWtlUGxhY2UgRmxhZywgZGVmaW5pbmcgaW4gd2hpY2ggZGlyZWN0aW9uIHRvIHNoaWZ0XG4gICAqIEByZXR1cm5zIFByb21pc2UsIHJlc29sdmVkIHdoZW4gZG9uZVxuICAgKi9cbiAgcHVibGljIHNoaWZ0KGRpc3RhbmNlOiBudW1iZXIsIHNoaWZ0VG9NYWtlUGxhY2U6IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmU6ICgpID0+IHZvaWQpID0+IHtcbiAgICAgIC8vIENhbGN1bGF0ZSBuZXcgcG9zaXRpb24gKHBvc2l0aW9uIGFmdGVyIHRoZSBzaGlmdClcbiAgICAgIGxldCBuZXdFbGVtZW50U2hpZnQ6IG51bWJlcjtcbiAgICAgIGlmIChcbiAgICAgICAgKHRoaXMuY29uZmlnLnBvc2l0aW9uLnZlcnRpY2FsLnBvc2l0aW9uID09PSAndG9wJyAmJiBzaGlmdFRvTWFrZVBsYWNlKSB8fFxuICAgICAgICAodGhpcy5jb25maWcucG9zaXRpb24udmVydGljYWwucG9zaXRpb24gPT09ICdib3R0b20nICYmICFzaGlmdFRvTWFrZVBsYWNlKVxuICAgICAgKSB7XG4gICAgICAgIG5ld0VsZW1lbnRTaGlmdCA9IHRoaXMuZWxlbWVudFNoaWZ0ICsgZGlzdGFuY2UgKyB0aGlzLmNvbmZpZy5wb3NpdGlvbi52ZXJ0aWNhbC5nYXA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdFbGVtZW50U2hpZnQgPSB0aGlzLmVsZW1lbnRTaGlmdCAtIGRpc3RhbmNlIC0gdGhpcy5jb25maWcucG9zaXRpb24udmVydGljYWwuZ2FwO1xuICAgICAgfVxuICAgICAgY29uc3QgaG9yaXpvbnRhbFBvc2l0aW9uOiBzdHJpbmcgPSB0aGlzLmNvbmZpZy5wb3NpdGlvbi5ob3Jpem9udGFsLnBvc2l0aW9uID09PSAnbWlkZGxlJyA/ICctNTAlJyA6ICcwJztcblxuICAgICAgLy8gQXJlIGFuaW1hdGlvbnMgZW5hYmxlZD9cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5hbmltYXRpb25zLmVuYWJsZWQgJiYgdGhpcy5jb25maWcuYW5pbWF0aW9ucy5zaGlmdC5zcGVlZCA+IDApIHtcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uRGF0YTogTm90aWZpZXJBbmltYXRpb25EYXRhID0ge1xuICAgICAgICAgIC8vIFRPRE86IEV4dHJhY3QgaW50byBhbmltYXRpb24gc2VydmljZVxuICAgICAgICAgIGtleWZyYW1lczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGUzZCggJHtob3Jpem9udGFsUG9zaXRpb259LCAke3RoaXMuZWxlbWVudFNoaWZ0fXB4LCAwIClgLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlM2QoICR7aG9yaXpvbnRhbFBvc2l0aW9ufSwgJHtuZXdFbGVtZW50U2hpZnR9cHgsIDAgKWAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgZHVyYXRpb246IHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuc2hpZnQuc3BlZWQsXG4gICAgICAgICAgICBlYXNpbmc6IHRoaXMuY29uZmlnLmFuaW1hdGlvbnMuc2hpZnQuZWFzaW5nLFxuICAgICAgICAgICAgZmlsbDogJ2ZvcndhcmRzJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmVsZW1lbnRTaGlmdCA9IG5ld0VsZW1lbnRTaGlmdDtcbiAgICAgICAgY29uc3QgYW5pbWF0aW9uOiBBbmltYXRpb24gPSB0aGlzLmVsZW1lbnQuYW5pbWF0ZShhbmltYXRpb25EYXRhLmtleWZyYW1lcywgYW5pbWF0aW9uRGF0YS5vcHRpb25zKTtcbiAgICAgICAgYW5pbWF0aW9uLm9uZmluaXNoID0gKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUoKTsgLy8gRG9uZVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICd0cmFuc2Zvcm0nLCBgdHJhbnNsYXRlM2QoICR7aG9yaXpvbnRhbFBvc2l0aW9ufSwgJHtuZXdFbGVtZW50U2hpZnR9cHgsIDAgKWApO1xuICAgICAgICB0aGlzLmVsZW1lbnRTaGlmdCA9IG5ld0VsZW1lbnRTaGlmdDtcbiAgICAgICAgcmVzb2x2ZSgpOyAvLyBEb25lXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGNsaWNrIG9uIGRpc21pc3MgYnV0dG9uXG4gICAqL1xuICBwdWJsaWMgb25DbGlja0Rpc21pc3MoKTogdm9pZCB7XG4gICAgdGhpcy5kaXNtaXNzLmVtaXQodGhpcy5ub3RpZmljYXRpb24uaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBtb3VzZW92ZXIgb3ZlciBub3RpZmljYXRpb24gYXJlYVxuICAgKi9cbiAgcHVibGljIG9uTm90aWZpY2F0aW9uTW91c2VvdmVyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbmZpZy5iZWhhdmlvdXIub25Nb3VzZW92ZXIgPT09ICdwYXVzZUF1dG9IaWRlJykge1xuICAgICAgdGhpcy5wYXVzZUF1dG9IaWRlVGltZXIoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29uZmlnLmJlaGF2aW91ci5vbk1vdXNlb3ZlciA9PT0gJ3Jlc2V0QXV0b0hpZGUnKSB7XG4gICAgICB0aGlzLnN0b3BBdXRvSGlkZVRpbWVyKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBtb3VzZW91dCBmcm9tIG5vdGlmaWNhdGlvbiBhcmVhXG4gICAqL1xuICBwdWJsaWMgb25Ob3RpZmljYXRpb25Nb3VzZW91dCgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWcuYmVoYXZpb3VyLm9uTW91c2VvdmVyID09PSAncGF1c2VBdXRvSGlkZScpIHtcbiAgICAgIHRoaXMuY29udGludWVBdXRvSGlkZVRpbWVyKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmNvbmZpZy5iZWhhdmlvdXIub25Nb3VzZW92ZXIgPT09ICdyZXNldEF1dG9IaWRlJykge1xuICAgICAgdGhpcy5zdGFydEF1dG9IaWRlVGltZXIoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGNsaWNrIG9uIG5vdGlmaWNhdGlvbiBhcmVhXG4gICAqL1xuICBwdWJsaWMgb25Ob3RpZmljYXRpb25DbGljaygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWcuYmVoYXZpb3VyLm9uQ2xpY2sgPT09ICdoaWRlJykge1xuICAgICAgdGhpcy5vbkNsaWNrRGlzbWlzcygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCB0aGUgYXV0byBoaWRlIHRpbWVyIChpZiBlbmFibGVkKVxuICAgKi9cbiAgcHJpdmF0ZSBzdGFydEF1dG9IaWRlVGltZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29uZmlnLmJlaGF2aW91ci5hdXRvSGlkZSAhPT0gZmFsc2UgJiYgdGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlID4gMCkge1xuICAgICAgdGhpcy50aW1lclNlcnZpY2Uuc3RhcnQodGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlKS50aGVuKCgpID0+IHtcbiAgICAgICAgdGhpcy5vbkNsaWNrRGlzbWlzcygpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBhdXNlIHRoZSBhdXRvIGhpZGUgdGltZXIgKGlmIGVuYWJsZWQpXG4gICAqL1xuICBwcml2YXRlIHBhdXNlQXV0b0hpZGVUaW1lcigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlICE9PSBmYWxzZSAmJiB0aGlzLmNvbmZpZy5iZWhhdmlvdXIuYXV0b0hpZGUgPiAwKSB7XG4gICAgICB0aGlzLnRpbWVyU2VydmljZS5wYXVzZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb250aW51ZSB0aGUgYXV0byBoaWRlIHRpbWVyIChpZiBlbmFibGVkKVxuICAgKi9cbiAgcHJpdmF0ZSBjb250aW51ZUF1dG9IaWRlVGltZXIoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29uZmlnLmJlaGF2aW91ci5hdXRvSGlkZSAhPT0gZmFsc2UgJiYgdGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlID4gMCkge1xuICAgICAgdGhpcy50aW1lclNlcnZpY2UuY29udGludWUoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3RvcCB0aGUgYXV0byBoaWRlIHRpbWVyIChpZiBlbmFibGVkKVxuICAgKi9cbiAgcHJpdmF0ZSBzdG9wQXV0b0hpZGVUaW1lcigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25maWcuYmVoYXZpb3VyLmF1dG9IaWRlICE9PSBmYWxzZSAmJiB0aGlzLmNvbmZpZy5iZWhhdmlvdXIuYXV0b0hpZGUgPiAwKSB7XG4gICAgICB0aGlzLnRpbWVyU2VydmljZS5zdG9wKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWwgbm90aWZpY2F0aW9uIHNldHVwXG4gICAqL1xuICBwcml2YXRlIHNldHVwKCk6IHZvaWQge1xuICAgIC8vIFNldCBzdGFydCBwb3NpdGlvbiAoaW5pdGlhbGx5IHRoZSBleGFjdCBzYW1lIGZvciBldmVyeSBuZXcgbm90aWZpY2F0aW9uKVxuICAgIGlmICh0aGlzLmNvbmZpZy5wb3NpdGlvbi5ob3Jpem9udGFsLnBvc2l0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnbGVmdCcsIGAke3RoaXMuY29uZmlnLnBvc2l0aW9uLmhvcml6b250YWwuZGlzdGFuY2V9cHhgKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY29uZmlnLnBvc2l0aW9uLmhvcml6b250YWwucG9zaXRpb24gPT09ICdyaWdodCcpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAncmlnaHQnLCBgJHt0aGlzLmNvbmZpZy5wb3NpdGlvbi5ob3Jpem9udGFsLmRpc3RhbmNlfXB4YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnbGVmdCcsICc1MCUnKTtcbiAgICAgIC8vIExldCdzIGdldCB0aGUgR1BVIGhhbmRsZSBzb21lIHdvcmsgYXMgd2VsbCAoI3BlcmZtYXR0ZXJzKVxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnQsICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlM2QoIC01MCUsIDAsIDAgKScpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb25maWcucG9zaXRpb24udmVydGljYWwucG9zaXRpb24gPT09ICd0b3AnKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuZWxlbWVudCwgJ3RvcCcsIGAke3RoaXMuY29uZmlnLnBvc2l0aW9uLnZlcnRpY2FsLmRpc3RhbmNlfXB4YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5lbGVtZW50LCAnYm90dG9tJywgYCR7dGhpcy5jb25maWcucG9zaXRpb24udmVydGljYWwuZGlzdGFuY2V9cHhgKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgY2xhc3NlcyAocmVzcG9uc2libGUgZm9yIHZpc3VhbCBkZXNpZ24pXG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnQsIGBub3RpZmllcl9fbm90aWZpY2F0aW9uLS0ke3RoaXMubm90aWZpY2F0aW9uLnR5cGV9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyh0aGlzLmVsZW1lbnQsIGBub3RpZmllcl9fbm90aWZpY2F0aW9uLS0ke3RoaXMuY29uZmlnLnRoZW1lfWApO1xuICB9XG59XG4iLCI8bmctY29udGFpbmVyXG4gICpuZ0lmPVwibm90aWZpY2F0aW9uLnRlbXBsYXRlOyBlbHNlIHByZWRlZmluZWROb3RpZmljYXRpb25cIlxuICBbbmdUZW1wbGF0ZU91dGxldF09XCJub3RpZmljYXRpb24udGVtcGxhdGVcIlxuICBbbmdUZW1wbGF0ZU91dGxldENvbnRleHRdPVwieyBub3RpZmljYXRpb246IG5vdGlmaWNhdGlvbiB9XCJcbj5cbjwvbmctY29udGFpbmVyPlxuXG48bmctdGVtcGxhdGUgI3ByZWRlZmluZWROb3RpZmljYXRpb24+XG4gIDxwIGNsYXNzPVwibm90aWZpZXJfX25vdGlmaWNhdGlvbi1tZXNzYWdlXCI+e3sgbm90aWZpY2F0aW9uLm1lc3NhZ2UgfX08L3A+XG4gIDxidXR0b25cbiAgICBjbGFzcz1cIm5vdGlmaWVyX19ub3RpZmljYXRpb24tYnV0dG9uXCJcbiAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICB0aXRsZT1cImRpc21pc3NcIlxuICAgICpuZ0lmPVwiY29uZmlnLmJlaGF2aW91ci5zaG93RGlzbWlzc0J1dHRvblwiXG4gICAgKGNsaWNrKT1cIm9uQ2xpY2tEaXNtaXNzKClcIlxuICA+XG4gICAgPHN2ZyBjbGFzcz1cIm5vdGlmaWVyX19ub3RpZmljYXRpb24tYnV0dG9uLWljb25cIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjIwXCI+XG4gICAgICA8cGF0aCBkPVwiTTE5IDYuNDFMMTcuNTkgNSAxMiAxMC41OSA2LjQxIDUgNSA2LjQxIDEwLjU5IDEyIDUgMTcuNTkgNi40MSAxOSAxMiAxMy40MSAxNy41OSAxOSAxOSAxNy41OSAxMy40MSAxMnpcIiAvPlxuICAgIDwvc3ZnPlxuICA8L2J1dHRvbj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=