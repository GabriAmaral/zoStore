
/* Smart UI v10.2.12 (2021-10-25) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart.Utilities.Assign("Grid.Dialog",class{_openImagePreviewDialog(e){const t=this;e=e.cloneNode(),t._dialogImagePreview||(t._dialogImagePreview=t._createDialog({modal:!0,screenModal:!0,left:"screenMiddle",top:"screenCenter",width:"80%",height:"80%"})),t._dialogImagePreview.content.innerHTML="",t._dialogImagePreview.content.appendChild(e),t._dialogImagePreview.btnClose.onclick=e=>{t._dialogImagePreview.close(),e.preventDefault(),e.stopPropagation()},e.style.marginLeft="auto",e.style.marginRight="auto",e.style.maxWidth="",e.onload=()=>{e.width=e.naturalWidth,e.height=e.naturalHeight,t._dialogImagePreview.style.width=150+Math.min(850,e.width)+"px",t._dialogImagePreview.style.height=150+Math.min(650,e.height)+"px",t._dialogImagePreview.style.left="calc(50% - "+Math.min(850,t._dialogImagePreview.offsetWidth/2)+"px)",t._dialogImagePreview.style.top="calc(50% - "+Math.min(650,t._dialogImagePreview.offsetHeight/2)+"px)",e.style.maxWidth="100%"},t._dialogImagePreview.content.onpointerdown=t._dialogImagePreview.content.onpointerup=e=>{e.preventDefault(),e.stopPropagation()},t._dialogImagePreview.onkeydown=function(e){"Escape"===e.key&&t._dialogImagePreview.close()},t._dialogImagePreview.btnClose.tabIndex=0,t._dialogImagePreview.onOpen=()=>{setTimeout((()=>{t._dialogImagePreview.btnClose.focus()}),100)},t._dialogImagePreview.footer.remove(),t._dialogImagePreview.header.parentNode.style.backgroundColor="var(--smart-background)",t._dialogImagePreview.open()}_openImageDialog(e,t){const i=this,n=i._dialogImage||i._createDialog(),l='<span class="smart-grid-icon smart-icon-image show"></span>'+i.localize("dialogImageHeader");if(n.cell||(n.cell=e),n.header.innerHTML=l,n.column=e.column,n.command=t,n.classList.add("smart-grid-image-dialog"),!i._dialogImage){n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogEditButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogEditButtonCancel"),n.onOpen=function(){n.fileUpload.value="",n.input.value="";let e=n.cell.editor.instance.getValue();if("[]"!==e)if(e&&"string"==typeof e&&e.indexOf("http")>=0)n.input.value=JSON.parse(e)[0].value,n.tabs[1].click(),a("input");else{n.tabs[0].click();const t=(e,t)=>{let i=e.split(","),n=i[0].match(/:(.*?);/)[1],l=atob(i[1]),a=l.length,o=new Uint8Array(a);for(;a--;)o[a]=l.charCodeAt(a);return new File([o],t,{type:n})},i=new DataTransfer;"string"==typeof e&&e.indexOf("base64")>=0&&(e=JSON.parse(e)),Array.isArray(e)&&(e.forEach((e=>{i.items.add(t(e.value,e.label))})),n.fileUpload.files=i.files,a())}else n.tabs[0].click()},n.onClose=function(){},n.btnCancel.onclick=function(){n.close()},n.btnClose.onclick=function(){n.close()},n.btnConfirm.onclick=function(){if(n.tabs[1].classList.contains("active"))n.input.value?e.editor.instance.setValue([{label:n.input.value,value:n.input.value}]):e.editor.instance.setValue([]),i._endCellEdit(n.cell);else{const t=(e,t)=>{var i=new FileReader;i.readAsDataURL(e),i.onload=function(){t(i.result)},i.onerror=function(){t("error")}},l=[];if(n.fileUpload.files.length)for(let a=0;a<n.fileUpload.files.length;a++){const o=n.fileUpload.files[a];t(o,(t=>{"error"===t&&console.log("Image load error"),l.push({value:t,label:o.name}),l.length===n.fileUpload.files.length&&(e.editor.instance.setValue(l),i._endCellEdit(n.cell))}))}else e.editor.instance.setValue([]),i._endCellEdit(n.cell)}n.close()},n.onkeydown=function(e){"Escape"===e.key&&n.close()},i._dialogImage=n,n.content.innerHTML=`\n                <div>\n                    <div>\n                        <div class="tabs">\n                            <div class="active tab">\n                                <span class="smart-grid-icon smart-icon-plus show"></span><label>${i.localize("dialogImageDevice")}</label>\n                            </div>\n                            <div class="tab">\n                                <span class="smart-grid-icon smart-icon-link show"></span><label>${i.localize("dialogImageLink")}</label>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="smart-grid-drop-zone">\n                         <div>\n                            <div class="title"><span class="smart-grid-icon smart-icon-plus show"></span><label>${i.localize("dialogImageUpload")}</label></div>\n                            <div class="subtitle"><span class="smart-grid-icon smart-icon-docs show"></span><label>${i.localize("dialogImageDrop")}</label></div>\n                         </div> \n                         <input accept=".jpg, .jpeg, .png" type="file" multiple="multiple" style="display: none;">\n                    </div>\n                    <div class="smart-hidden url-zone">\n                        <div class="url-title">\n                        ${i.localize("dialogImageURL")}\n                        </div>\n                        <div class="upload">\n                            <smart-input placeholder="https://example.com/image.png" class="underlined"></smart-input>\n                            <br/>\n                            <smart-button disabled class="success">${i.localize("dialogImageURLUpload")}</smart-button>\n                        </div>\n                    </div>\n                    <div class="preview">\n                    </div>\n                    <br/>\n                </div>`,n.input=n.querySelector("smart-input"),n.dropZone=n.querySelector(".smart-grid-drop-zone"),n.upload=n.querySelector(".title"),n.fileUpload=n.querySelector("input"),n.preview=n.querySelector(".preview"),n.tabs=n.querySelectorAll(".tab"),n.urlZone=n.querySelector(".url-zone"),n.uploadButton=n.querySelector("smart-button");const t=["image/apng","image/bmp","image/gif","image/jpeg","image/pjpeg","image/png","image/svg+xml","image/tiff","image/webp","image/x-icon"],l=e=>t.includes(e.type);n.dropZone.ondrop=e=>{if(e.preventDefault(),e.dataTransfer.items){let t=0;for(let i=0;i<e.dataTransfer.items.length;i++)if("file"===e.dataTransfer.items[i].kind){const n=e.dataTransfer.items[i].getAsFile();l(n)&&t++}t===e.dataTransfer.files.length&&(n.fileUpload.files=e.dataTransfer.files,a())}else n.fileUpload.files=e.dataTransfer.files,a()},n.dropZone.ondragover=e=>{e.preventDefault()},n.tabs[0].onclick=()=>{n.tabs[0].classList.add("active"),n.tabs[1].classList.remove("active"),n.dropZone.classList.remove("smart-hidden"),n.urlZone.classList.add("smart-hidden"),n.updatePreview()},n.tabs[1].onclick=()=>{n.tabs[0].classList.remove("active"),n.tabs[1].classList.add("active"),n.dropZone.classList.add("smart-hidden"),n.urlZone.classList.remove("smart-hidden"),n.updatePreview("input")},n.uploadButton.onclick=()=>{n.updatePreview("input")};const a=e=>{const t=n.preview,o=n.fileUpload;function s(e){return e<1024?e+"bytes":e>=1024&&e<1048576?(e/1024).toFixed(1)+"KB":e>=1048576?(e/1048576).toFixed(1)+"MB":void 0}for(;t.firstChild;)t.removeChild(t.firstChild);const d=()=>{const e=document.createElement("div");return e.classList.add("item"),e.onpointerdown=t=>{const l=e.getBoundingClientRect();if(n.input.value="",t.clientY>=l.bottom-12){if(t.clientX>l.left+l.width/2-13&&t.clientX<l.left+l.width/2+13){e.remove();const t=n.preview.querySelectorAll(".item"),i=new DataTransfer;t.forEach((e=>{i.items.add(e.file)})),o.files=i.files,n.clearButton&&0===t.length&&n.clearButton.classList.remove("show")}}else i._openImagePreviewDialog(e.querySelector("img"))},e},r=()=>{const e=document.createElement("div");e.classList.add("list");const l=document.createElement("div");l.classList.add("smart-grid-icon","show","smart-icon-delete"),l.title=i.localize("clear"),t.appendChild(l),l.onclick=()=>{o.value="",n.input.value="",a()},n.clearButton=l,t.appendChild(e)};if("input"===e){const e=n.input.value;if(e){const t=d();if(r(),e.endsWith("png")||e.endsWith("jpeg")||e.endsWith("jpg")){const i=document.createElement("img");i.src=e,t.appendChild(i)}n.preview.lastChild.appendChild(t)}else{const e=document.createElement("p");e.textContent="No files currently selected for upload",t.appendChild(e)}}else{const e=o.files;if(0===e.length){const e=document.createElement("p");e.textContent="No files currently selected for upload",t.appendChild(e)}else{r();for(const i of e){const e=d(),a=document.createElement("div");if(l(i)){a.textContent=`${i.name}, ${s(i.size)}.`,a.textContent.length>20&&(a.textContent=`${i.name.substring(0,5)}...${i.name.substring(i.name.length-4)}, ${s(i.size)}.`);const l=document.createElement("img");if(l.src=URL.createObjectURL(i),i.size>2097152){const e=document.createElement("p");e.textContent="No files currently added. Maximum file size is 2MB.",t.appendChild(e),n.clearButton.classList.remove("show");break}e.file=i,e.title=a.textContent,e.appendChild(l),e.appendChild(a)}n.preview.lastChild.appendChild(e)}}}};n.updatePreview=a,n.fileUpload.onchange=()=>{0===n.fileUpload.files.length&&n._tempFiles&&(n.fileUpload.files=n._tempFiles),a()},n.input.onchange=n.input.onblur=n.input.onkeyup=()=>{n.uploadButton.disabled=!n.input.value||!n.input.value.startsWith("https://")},n.upload.onclick=()=>{n._tempFiles=[];const e=new DataTransfer;[...n.fileUpload.files].forEach((t=>{e.items.add(t)})),n._tempFiles=e.files,n.fileUpload.click()}}n.open(),setTimeout((function(){n.btnConfirm.focus()}),100)}_createOverlay(){const e=document.createElement("div");return e.onpointerdown=function(){return!1},e.onmousedown=function(){return!1},e.onclick=function(){},e.classList.add("smart-grid-dialog-overlay"),e}_createDialog(e){const t=this;let i=document.createElement("div");e||(e=t.editing.dialog),void 0!==e.modal&&(i.modal=e.modal),void 0!==e.screenModal&&(i.screenModal=e.screenModal),i.setAttribute("animation","none"),i.classList.add("smart-window","smart-grid-dialog"),i.style.width="auto"===e.width?e.width:e.width+"px",i.style.height="auto"===e.height?e.height:e.height+"px",e.width&&"string"==typeof e.width&&(i.style.width=e.width),e.height&&"string"==typeof e.height&&(i.style.height=e.height),i.style.left="",i.style.top="",i.innerHTML='<div class="smart-container">\n                   <div class ="smart-content-container" smart-id="container">\n                        <div id="headerSection" class="smart-header-section">\n                            <div class="smart-header"></div>\n                            <div class="smart-buttons-container">\n                            <button tabindex=-1 class ="smart-hidden smart-button smart-element smart-prev-button" aria-label="Previous Record" smart-id="prevButton"></button>\n                            <button tabindex=-1 class ="smart-hidden smart-button smart-element smart-next-button" aria-label="Next Record" smart-id="nextButton"></button>\n                            <button class ="smart-button smart-element smart-close-button" aria-label="Close" smart-id="closeButton"></button>\n                            </div>\n                        </div>\n                        <div class="smart-content"><div class="smart-content-container"></div></div>\n                        <div class ="smart-footer">\n                            <div class ="smart-stack-layout right spacing">\n                                <smart-button class ="smart-confirm-button item primary">Ok</smart-button>\n                                <smart-button class ="smart-cancel-button item">Cancel</smart-button>\n                            </div>\n                        </div>\n                    </div>\n              </div>\n            ',i.querySelector&&i.querySelector(".smart-content")&&(i.content=i.querySelector(".smart-content").firstChild),i.footer=i.querySelector(".smart-footer"),i.header=i.querySelector(".smart-header"),i.btnConfirm=i.querySelector(".smart-confirm-button"),i.btnCancel=i.querySelector(".smart-cancel-button"),i.btnClose=i.querySelector(".smart-close-button"),i.btnNext=i.querySelector(".smart-next-button"),i.btnPrev=i.querySelector(".smart-prev-button");const n=document.createElement("div");return n.classList.add("smart-grid-dialog-overlay"),n.onclick=function(){},i.overlay=n,i.remove=function(){i.parentNode&&i.parentNode.removeChild(i)},i.close=function(){i.classList.remove("open"),i.addEventListener("transitionend",i.remove),i.addEventListener("transitioncancel",i.remove),i.modal&&i.overlay.parentNode&&i.overlay.parentNode.removeChild(i.overlay),i.onClose&&i.onClose()},i.open=function(n,l){i.removeEventListener("transitionend",i.remove),i.removeEventListener("transitioncancel",i.remove),document.body.appendChild(i),n||(n=e.left),l||(l=e.top),requestAnimationFrame((function(){i.classList.add("open");const e=function(e,n){const l=t.offset(t);switch("center"===e&&"horizontal"===n&&(e="middle"),e){case"top":return l.top;case"bottom":return Math.max(l.top,l.top+t.offsetHeight-i.offsetHeight);case"center":return Math.max(l.top,l.top+t.offsetHeight/2-i.offsetHeight/2);case"left":return l.left;case"middle":return l.left+t.offsetWidth/2-i.offsetWidth/2;case"right":return l.left+t.offsetWidth-i.offsetWidth}return"horizontal"===n?parseInt(e)+l.left:"vertical"===n?parseInt(e)+l.top:"number"==typeof e?e:parseInt(e)};i.style.left=e(n,"horizontal")+"px",i.style.top=e(l,"vertical")+"px","screenMiddle"===n&&(i.style.left="calc(50% - "+i.offsetWidth/2+"px)"),"screenCenter"===l&&(i.style.top="calc(50% - "+i.offsetHeight/2+"px)")})),i.modal&&(i.screenModal?document.body.appendChild(i.overlay):t.appendChild(i.overlay)),i.onOpen&&i.onOpen()},i}_openAddRowDialog(e,t){const i=this;if(!i.editing.addDialog.enabled)return!1;const n=i._dialogAddRow||i._createDialog(),l="{{message}}"===i.editing.dialog.header?i.localize("dialogAddHeader"):i.editing.dialog.header,a=n.content;n.header.innerHTML=l,e.grid=i,void 0===e.index&&(e.index=i.rows.length,i._rowsAdded&&(e.index+=i._rowsAdded.length));const o=e.cells;let s=null,d=0;if(i._cellEditors||(i._cellEditors=[]),!i._dialogAddRow){n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogAddButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogAddButtonCancel"),n.onOpen=function(){i.editing.dialog.visible=!0},n.onClose=function(){i.editing.dialog.visible=!1},n.btnCancel.onclick=function(){n.close()},n.btnClose.onclick=function(){n.close()},n.btnConfirm.onclick=function(){const e={};for(let t=0;t<o.length;t++){const n=o[t],l=i._getEditorValue(n),a=i._getEditorId(n),s=i._cellEditors[a];s&&(l&&l.error?(e[n.column.dataField]=l.value,s.detach()):(e[n.column.dataField]=l,s.detach()))}const l=i._rowsAdded?i._rowsAdded.length:0,a=new Smart.Grid.Row({index:i.rows.length+l,id:Smart.Utilities.Core.createGUID(),grid:i,data:e});n.close(),t(a,0===n.index)},n.onkeydown=function(e){const t=e.key;"Enter"===t?n.btnConfirm.onclick():"Escape"===t&&n.close()},a.classList.add("smart-grid-layout");for(let e=0;e<i.columns.length;e++){const t=i.columns[e];if(!t.allowEdit)continue;d%2==0&&(s=document.createElement("div"),s.classList.add("row"),a.appendChild(s));const n=document.createElement("div");n.classList.add("col-sm-6");const l=document.createElement("div");l.classList.add("column");const o=document.createElement("label");o.innerHTML=i.columns[e].label;const r=document.createElement("div");r.classList.add("smart-grid-dialog-editor"),r.setAttribute("editor",t.dataField),r.setAttribute("template",t.editor.template),n.appendChild(l),s.appendChild(n),l.appendChild(o),l.appendChild(r),d++}}n.open(),n.index=e.index;let r=0;for(let e=0;e<o.length;e++){const t=o[e],l=t.column,a=l.dataField,s=n.querySelector("[editor="+a+"]");if(!s)continue;s.innerHTML="";let d="";void 0!==t.value&&(d=t.value),"int64"!==l.dataType&&"number"!==l.dataType&&"int"!==l.dataType&&"float"!==l.dataType||(d=0),"date"===l.dataType&&(d=new Date),"bool"!==l.dataType&&"boolean"!==l.dataType||(d=!1);let c=null;switch(t.editor.template){default:case"custom":c=i._getCustomCellEditor(t);break;case"image":c=i._getImageCellEditor(t);break;case"checkBox":c=i._getCheckBoxCellEditor(t);break;case"autoComplete":c=i._getAutoCompleteCellEditor(t);break;case"dropDownList":c=i._getAutoCompleteCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"comboBox":c=i._getAutoCompleteCellEditor(t),c.readonly=!1,c.dropDownButtonPosition="right";break;case"maskedTextBox":c=i._getMaskCellEditor(t);break;case"checkInput":c=i._getCheckInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"multiInput":c=i._getMultiInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"multiComboInput":c=i._getMultiComboInputCellEditor(t),c.readonly=!0,c.dropDownButtonPosition="right";break;case"time":case"timeInput":c=i._getTimeInputCellEditor(t);break;case"date":case"dateInput":c=i._getDateInputCellEditor(t);break;case"dateRangeInput":c=i._getDateRangeInputCellEditor(t);break;case"dateTimePicker":c=i._getDateTimePickerCellEditor(t);break;case"textArea":case"textarea":c=i._getTextAreaCellEditor(t);break;case"numberInput":case"text":case"input":c="numberInput"===t.editor.template?i._getNumberInputCellEditor(t):i._getInputCellEditor(t)}if(c.attach(),t.editor.instance=c,c.setValue(d),0===r&&setTimeout((()=>{c.focus()}),100),!t.editor.isInitialized&&(t.editor.isInitialized=!0,t.editor.onInit)){const e=t.editor.onInit(t.row.index,t.column.dataField,t.editor.instance.element,t.row.data);if(e&&e instanceof Promise)e.then((e=>{const i="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let t in e)i[t]=e[t]}));else if(e){const i=e,n="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let e in i)n[e]=i[e]}}if(t.editor.onRender){const e=t.editor.onRender(t.row.index,t.column.dataField,t.editor.instance.element,t.row.data);if(e&&e instanceof Promise)e.then((e=>{const i="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let t in e)i[t]=e[t]}));else if(e){const i=e,n="custom"===t.editor.template?t.editor.instance.element.firstElementChild:t.editor.instance.element;for(let e in i)n[e]=i[e]}}s.appendChild(c.element),c.element.onfocus=()=>{s.setAttribute("focus","")},c.element.onblur=()=>{s.removeAttribute("focus")},r++}i._dialogAddRow=n}_openEditDialog(e,t){const i=this;if(!i.editing.dialog.enabled)return!1;const n=i._dialogEdit||i._createDialog(),l="{{message}}"===i.editing.dialog.header?i.localize("dialogEditHeader",{value:i.editing.editRow?e.row.visibleIndex+1:e.column.label}):i.editing.dialog.header,a=n.content;n.header.innerHTML=l,n.row=i.editing.editRow,i.editing.recordNavigation&&n.classList.add("disable-animation");let o=null,s=0;if(void 0!==i._settingsDialogRowId){n.btnPrev.classList.remove("smart-hidden"),n.btnNext.classList.remove("smart-hidden");const e=e=>{const t=i.editing.editRow,l=i._recyclingRows.indexOf(t),a=e?i._recyclingRows[l+1]:i._recyclingRows[l-1];if(a){n.classList.add("disable-animation"),i.editing.recordNavigation=!0;const e=n.querySelector("[focus]");if(e){const t=e.closest(".row"),n=t.closest(".smart-grid-edit-dialog-editors-container");let l=-1;if(n&&(l=[...n.children].indexOf(t)),i.cancelEdit(),i._openRowSettingsDialog(a.id),i._dialogEdit&&l>=0){const e=i._dialogEdit.querySelectorAll(".row")[l];if(e){const t=e.querySelector(".smart-grid-dialog-editor");t.setAttribute("focus",""),t.querySelector(".smart-grid-cell-editor").focus()}}}else i.cancelEdit(),i._openRowSettingsDialog(a.id)}};n.btnNext.onmousedown=t=>{e(!0),t.preventDefault(),t.stopPropagation()},n.btnPrev.onmousedown=t=>{e(!1),t.preventDefault(),t.stopPropagation()}}if(!i._dialogEdit)if(n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogEditButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogEditButtonCancel"),n.onOpen=function(){i.editing.dialog.visible=!0,i._settingsDialogRowId&&n.editorsContent&&n.editorsContent.offsetHeight&&(n.editorsContent.style.maxHeight=n.editorsContent.offsetHeight+40+"px")},n.onClose=function(){i.editing.dialog.visible=!1,n.row.showDetail=!1},n.btnCancel.onclick=function(){i.cancelEdit()},n.btnClose.onclick=function(){i.cancelEdit()},n.btnConfirm.onclick=function(){if(void 0!==i._settingsDialogRowId){if(i.rowById[i._settingsDialogRowId]){const e=i.editing.editRow;if(!e)return!1;const t=e.cells;let l={};e.element.removeAttribute("error");for(let e=0;e<t.length;e++){const n=t[e],a=i._getEditorValue(n);l[n.column.dataField]=a}const a=i.validateRow(e.id,l);if(Object.keys(a).length>0){let e=!0;for(let l=0;l<t.length;l++){const o=t[l],s=a[o.column.dataField],d=n.querySelector(`[label-for="${o.column.dataField}"]`);if(d&&(d.innerHTML=""),s)for(let t in s){const n=s[t];let l="";if(!n)continue;let a=n[t];"minLength"!==t&&"maxLength"!==t||(a=n[t.toLowerCase()]),l=n.message?n.message:"required"===t?i.localize("requiredValue",{value:o.column.label}):"min"===t?i.localize("invalidMinValue",{value:o.column.label,min:a.min}):"max"===t?i.localize("invalidMaxValue",{value:o.column.label,max:a.max}):"minLength"===t?i.localize("invalidMinLengthValue",{value:o.column.label,min:a.requiredLength}):"maxLength"===t?i.localize("invalidMaxLengthValue",{value:o.column.label,max:a.requiredLength}):i.localize("invalidValue"),e=!1,d&&(d.innerHTML=l)}}if(!e)return}n._userData._changed=!0,e._userData=n._userData}if(n.columnVisibility){let e=!1;const t=i.columns.canNotify;i.columns.canNotify=!1;for(let t in n.columnVisibility){const l=i.columnByDataField[t];l.visible!==n.columnVisibility[t]&&(l.visible=n.columnVisibility[t],e=!0)}if(i.columns.canNotify=t,e)return i.endEdit(),void i.refresh(!1)}}i.endEdit()},n.onkeydown=function(e){const t=e.key,n=i.editing.commandKeys;for(let e in n){const l=n[e];if(t===l.key){i._applyCommand(l.command);break}}},i.editing.editRow)if(void 0!==i._settingsDialogRowId)i._applySettingsDialogLayout(n,a,i.editing.editRow);else{a.classList.add("smart-grid-layout");for(let e=0;e<i.columns.length;e++){const t=i.columns[e];if(!t.allowEdit)continue;s%2==0&&(o=document.createElement("div"),o.classList.add("row"),a.appendChild(o));const n=document.createElement("div");n.classList.add("col-sm-6");const l=document.createElement("div");l.classList.add("column");const d=i._settingsDialogRowId?document.createElement("div"):document.createElement("label");d.innerHTML=i.columns[e].label;const r=document.createElement("div");r.classList.add("smart-grid-dialog-editor"),r.setAttribute("editor",t.dataField),r.setAttribute("template",t.editor.template),n.appendChild(l),o.appendChild(n),l.appendChild(d),l.appendChild(r),s++}}else{const t=e.column,i=document.createElement("div");i.classList.add("smart-grid-dialog-editor"),i.setAttribute("editor",""),i.setAttribute("template",t.editor.template),a.appendChild(i)}if(n.open(),i.editing.editRow){const i=n.querySelector("[editor="+e.column.dataField+"]");i.innerHTML="",i.appendChild(t.element),t.element.onfocus=()=>{i.setAttribute("focus","")},t.element.onblur=()=>{i.removeAttribute("focus")}}else{const i=e.column,l=n.querySelector("[editor]");l.innerHTML="",l.setAttribute("template",i.editor.template),l.appendChild(t.element),t.element.onfocus=()=>{l.setAttribute("focus","")},t.element.onblur=()=>{l.removeAttribute("focus")}}i._dialogEdit=n}_refreshCurrentUser(){const e=this,t=e.users;let i=e.currentUser,n=!0,l=!0,a=e.editing.enabled,o=!0;t&&null!==i&&(i=t.find((e=>e.id===i)),i&&(n=!1!==i.allowAdd,l=!1!==i.allowComment,a=a&&!1!==i.allowEdit,o=!1!==i.allowRemove)),e._currentUser={allowAdd:n,allowComment:l,allowEdit:a,allowRemove:o,info:i}}_applySettingsDialogLayout(e,t,i){const n=this;e.classList.add("smart-grid-dialog-expand-row");const l=[];e.columnVisibility=l;const a=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div");s.appendChild(a),s.appendChild(o),t.appendChild(s),s.classList.add("smart-grid-edit-dialog-layout"),a.classList.add("smart-grid-edit-dialog-editors-container"),o.classList.add("smart-grid-edit-dialog-activity-container"),n.columns.length>=8&&a.classList.add("many"),e.editorsContent=a,e.activityContent=o;const d=document.createElement("div"),r=document.createElement("div");o.appendChild(d),o.appendChild(r);const c=()=>{const e=document.createElement("smart-color-input");return e.dataSource=["#D50000","#E67C73","#F4511E","#F6BF26","#33B679","#0B8043","#039BE5","#3F51B5","#7986CB","#8E24AA","#616161","#FFFFFF","#000000",""],e.valueDisplayMode="colorBox",e.classList.add("underlined","smart-grid-color-input"),e.style.width="auto",e.onRender=()=>{const t=e.$.scrollView;t&&t.classList.add("smart-grid-color-input")},e};d.innerHTML=`\n            <div class="row"><div class="column"><div class="header smart-grid-edit-dialog-column-info">${n.localize("format").replace(":","")}\n            <span title="${n.localize("resetFormat")}" class="reset-format smart-grid-icon smart-icon-reload show"></span>\n            </div>\n             </div>\n            <div class="format-layout">\n                    <div title="${n.localize("background")}" class="format smart-grid-edit-dialog-column-info">\n                        <span class="smart-grid-icon smart-icon-color-background show"></span><div class="background"></div>\n                    </div>\n                    <div title="${n.localize("color")}" class="format smart-grid-edit-dialog-column-info">\n                        <span style="border-bottom: 2px solid #46CA78;" color="#46CA78" class="format smart-grid-icon smart-icon-font show"></span><div class="color"></div>\n                    </div>\n                    <div class="format-layout button-group">\n                        <span title="${n.localize("bold")}" class="formatbtn bold smart-grid-icon smart-icon-bold show"></span>\n                        <span title="${n.localize("italic")}" class="formatbtn italic smart-grid-icon smart-icon-italic show"></span>\n                        <span title="${n.localize("underline")}" class="formatbtn underline smart-grid-icon smart-icon-underline show"></span>\n                    </div>\n            </div>\n           <div class="format-layout font-group">\n                <div title="${n.localize("fontFamily").replace(":","")}" class="format smart-grid-edit-dialog-column-info">\n                <span class="smart-grid-icon smart-icon-font show"></span><div class="font-family"></div>\n                </div>\n                <div title="${n.localize("fontSize").replace(":","")}" class="format smart-grid-edit-dialog-column-info">\n                    <span class="smart-grid-icon smart-icon-fontsize show"></span><div class="font-size"></div>\n                </div>\n           </div>\n            <div class="format-layout font-group">\n                <div title="${n.localize("status").replace(":","")}" class="format smart-grid-edit-dialog-column-info">\n                <span color="#F1C58B" class="smart-grid-icon smart-icon-star show"></span><div class="status"></div>\n                </div>\n            </div>\n            <div class="column"><div class="comments-header smart-grid-edit-dialog-column-info">${n.localize("comments").replace(":","")}</div></div>\n            <div class="comments-layout">\n                <div class="comments"><span class="no-comments">${n.localize("noComments")}</span></div>\n                <div class="footer">\n                    <smart-text-area hint="${n.localize("comment")}" placeholder="${n.localize("comment")}" class="success underlined"></smart-text-area>\n                    <smart-button class="success">${n.localize("send")}</smart-button>\n                </div>\n            </div>\n        `;const m=e._userData=JSON.parse(JSON.stringify(i._userData)),u=c();d.querySelector(".background").appendChild(u),u.onchange=()=>{m.background=u.value},m.background&&(u.value=m.background);const p=c();d.querySelector(".color").appendChild(p),p.onchange=()=>{m.color=p.value},m.color&&(p.value=m.color);const g=c();d.querySelector(".status").appendChild(g),g.onchange=()=>{m.status=g.value},m.status&&(g.value=m.status);const f=document.createElement("smart-input");f.style.width="auto",f.classList.add("underlined"),f.dropDownButtonPosition="right",f.readonly=!0,f.dropDownHeight="auto",f.dataSource=["-","Segoe UI","Arial","Georgia","Impact","Tahoma","Times New Roman","Verdana"],f.onchange=()=>{m.fontFamily=f.value},m.fontFamily?f.value=m.fontFamily:f.selectedIndex=0,d.querySelector(".font-family").appendChild(f);const b=document.createElement("smart-input");b.style.width="auto",b.classList.add("underlined"),b.dropDownButtonPosition="right",b.readonly=!0,b.dropDownHeight="auto",b.dataSource=["-","8px","10px","12px","14px","18px","24px","36px"],b.onchange=()=>{m.fontSize=b.value},m.fontSize?b.value=m.fontSize:b.selectedIndex=0,d.querySelector(".font-size").appendChild(b);const h=d.querySelector(".button-group");h.onclick=e=>{const t=e.target.closest(".formatbtn");let i;t.classList.contains("checked")?(t.classList.remove("checked"),i=!1):(t.classList.add("checked"),i=!0),t.classList.contains("bold")?m.fontWeight=i?"bold":null:t.classList.contains("italic")?m.fontStyle=i?"italic":null:t.classList.contains("underline")&&(m.textDecoration=i?"underline":null)},m.fontWeight?h.children[0].classList.add("checked"):h.children[0].classList.remove("checked"),m.fontStyle?h.children[1].classList.add("checked"):h.children[1].classList.remove("checked"),m.textDecoration?h.children[2].classList.add("checked"):h.children[2].classList.remove("checked"),d.querySelector(".reset-format").onclick=()=>{for(let e=0;e<h.children.length;e++)h.children[e].classList.remove("checked");f.selectedIndex=0,b.selectedIndex=0,p.value="",u.value="",g.value="",m.fontWeight=null,m.fontStyle=null,m.textDecoration=null,m.fontSize=null,m.fontFamily=null};const v=d.querySelector(".comments-header"),y=d.querySelector(".comments-layout smart-text-area"),w=d.querySelector(".comments-layout smart-button"),C=d.querySelector(".comments-layout .footer"),L=d.querySelector(".comments-layout .comments");w.disabled=!0,L.innerHTML=`<span class="no-comments">${n.localize("noComments")}</span>`;const x=()=>{const e=L.querySelector(".no-comments");0===m.comments.length?e.classList.remove("smart-hidden"):e.classList.add("smart-hidden")},E=e=>{e.querySelector(".remove-button").onclick=e=>{const t=e.target,i=m.comments.indexOf(t.comment);i>-1&&(m.comments.splice(i,1),t.element.remove(),v.innerHTML=`${n.localize("comments").replace(":","")} (${m.comments.length})`)}};for(let e=0;e<m.comments.length;e++){const t=m.comments[e],i=n._createComment(t);E(i),L.appendChild(i)}v.innerHTML=`${n.localize("comments").replace(":","")} (${m.comments.length})`,x(),y.onfocus=()=>{C.classList.add("focus")},y.onblur=()=>{C.classList.remove("focus")},y.onkeyup=()=>{w.disabled=""===y.value},w.onclick=()=>{if(""===y.value)return;n._refreshCurrentUser();const e={text:y.value,userId:n._currentUser.info?n._currentUser.info.id:-1,time:new Date},t=n._createComment(e);E(t),m.comments.push(e),y.value="",w.disabled=!0,x(),L.appendChild(t),v.innerHTML=`${n.localize("comments").replace(":","")} (${m.comments.length})`};for(let e=0;e<n.columns.length;e++){const t=n.columns[e];if(!t.allowEdit)continue;const i=document.createElement("div");i.classList.add("row"),a.appendChild(i);const o=document.createElement("div"),s=n._settingsDialogRowId?document.createElement("div"):document.createElement("label"),d=t.validationRules&&t.validationRules.length>0?"*":"";s.innerHTML=`<div class="smart-grid-edit-dialog-column-info"><span class="smart-grid-icon ${n.columns[e].icon} show"></span><label>`+n.columns[e].label+d+'</label><span toggle class="smart-grid-icon smart-icon-visibility-on show"</div>';const r=document.createElement("div");r.classList.add("smart-grid-dialog-editor"),r.setAttribute("editor",t.dataField),r.setAttribute("template",t.editor.template);const c=s.querySelector("[toggle]");c.column=t,l[t.dataField]=t.visible,c.title=n.localize("columnMenuItemHide"),c.onclick=()=>{l[c.column.dataField]=!c.column.visible,c.classList.contains("smart-icon-visibility-on")?(c.classList.remove("smart-icon-visibility-on"),c.classList.add("smart-icon-visibility-off"),c.title=n.localize("columnMenuItemShow")):(c.classList.add("smart-icon-visibility-on"),c.classList.remove("smart-icon-visibility-off"),c.title=n.localize("columnMenuItemHide"))},t.visible||(c.classList.remove("smart-icon-visibility-on"),c.title=n.localize("columnMenuItemShow")),t.visible?c.classList.add("smart-icon-visibility-on"):c.classList.add("smart-icon-visibility-off"),o.appendChild(s),o.appendChild(r);const m=document.createElement("label");m.classList.add("smart-field-editor-error-label"),m.setAttribute("label-for",t.dataField),o.appendChild(m),i.appendChild(o)}}_createComment(e){const t=this,i=t._currentUser.info,n=document.createElement("div"),l=i?i.image:"smart-icon",a=i?i.name||i.id:t.localize("guestUser"),o=i?i.name:t.localize("guestUser");n.className="comment",n.setAttribute("role","listitem"),n.innerHTML=`<div class="comment-indent" role="presentation">\n<div class="user-icon ${l}" role="img" aria-label="Icon of user ${a}"></div>\n</div>\n<div class="comment-main" role="presentation">\n<div class="comment-header" role="presentation">\n    <div class="user-name" aria-label="User name">${o}</div>\n    <div class="time" aria-label="Comment time">${e.time?new Smart.Utilities.DateTime(e.time).toString(t.formatStringTime):""}</div>\n    <div class="remove-button${t._currentUser.info&&i.id===t._currentUser.info.id&&t._currentUser.allowComment?" enabled":""}" role="button" aria-haspopup="menu" aria-label="Comment settings"></div>\n</div>\n<div class="comment-body" aria-label="Comment text">${e.text||""}</div >\n</div>`,n.comment=e;const s=n.querySelector(".remove-button");return s.comment=e,s.element=n,n}_openDeleteRowDialog(e,t){const i=this;if(!i.editing.deleteDialog.enabled)return!1;const n=i._dialogDelete||i._createDialog(),l="{{message}}"===i.editing.dialog.header?i.localize("dialogDeleteHeader",{value:e.visibleIndex+1}):i.editing.dialog.header;n.header.innerHTML=l,n.content.innerHTML=i.localize("dialogDeleteContent"),n.row=e,i._dialogDelete||(n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogDeleteButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogDeleteButtonCancel"),n.onOpen=function(){i.editing.dialog.visible=!0},n.onClose=function(){i.editing.dialog.visible=!1},n.btnCancel.onclick=function(){n.close()},n.btnClose.onclick=function(){n.close()},n.btnConfirm.onclick=function(){t(n.row),n.close()},n.onkeydown=function(e){"Escape"===e.key&&n.close()},i._dialogDelete=n),n.open(),setTimeout((function(){n.btnConfirm.focus()}),100)}_getAddColumnDialogTemplate(){const e=this,t=(new Date).getFullYear().toString(),i=new Date(t,6,30);return[{bind:"name",type:"input",label:"Name",filter:"any",info:"Name of the column"},{bind:"type",name:"typeslist",type:"dropDownList",filter:"any",label:"Type",options:[{value:"string",prefix:'<span class="smart-grid-icon visible smart-icon-font"></span>',label:"Text"},{value:"multiText",prefix:'<span class="smart-grid-icon visible smart-icon-fontsize"></span>',label:"Multiline text"},{value:"image",prefix:'<span class="smart-grid-icon visible smart-icon-image"></span>',label:"Image"},{value:"number",prefix:'<span class="smart-grid-icon visible smart-icon-number"></span>',label:"Number"},{value:"option",prefix:'<span class="smart-grid-icon visible smart-icon-sort-down"></span>',label:"Select"},{value:"multiSelect",prefix:'<span class="smart-grid-icon visible smart-icon-list-unordered"></span>',label:"Multiple Select"},{value:"boolean",prefix:'<span class="smart-grid-icon visible smart-icon-check-squared"></span>',label:"CheckBox"},{value:"date",prefix:'<span class="smart-grid-icon visible smart-icon-calendar"></span>',label:"Date"},{value:"createdTime",prefix:'<span class="smart-grid-icon visible smart-icon-clock"></span>',label:"Created time"},{value:"modifiedTime",prefix:'<span class="smart-grid-icon visible smart-icon-clock"></span>',label:"Last modified time"},{value:"createdBy",prefix:'<span class="smart-grid-icon visible smart-icon-user"></span>',label:"Created by"},{value:"modifiedBy",prefix:'<span class="smart-grid-icon visible smart-icon-user"></span>',label:"Last modified by"},{value:"collaborator",prefix:'<span class="smart-grid-icon visible smart-icon-user"></span>',label:"Collaborator"},{value:"slider",prefix:'<span class="smart-grid-icon visible smart-icon-number"></span>',label:"Slider"},{value:"autoNumber",prefix:'<span class="smart-grid-icon visible smart-icon-list-ordered"></span>',label:"Auto Number"},{value:"url",prefix:'<span class="smart-grid-icon visible smart-icon-link"></span>',label:"URL"},{value:"email",prefix:'<span class="smart-grid-icon visible smart-icon-mail"></span>',label:"Email"}],info:'Type of the data in the column. Unlike a spreadsheet, Columns have specific "types" that allow you to store rich content in each record. For example, a table can contain records (rows) with images, long text notes, checkboxes, and links to records in another table. This article contains links to dive in more about Airtable fields.                 '},{bind:"dateFormat",name:"dateformat",type:"dropDownList",label:"Date format",options:[{value:"M/d/yyyy",label:"Short ("+new Smart.Utilities.DateTime(i).toString("d")+")"},{value:"dddd, MMMM dd, yyyy",label:"Long ("+new Smart.Utilities.DateTime(i).toString("D")+")"},{value:"yyyy-MM-ddTHH:mm:ss.sssZ",label:"ISO  ("+new Smart.Utilities.DateTime(i).toString("ISO8601")+")"},{value:"d/M/yyyy",label:"EU (30/7/"+t+")"},{value:"yyyy-MM-dd",label:"AS ("+t+"-30-07)"},{value:"MMMM, dd, yyyy",label:"Full (July, 30, "+t+")"}],filter:"date",info:"Choose the dates display format"},{bind:"timeFormat",name:"timeformat",type:"dropDownList",label:"Time format",filter:"time",width:"50%",options:[{value:"hh:mm",label:"12 hour"},{value:"HH:mm",label:"24 hour"}],info:"Choose the time display format"},{bind:"allowTimeFormat",type:"boolean",label:"Include a time field",filter:"date",value:!1,info:""},{bind:"allowCustomDateSeparator",type:"boolean",label:"Set a custom separator",filter:"date",value:!1,info:""},{bind:"dateFormatSeparator",name:"dateFormatSeparator",type:"radio",label:"",filter:"dateSeparator",columns:3,options:[{value:"/",label:"Slash (/)"},{value:"-",label:"Hyphen (-)"},{value:".",label:"Dot (.)"}]},{bind:"numberFormat",name:"numberFormat",type:"dropDownList",label:"Number Format",filter:"number",options:[{value:{style:"decimal",maximumFractionDigits:0},label:"Integer 1,000"},{value:{style:"decimal",minimumFractionDigits:2},label:"Number 1,000.12"},{value:{style:"percent",minimumFractionDigits:2},label:"Percent 10.12%"},{value:{style:"percent",maximumFractionDigits:0,minimumFractionDigits:0},label:"Percent(rounded) 10%"},{value:{style:"decimal",notation:"scientific"},label:"Scientific 1.01E+03"},{value:{style:"decimal",notation:"engineering"},label:"Engineering 34.284 x 10^9"},{value:{style:"currency",currency:e.messages[e.locale].calendar.currency,currencySign:"accounting"},label:"Accounting $(1,000.12)"},{value:{currencySign:"accounting"},label:"Financial (1,000.12)"},{value:{style:"currency",currency:e.messages[e.locale].calendar.currency},label:"Currency $1,000.12"},{value:{style:"currency",currency:e.messages[e.locale].calendar.currency,maximumFractionDigits:0,minimumFractionDigits:0},label:"Currency(rounded) $1,000"}],required:!1,info:"Choose the number display format"},{bind:"minLength",name:"minlength",width:"50%",type:"number",filter:"text",label:"Minimum length",required:!1,info:"Minimum text length"},{bind:"maxLength",name:"maxlength",width:"50%",filter:"text",type:"number",label:"Maximum length",required:!1,info:"Maximum text length"},{bind:"minValue",name:"minvalue",width:"50%",filter:"number",type:"number",label:"Minimum value",required:!1,info:"Minimum number"},{bind:"maxValue",name:"maxvalue",width:"50%",filter:"number",type:"number",label:"Maximum value",required:!1,info:"Maximum number"},{bind:"minDateTime",name:"mindatetime",type:"datetime",filter:"date",width:"50%",label:"Minimum date",info:"Minimum date"},{bind:"maxDateTime",name:"maxdatetime",type:"datetime",width:"50%",filter:"date",label:"Maximum date",info:"Maximum date"},{bind:"options",name:"listitems",type:"textArea",label:"List items",filter:"list",info:"Enter a list of items separated by comma"},{name:"align",bind:"cellsAlign",type:"dropDownList",label:"Align",required:!1,options:[{value:"left",label:"Left"},{value:"right",label:"Right"},{value:"center",label:"Center"}],filter:"any",info:"Cells text alignment"},{bind:"allowResize",type:"boolean",label:"Resizable",filter:"any",width:"50%",info:"Select if you want to make the column resizable"},{bind:"required",type:"boolean",label:"Required",width:"50%",filter:"text",info:"Select if you want to make the column required"},{bind:"allowSort",type:"boolean",label:"Sortable",width:"50%",filter:"any",info:"Select if you want to sort by this column"},{bind:"allowFilter",type:"boolean",label:"Filterable",align:"left",width:"50%",filter:"any",info:"Select if you want to filter by this column"},{bind:"allowEdit",type:"boolean",label:"Editable",width:"50%",filter:"any",info:"Select if you want to make the column editable"}]}_addColumnDialogShowHideEditors(){const e=this,t=e._dialogAddColumn.querySelector('[bind="type"]').querySelector("smart-input").getSelectedItem().value,i=e._dialogAddColumn.querySelectorAll(".smart-grid-dialog-editor");for(let n=0;n<i.length;n++){const l=i[n],a=l.getAttribute("filter"),o=l.getAttribute("bind"),s=l.parentNode;if(s.classList.add("smart-hidden"),"cellsAlign"!==o||"boolean"!==t&&"image"!==t)if("any"!==a)if("allowResize"!==o||"none"!==e.behavior.columnResizeMode)if("allowFilter"!==o||!1!==e.filtering.enabled)if("allowSort"!==o||!1!==e.sorting.enabled)if("allowEdit"!==o||!1!==e.editing.enabled)if("required"!==o||!1!==e.editing.enabled&&"boolean"!==t&&"image"!==t)switch(t){default:case"text":"text"===a&&s.classList.remove("smart-hidden");break;case"number":"number"===a&&s.classList.remove("smart-hidden");break;case"option":case"multioption":"list"===a&&s.classList.remove("smart-hidden");break;case"image":case"boolean":break;case"date":"date"===a&&s.classList.remove("smart-hidden"),"allowTimeFormat"===o&&(l.onchange=t=>{const i=e._dialogAddColumn.querySelector('[field-filter="time"]'),n=e._dialogAddColumn.querySelector('[field-name="dateFormat"]');t?(i.classList.remove("smart-hidden"),n.style.width="50%",n.style.float="left"):(i.classList.add("smart-hidden"),n.style.width="",n.style.float="")}),"allowCustomDateSeparator"===o&&(l.onchange=t=>{const i=e._dialogAddColumn.querySelector('[field-filter="dateSeparator"]');t?i.classList.remove("smart-hidden"):i.classList.add("smart-hidden")})}else s.classList.add("smart-hidden");else s.classList.add("smart-hidden");else s.classList.add("smart-hidden");else s.classList.add("smart-hidden");else s.classList.add("smart-hidden");else s.classList.remove("smart-hidden");else s.classList.add("smart-hidden")}}_addColumnDialogInitEditors(){const e=this,t=e._dialogAddColumn.editColumn;for(let i in e._addColumnDialogEditors){const n=e._addColumnDialogEditors[i],l=n.querySelector("input"),a=n.querySelector("smart-input");switch(i){case"allowResize":case"allowSort":case"allowEdit":case"allowFilter":case"required":{const e=n.querySelector(".smart-input");t?t[i]?(e.value=!0,e.setAttribute("checked","")):!1===t[i]&&(e.value=!1,e.removeAttribute("checked")):(e.value=!0,e.setAttribute("checked",""));break}}t&&"type"===i&&("number"===t.dataType||"int"===t.dataType?a.selectedIndex=3:"date"===t.dataType?a.selectedIndex=7:"bool"!==t.dataType&&"boolean"!==t.dataType||(a.selectedIndex=6)),"cellsAlign"===i&&t&&("center"===t.cellsAlign||"middle"===t.cellsAlign?a.selectedIndex=2:"right"===t.cellsAlign&&(a.selectedIndex=1)),l&&("dataField"!==i&&"type"!==i&&a&&(a.selectedIndex=0),"name"===i&&(a.value=t?t.label:""),"minValue"===i?l.value=0:"maxValue"===i?l.value=100:"minLength"===i?l.value=0:"maxLength"===i&&(l.value=500),"minDateTime"===i?n.querySelector("smart-date-input").value=new Date(1900,0,1):"maxDateTime"===i&&(n.querySelector("smart-date-input").value=new Date(2100,0,1)))}}_openAddColumnDialog(e){const t=this,i=t._dialogAddColumn||t._createDialog(t.editing.addColumnDialog),n=e?t.localize("dialogEditColumn",{value:e.label}):t.localize("dialogAddColumn"),l=i.querySelector(".smart-footer").querySelector(".smart-stack-layout");i.classList.add("smart-grid-dialog-add-column"),i.type=e?"customize":"add",i.editColumn=e||null,l.classList.remove("right"),l.classList.add("center"),t._cellEditors||(t._cellEditors=[]);const a=t._getAddColumnDialogTemplate();if(i.header.innerHTML=n,!t._dialogAddColumn){i.modal=!0,i.btnConfirm.innerHTML=t.localize("dialogEditButtonConfirm"),i.btnCancel.innerHTML=t.localize("dialogEditButtonCancel"),i.onOpen=function(){t._addColumnDialogInitEditors(),t._addColumnDialogShowHideEditors(),t.$.fireEvent("openColumnDialog",{dataField:i.editColumn?i.editColumn.dataField:null})},i.onClose=function(){},i.btnCancel.onclick=function(){i.close()},i.btnClose.onclick=function(){i.close()},i.btnConfirm.onclick=function(){const e=t._dialogAddColumn.querySelectorAll(".smart-grid-dialog-editor"),n=[];let l,a,o={};for(let t=0;t<e.length;t++){const i=e[t],n=i.querySelector(".smart-input"),l=i.getAttribute("bind");"minLength"!==l&&"maxLength"!==l&&"minValue"!==l&&"maxValue"!==l&&"minDateTime"!==l&&"maxDateTime"!==l?n.getSelectedItem?o[l]=n.getSelectedItem().value:o[l]=n.value:o[l]=n.getValue()}i.data=o;let s={},d={},r="";if(l=o.minDateTime,a=o.maxDateTime,"date"===o.type){s={template:"dateInput",min:l,max:a};let e=!1;"-"!==o.dateFormat&&(r=o.dateFormat,e=!0),"-"!==o.timeFormat&&(e&&(r+=" "),r+=o.timeFormat),n.push({type:"minDate",value:l}),n.push({type:"maxDate",value:a})}else"number"===o.type?(l=parseInt(o.minValue),a=parseInt(o.maxValue),s={template:"numberInput",min:l,max:a,numberFormat:o.numberFormat},d={Intl:{NumberFormat:o.numberFormat}},r="d",n.push({type:"min",value:l}),n.push({type:"max",value:a})):"boolean"===o.type?s={template:"checkBox"}:"image"===o.type?s={template:"image"}:"option"===o.type?s={template:"dropDownList",readonly:!0,dropDownButtonPosition:"right",autoOpen:!0,dataSource:o.options.split(",").map((e=>e.trim()))}:"multioption"===o.type?s={template:"multiInput",readonly:!0,dropDownButtonPosition:"right",autoOpen:!0,dataSource:o.options.split(",").map((e=>e.trim()))}:"multiText"===o.type?(l=o.minLength,a=o.maxLength,s={template:"textarea",min:l,max:a,required:o.required},n.push({type:"minLength",value:l}),n.push({type:"maxLength",value:a})):(l=o.minLength,a=o.maxLength,s={template:"input",min:l,max:a,required:o.required},n.push({type:"minLength",value:l}),n.push({type:"maxLength",value:a}));if(t._dialogAddColumn.editColumn){const e=t._dialogAddColumn.editColumn;e.canNotify=!1,e.label=o.name,e.allowResize=o.allowResize,e.allowSort=o.allowSort,e.allowFilter=o.allowFilter,e.allowEdit=o.allowEdit,e.align=e.cellsAlign=o.cellsAlign,e.cellsFormat=r,e.editor=s,e.formatSettings=d,o.required&&n.push({type:"required"}),e.validationRules=n,e.canNotify=!0,t.$.fireEvent("closeColumnDialog",{dataField:e.dataField}),t._recycle(!0)}else{const e=new Smart.Grid.Column({label:o.name,dataField:o.dataField||"dataField"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),allowResize:o.allowResize,allowSort:o.allowSort,allowFilter:o.allowFilter,allowEdit:o.allowEdit,dataType:o.type,editor:s,formatSettings:d,cellsAlign:o.cellsAlign,align:o.cellsAlign,cellsFormat:r,grid:t});"boolean"===o.type&&(e.template="checkBox"),"image"===o.type&&(e.template="image"),t.$.fireEvent("closeColumnDialog",{dataField:e.dataField}),t.columns.push(e)}i.close()},i.onkeydown=function(e){"Escape"===e.key&&i.close()},t._dialogAddColumn=i;const e=document.createElement("div");e.classList.add("smart-content-layout-container"),i.content.appendChild(e),t._addColumnDialogEditors=[];for(let i=0;i<a.length;i++){const n=a[i],l=document.createElement("div"),o=document.createElement("label");o.innerHTML=n.label;const s=document.createElement("div");if(s.classList.add("smart-grid-dialog-editor","add-column"),s.innerHTML="",s.setAttribute("filter",n.filter),s.setAttribute("bind",n.bind),l.setAttribute("field-name",n.bind),l.setAttribute("field-filter",n.filter),t._addColumnDialogEditors[n.bind]=s,"type"===n.bind&&s.addEventListener("change",(()=>{t._addColumnDialogShowHideEditors()})),"boolean"===n.type){s.setAttribute("template","checkBox"),s.setAttribute("editor","");const t=document.createElement("div");t.classList.add("smart-input"),t.classList.add("smart-grid-cell-editor"),t.classList.add("smart-grid-check-box-cell-editor"),t.setAttribute("checked",""),t.value=!0,n.width&&(l.style.width=n.width,l.style.float="left"),!1===n.value&&(t.value=!1,t.removeAttribute("checked")),s.appendChild(t),s.check=function(){t.setAttribute("checked",""),t.value=!0},s.uncheck=function(){t.removeAttribute("checked"),t.value=!1},s.toggle=function(){!0!==t.value&&!1!==t.value&&null!==t.value&&(t.value=!1),null===t.value?t.value=!1:t.value=!t.value,!1===t.value?t.removeAttribute("checked"):t.setAttribute("checked",t.value?"":"indeterminate"),s.onchange&&s.onchange(t.value)},s.onclick=o.onclick=()=>{s.toggle()},e.appendChild(l),l.classList.add("smart-grid-dialog-boolean-field"),l.appendChild(s),l.appendChild(o)}else{let t=document.createElement("smart-input");if(t.classList.add("underlined","edit-column-input"),t.style.width="100%",t.style.height="30px",n.width&&(l.style.width=n.width,l.style.float="left"),"textArea"===n.type)t=document.createElement("smart-text-area"),t.classList.add("outlined"),t.style.width="100%",t.style.height="80px",t.placeholder=n.label,s.style.height="80px";else if("number"===n.type)t=document.createElement("smart-number-input"),t.classList.add("underlined"),t.style.width="100%",t.style.height="30px","minValue"===n.bind?(t.value=0,t.min=-9999999,t.max=9999999):"maxValue"===n.bind?(t.value=1e6,t.min=-9999999,t.max=9999999):"minLength"===n.bind?t.value=0:"maxLength"===n.bind&&(t.value=500);else if("datetime"===n.type)t=document.createElement("smart-date-input"),t.classList.add("underlined"),t.style.width="100%",t.style.height="30px","minDateTime"===n.bind?t.value=new Date(1900,0,1):"maxDateTime"===n.bind&&(t.value=new Date(2100,0,1));else if("radio"===n.type){const e=(e,t,i)=>{const n=document.createElement("div"),l=document.createElement("label"),a=document.createElement("div");return l.innerHTML=e,a.classList.add("smart-input"),a.classList.add("smart-grid-cell-editor"),a.classList.add("smart-grid-check-box-cell-editor"),t&&a.setAttribute("checked",""),a.value=void 0!==t&&t,s.appendChild(a),n.onclick=function(){if(a.value=!0,!1===a.value?a.removeAttribute("checked"):a.setAttribute("checked",a.value?"":"indeterminate"),a.value){const e=a.parentElement.parentElement.parentElement;e.querySelectorAll(".smart-grid-cell-editor").forEach((e=>{e.value=!1,e.removeAttribute("checked")})),a.value=!0,a.setAttribute("checked",a.value?"":"indeterminate"),e.value=i}},n.appendChild(a),n.appendChild(l),n.classList.add("smart-grid-dialog-boolean-field"),n.setAttribute("template","checkBox"),n.setAttribute("editor",""),n},i=document.createElement("div");i.classList.add("smart-grid-dialog-radio-field"),s.classList.add("radio-group");for(let t=0;t<n.options.length;t++){const l=n.options[t],a=e(l.label,l.checked);if(n.columns){const e=100/n.columns;a.style.width=e+"%",a.style.float="left"}i.appendChild(a),l.checked&&(s.value=l.value)}const l=document.createElement("div");l.style.clear="both",i.appendChild(l),t=i}if(n.options&&(t.readonly=!0,t.dataSource=n.options,t.dropDownButtonPosition="right","dataField"!==n.bind&&(t.selectedIndex=0),n.options.length<15?t.dropDownHeight="auto":t.dropDownHeight=300),s.appendChild(t),n.info){const e=document.createElement("span");e.classList.add("smart-grid-icon","smart-icon-attention-circled","show","smart-description-button"),e.title=n.info,s.appendChild(e),t.style.width="calc(100% - 25px)"}if(e.appendChild(l),l.classList.add("smart-grid-dialog-field"),l.appendChild(o),l.appendChild(s),n.width&&!a[i+1].width){const t=document.createElement("div");t.style.clear="both",e.appendChild(t)}}}}if(e){const n=e.element,l=t.offset(n),a=t.offset(t);i.open(l.left-a.left,l.top+n.offsetHeight-a.top)}else i.open("middle","center");setTimeout((function(){i.btnConfirm.focus()}),100)}_openDescriptionDialog(e,t){const i=this,n=i._dialogDescription||i._createDialog(),l=i.localize("dialogDescriptionHeader",{value:e.label});if(n.header.innerHTML=l,n.column=e,n.command=t,!i._dialogDescription){n.modal=!0,n.btnConfirm.innerHTML=i.localize("dialogEditButtonConfirm"),n.btnCancel.innerHTML=i.localize("dialogEditButtonCancel"),n.onOpen=function(){const e=n.querySelector("smart-input");setTimeout((()=>{e.select()}),250)},n.onClose=function(){},n.btnCancel.onclick=function(){n.close()},n.btnClose.onclick=function(){n.close()},n.btnConfirm.onclick=function(){const t=n.querySelector("smart-input");let l=n.column.label;switch(n.command){case"rename":n.column.label=t.value;break;case"editDescription":l=n.column.description,n.column.description=t.value}i.$.fireEvent("endEdit",{dataField:e.dataField,column:e,oldValue:l,value:t.value,action:n.command}),n.close()},n.onkeydown=function(e){"Escape"===e.key&&n.close()},i._dialogDescription=n;const t=document.createElement("smart-input");t.classList.add("underlined"),n.content.appendChild(t)}const a=e.element,o=i.offset(a),s=i.offset(i);n.open(o.left-s.left,o.top+a.offsetHeight-s.top);const d=n.querySelector("smart-input");switch(t){case"rename":d.value=e.label;break;case"editDescription":d.value=e.description}setTimeout((function(){n.btnConfirm.focus()}),100)}});