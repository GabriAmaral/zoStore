
/* Smart UI v10.2.12 (2021-10-25) 
Copyright (c) 2011-2021 jQWidgets. 
License: https://htmlelements.com/license/ */ //

Smart("smart-gantt-chart",class extends Smart.ScrollViewer{static get properties(){return{adjustToNonworkingTime:{value:!1,type:"boolean"},autoSchedule:{value:!1,type:"boolean"},autoScheduleStrictMode:{value:!1,type:"boolean"},autoScrollStep:{value:5,type:"number"},columnMenu:{value:!1,type:"boolean"},columnMinWidth:{value:"50px",type:"any"},columnResize:{value:!1,type:"boolean"},columnResizeFeedback:{value:!1,type:"boolean"},dataExport:{value:{exportFiltered:{value:!1,type:"boolean"},itemType:{value:"task",type:"string"},fileName:{value:"smartGanttChart",type:"string?"}},type:"object"},dataSource:{value:[],type:"any",reflectToAttribute:!1},dayFormat:{value:"short",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},dateEnd:{value:"",type:"any",validator:"_dateValidator"},dateStart:{value:"",type:"any",validator:"_dateValidator"},disableAutoScroll:{value:!1,type:"boolean"},disableTaskDrag:{value:!1,type:"boolean"},disableTaskProgressChange:{value:!1,type:"boolean"},disableTaskResize:{value:!1,type:"boolean"},disableSelection:{value:!1,type:"boolean"},disableWindowEditor:{value:!1,type:"boolean"},durationUnit:{value:"milisecond",allowedValues:["day","week","hour","minute","second","milisecond"],type:"string"},filterRow:{value:!1,type:"boolean"},groupByResources:{value:!1,type:"boolean"},headerTemplate:{value:null,type:"any"},hourFormat:{value:"default",allowedValues:["default","2-digit","numeric"],type:"string"},hideTimelineHeaderDetails:{value:!1,type:"boolean"},hideResourcePanel:{value:!1,type:"boolean"},hideSelectionColumn:{value:!1,type:"boolean"},infiniteTimeline:{value:!1,type:"boolean"},infiniteTimelineStep:{value:5,type:"number"},inverted:{value:!1,type:"boolean"},keyboardNavigation:{value:!1,type:"boolean"},messages:{extend:!0,value:{en:{duplicateIds:"{{elementType}}: DataSource contains duplicate ids. Tasks should have unique ids. The following ids are duplicating: {{duplicates}}.",invalidNonworkingRange:"{{elementType}}: Invalid {{property}} value. {{property}} should not contain all possible days/hours because it will result in an endless timeline. The value has been validated by removing the last item from the new value range.",invalidValue:"{{elementType}}: Invalid {{property}} value. {{property}} should be of type {{typeOne}} or {{typeTwo}}.",incorrectArgument:"{{elementType}}: Incorrect argument {{argumentName}} in method {{methodName}}.",outOfBounds:"{{elementType}}: Out of bounds argument {{argumentName}} in method {{methodName}}.",missingReference:"{{elementType}}: Missing reference to {{file}} in method {{methodName}}.",alreadyExists:"{{elementType}}: The item already exists when calling the {{methodName}} method.",notExisting:"{{elementType}}: The item does not exists when calling the {{methodName}} method.",notAProject:"{{elementType}}: The {{argumentName}} argument in {{methodName}} method does not reference an item of type 'project'.",noId:"smartGanttChart requires an id in order to save/load/clear a state.",ok:"Ok",cancel:"Cancel",delete:"Delete",confirm:"{{componentName}} will be deleted permanently, <b>are you sure? </b>",taskColumnLabel:"Task Name",resourceColumnLabel:"Resource Name",deleteLink:"Delete link",unassigned:"Unassigned"}},type:"object"},monthFormat:{value:"short",allowedValues:["2-digit","numeric","long","short","narrow"],type:"string"},max:{value:new Date(2100,0,1),type:"any",validator:"_dateValidator"},min:{value:new Date(1900,0,1),type:"any",validator:"_dateValidator"},nonworkingDays:{value:[],type:"array",validator:"_nonworkingDayValidator"},nonworkingHours:{value:[],type:"array",validator:"_nonworkingTimeValidator"},popupWindowCustomizationFunction:{value:null,reflectToAttribute:!1,type:"function?"},progressLabelFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},resizeHandlesVisibility:{allowedValues:["auto","hidden","visible"],value:"auto",type:"string"},resourceColumns:{value:[{label:"resourceColumnLabel",value:"label"}],type:"array",reflectToAttribute:!1},resourceFiltering:{value:!1,type:"boolean"},resourceGroupFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},resourcePanelHeaderTemplate:{value:null,type:"any"},resourcePanelMin:{value:100,type:"any"},resourcePanelSize:{value:"",type:"any"},resourcePanelRefreshRate:{value:0,reflectToAttribute:!1,type:"number"},resourceTimelineFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},resourceTimelineMode:{allowedValues:["diagram","histogram","custom"],value:"diagram",type:"string"},resourceTimelineView:{allowedValues:["hours","tasks","custom"],value:"hours",type:"string"},selectedTaskIds:{value:[],type:"array"},selectedResourceIds:{value:[],type:"array"},showProgressLabel:{value:!1,type:"boolean"},snapToNearest:{value:!1,type:"boolean"},sortFunction:{value:null,type:"function?",reflectToAttribute:!1},sortMode:{value:"none",allowedValues:["none","one","many"],type:"string"},taskColumns:{value:[{label:"taskColumnLabel",value:"label"}],type:"array",reflectToAttribute:!1},taskFiltering:{value:!1,type:"boolean"},taskPanelMin:{value:200,type:"any"},taskPanelSize:{value:"",type:"any"},timelineMin:{value:200,type:"any"},treeMin:{value:100,type:"any"},treeSize:{value:"20%",type:"any"},timelineHeaderFormatFunction:{value:null,reflectToAttribute:!1,type:"function?"},verticalScrollBarVisibility:{type:"string",value:"auto",allowedValues:["auto","disabled","hidden","visible"]},view:{value:"year",allowedValues:["day","week","month","year"],type:"any"},yearFormat:{value:"numeric",allowedValues:["2-digit","numeric"],type:"string"},weekFormat:{value:"long",allowedValues:["long","numeric"],type:"string"}}}template(){return'<div id="container" role="presentation">\n                    <smart-splitter id="mainSplitter" auto-fit-mode="end" keep-proportions-on-resize right-to-left="[[rightToLeft]]" animation="[[animation]]" orientation="horizontal">\n                        <smart-splitter-item id="taskSplitterItem" class="smart-task-splitter-item">\n                            <div id="taskSplitterItemHeader" class="smart-task-panel-header"></div>\n                            <smart-splitter id="taskSplitter" class="smart-task-splitter" auto-fit-mode="end">\n                                 <smart-splitter-item id="tableSplitterItem">\n                                    <smart-table wait id="taskTable" class="smart-task-table" virtualization animation="none" deferred-scroll-delay="0" ></smart-table>\n                                </smart-splitter-item>\n                                <smart-splitter-item id="timelineSplitterItem" class="smart-timeline-splitter-item">\n                                        <div id="timeline" class="smart-timeline">\n                                            <div id="timelineHeader" class="smart-timeline-header" role="rowgroup">\n                                                <div id="timelineHeaderContent" class="smart-timeline-header-content">\n                                                    <div class="smart-timeline-view-details" id="timelineViewDetails" role="row"></div>\n                                                    <div class="smart-timeline-view-cells" id="timelineViewCells" role="row"></div>\n                                                </div>\n                                            </div>\n                                            <div id="taskTimelineContainer" class="smart-timeline-content-container">\n                                                <div id="timelineContent" class="smart-timeline-content">\n                                                    <div id="taskTimelineCellsContainer" class="smart-timeline-cells-container" aria-hidden="true"></div>\n                                                    <div id="timelineConnectionsContainer" class="smart-timeline-connections-container" role="group"></div>\n                                                    <div id="timelineTasksContainer" class="smart-timeline-tasks-container" role="group"></div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                        <smart-scroll-bar id="verticalScrollBar" class="smart-timeline-scroll-bar" orientation="vertical"\n                                                right-to-left="[[rightToLeft]]" aria-controls="[[id]]">\n                                        </smart-scroll-bar>\n                                </smart-splitter-item>\n                            </smart-splitter>\n                        </smart-splitter-item>\n                    </smart-splitter>\n                    <smart-scroll-bar wait id="horizontalScrollBar" class="smart-timeline-scroll-bar"></smart-scroll-bar>\n                </div>'}static get listeners(){return{down:"_downHandler","document.move":"_documentMoveHandler","document.up":"_documentUpHandler","document.dragstart":"_dragStartHandler","container.wheel":"_mouseWheelHandler","horizontalScrollBar.change":"_horizontalScrollbarHandler","verticalScrollBar.change":"_verticalScrollbarHandler","resourceVerticalScrollBar.change":"_verticalScrollbarHandler","mainSplitter.resizeEnd":"_resizeEventHandler","mainSplitter.resize":"_resizeEventHandler",move:"_moveHandler","mainSplitter.change":"_tableChangeHandler","mainSplitter.filter":"_tableSortFilterHandler","mainSplitter.sort":"_tableSortFilterHandler","mainSplitter.columnResize":"_tableColumnResizeHandler","taskTable.group":"_taskTableGroupEventHandler","taskTable.collapse":"_taskTableExpandHandler","taskTable.expand":"_taskTableExpandHandler","taskTable.keydown":"_taskTableKeyDownHandler"}}static get styleUrls(){return["smart.ganttchart.css"]}attached(){const e=this;if(super.attached(),e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e.$.taskSplitterItem,e.$.horizontalScrollBar,e.$.verticalScrollBar)),!e._resourceScrollView&&e.$.mainSplitter.contains(e.$.resourceSplitter)&&(e._resourceScrollView=new Smart.Utilities.Scroll(e.$.resourceSplitterItem,e.$.horizontalScrollBar,e.$.resourceVerticalScrollBar)),e.scrollLeft){const t=e._getScrollLeft(e.scrollLeft);e.$.timelineHeader.scrollLeft=e.$.taskTimelineContainer.scrollLeft=t,e.$.mainSplitter.contains(e.$.resourceTimelineHeader)&&(e.$.resourceTimelineHeader.scrollLeft=e.$.resourceTimelineContent.scrollLeft=t)}if(e.scrollTop){const t=e.scrollTop;e.$.taskTimelineContainer.scrollTop=t,e.$.timelineContent.scrollTop=t,e.$.mainSplitter.contains(e.$.resourceTimelineHeader)&&(e.$.resourceTimelineContent.scrollTop=t)}const t=["taskPopupWindow","connectionPopupWindow","confirmPopupWindow"];for(let i=0;i<t.length;i++){const r=t[i];e.$[r]&&e.$[r].opened&&(e._handleModal(!0),e["$"+r].listen("close",e._popupWindowCloseHandler.bind(e)),e["$"+r].listen("closing",e._popupWindowClosingHandler.bind(e)),e["$"+r].listen("open",e._popupWindowOpenHandler.bind(e)),e["$"+r].listen("click",e._popupWindowClickHandler.bind(e)),e["$"+r].listen("transitionend",e._popupWindowTransitionendHandler.bind(e)),e.getShadowRootOrBody().appendChild(e.$[r]))}}detached(){const e=this;super.detached(),e._scrollView&&(e._scrollView.unlisten(),delete e._scrollView),e._resourceScrollView&&(e._resourceScrollView.unlisten(),delete e._resourceScrollView);const t=["taskPopupWindow","connectionPopupWindow","confirmPopupWindow"];e._handleModal();for(let i=0;i<t.length;i++){const r=t[i],n=e["$"+r];e.$[r]&&e.$[r].remove(),n&&(n.unlisten("open"),n.unlisten("close"),n.unlisten("closing"),n.unlisten("click"),n.unlisten("transitionend"))}}propertyChangedHandler(e,t,i){const r=this;switch(e){case"adjustToNonworkingTime":for(let e=0;e<r._tasks.length;e++){const t=r._tasks[e],i=t.$.project;r._validateTaskDates(t,i),r._synchronizeProjectDates(t,i),r._refreshTableColumnsData(t,["dateEnd","duration"])}r._refreshTimeline();break;case"animation":break;case"autoSchedule":i?r._autoSchedule():r._autoScheduleRestore();break;case"autoScheduleStrictMode":i&&(r._autoSchedule(),r._refreshTimeline());break;case"columnMinWidth":case"columnResizeFeedback":case"columnResize":{const t=r.$.taskTable,n=r.$.resourceTable;t[e]=i,n&&(n[e]=i);break}case"dataSource":r.scrollLeft=r.scrollTop=0,r._createTasks(),r._refreshTableDataSource(),r._createTimeline(),r._createResourceTimeline(),r._setAriaControls();break;case"disableSelection":i?(r.$.taskTree.selectionMode="none",r.$.resourceTree.selectionMode="none",r._unselectAll("task"),r._unselectAll("resource")):(r.$.taskTree.selectionMode="zeroOrOne",r.$.resourceTree.selectionMode="zeroOrOne");break;case"durationUnit":for(let e=0;e<r._tasks.length;e++){const t=r._tasks[e],i=t.$.project;r._validateTaskDuration(t),r._validateTaskDates(t,i),r._synchronizeProjectDates(t,i)}r._createTimelineCells(),r._insertTimelineTasks(),r.taskColumns.some((e=>(e.value+"").toLowerCase().indexOf("duration")>-1))&&r._refreshTableDataSource();break;case"filterRow":r.$.taskTable[e]=i;break;case"groupByResources":r._setTable(r.$.taskTable),r._createTimelineContent(),r._recycleTimelineTasks(),r._refresh();break;case"infiniteTimeline":i?r._scrollView.hScrollBar.value===r._scrollView.hScrollBar.max&&r._handleInfiniteTimeline():r.set("dateEnd","");break;case"keyboardNavigation":r.$.taskTable[e]=i,r.$.resourceTable&&(r.$.resourceTable[e]=i);break;case"taskFiltering":r.$.taskTable.filtering=i,r._refresh();break;case"resourceFiltering":{const e=r.$.resourceTable;e&&(e.filtering=i,r._refresh());break}case"headerTemplate":r._handleHeaderTemplate();break;case"inverted":if(r._handleInverted(),r.scrollLeft){const e=r._getScrollLeft(r.scrollLeft);r.$.timelineHeader.scrollLeft=r.$.taskTimelineContainer.scrollLeft=e,r.$.mainSplitter.contains(r.$.resourceTimelineHeader)&&(r.$.resourceTimelineHeader.scrollLeft=r.$.resourceTimelineContent.scrollLeft=e)}break;case"rightToLeft":Array.from(r.querySelectorAll("smart-splitter, smart-table, smart-scroll-bar")).forEach((t=>t[e]=i)),r.closeWindow(),r._handleInverted(),r._refreshTimeline();break;case"dateStart":case"dateEnd":r._refreshTimeline();break;case"messages":case"locale":case"dayFormat":case"hourFormat":case"timelineHeaderFormatFunction":case"monthFormat":case"yearFormat":r._refreshHeaderDate(!0),r._refreshColumnsHeaders(),r._recycleResourceHeaderCells();break;case"hideResourcePanel":r._createResourceTimeline(),r._refreshTimeline();break;case"nonworkingDays":case"nonworkingHours":r._refreshAfterWorkingTimeChange();break;case"selectedTaskIds":r.$.taskTable.selected=r._getSelection("task",i);break;case"selectedResourceIds":r.$.resourceTable&&(r.$.resourceTable.selected=r._getSelection("resource",i));break;case"resourceColumns":r._setTable(r.$.resourceTable),r._highlightAssignedItem("task",r._getSelection("task",r.selectedTaskIds));break;case"resourcePanelHeaderTemplate":r._handleHeaderTemplate("resource");break;case"resourceTimelineView":case"resourceTimelineMode":case"resourceTimelineFormatFunction":r.$.mainSplitter.contains(r.$.resourceSplitter)&&r._resources.forEach((e=>r._refreshResourceTimelineContent(e)));break;case"showProgressLabel":case"progressLabelFormatFunction":r._tasks.forEach((e=>r._setTaskBarProgress(e)));break;case"sortFunction":r.$.taskTable.sort=i,r.$.resourceTable&&(r.$.resourceTable.sort=i);break;case"columnMenu":case"hideSelectionColumn":case"sortMode":r.$.taskTable[e]=i,r.$.resourceTable&&(r.$.resourceTable[e]=i);break;case"taskColumns":r._setTable(r.$.taskTable);break;case"timelineMin":r.$.timelineSplitterItem.min=i,r.$.taskSplitter.refresh(),r.$.mainSplitter.contains(r.$.resourceSplitter)&&r._synchronizeSplitters(r.$.taskSplitter,r.$.resourceSplitter);break;case"treeMin":case"treeSize":{const t=e.toLowerCase().indexOf("size")>-1?"size":"min";r.$.tableSplitterItem[t]=i,r.$.taskSplitter.refresh(),r.$.mainSplitter.contains(r.$.resourceSplitter)&&r._synchronizeSplitters(r.$.taskSplitter,r.$.resourceSplitter);break}case"taskPanelMin":case"taskPanelSize":case"resourcePanelSize":case"resourcePanelMin":{const t=e.indexOf("Min")>-1?"min":"size",n=e.indexOf("resource")>-1?"resource":"task";r.$.mainSplitter.contains(r.$.resourceSplitter)&&(r.$[`${n}SplitterItem`][t]=i,r.$.taskSplitterItem._setSize("size",r.taskPanelSize),r.refresh());break}case"unfocusable":r._setFocusable();break;case"view":r._refreshTimeline(t);break;default:super.propertyChangedHandler(e,t,i)}}_predefPropertyGetter(e){const t=this;Object.defineProperty(t,e,{get:function(){switch(e){case"dataSource":{if(t.context===t)return t.properties[e].value;const i=function(e){if(!e.length)return e;for(let r=0;r<e.length;r++){const n=e[r];let s=t._getProjectTasks(n);s&&Array.isArray(s)&&(s=i(s.filter((e=>e.$&&e.$.project===n)))),e[r]=t._cloneObject(n),s&&s.length?e[r].tasks=s:delete e[r].tasks}return e},r=t.properties[e].value;return r instanceof Smart.DataAdapter?r:i(r.slice(0))}case"dateStart":case"dateEnd":{const i=t._timelineCells;if(i.length){const r=t._getCellDateRange({_date:i["dateStart"===e?0:i.length-1].date});return new Date(r[e])}return t.properties[e].value}default:return t.properties[e].value}},set(i){t.updateProperty(t,t._properties[e],i)}})}ready(){this._customScrollView=!0,super.ready()}render(){const e=this,t=Smart.Utilities.Core;e._isMobile=t.isMobile,e._isFirefox=t.Firefox,e._predefPropertyGetter("dataSource"),e._predefPropertyGetter("dateStart"),e._predefPropertyGetter("dateEnd"),e.$.tableSplitterItem.size=e.treeSize,e.$.tableSplitterItem.min=e.treeMin,e.$.timelineSplitterItem.min=e.timelineMin,e._setScrollBars(),e._handleHeaderTemplate(),e._handleInverted(!0),e._createTasks(),e._setTable(),e._createTimeline(),e._createResourceTimeline(),e._setAriaControls(),e._setFocusable(),e.checkLicense(),(e.shadowRoot||e._isFirefox)&&requestAnimationFrame((()=>e.refresh())),super.render()}refresh(e){const t=this;if(e)return t._refreshTimeline(),t._setTable(t.$.taskTable),void t._createResourceTimeline();t.isRendered&&t._resizeEventHandler()}addFilter(e,t){const i=this;if(!i.taskFiltering&&!i.resourceFiltering||!(t instanceof Smart.Utilities.FilterGroup))return;Array.isArray(e)||(e="object"==typeof e?[e]:[]);const r=i.taskColumns,n=i.resourceColumns,s=i.$.taskTable,a=i.$.resourceTable;for(let i=0;i<e.length;i++){const o=e[i],l=o.type,[c,d]="resource"===l||n.includes(o)?[a,n]:[s,r],m=d.find((e=>o.value&&e.value===o.value));m&&c.addFilter(m.value,t)}}clearSelection(){this._unselectAll("task"),this._unselectAll("resource")}static get requires(){return{"Smart.Splitter":"smart.splitter.js","Smart.Tree":"smart.tree.js","Smart.Window":"smart.window.js"}}ensureVisible(e,t="task"){const i=this,r=i._getValidItemAndIndex(e,t);(e=r?r.item:void 0)&&(i._ensureVisible(e,t),i._scrollTo(e.dateStart,!0))}removeAllConnections(){const e=this;e.isCompleted&&(e.$.timelineConnectionsContainer.innerHTML="",e._connections=[],e._tasks.map((e=>e.connections=[])))}removeConnection(){const e=this,t=Array.from(arguments).filter((e=>void 0!==e));if(!e.isCompleted)return;let i;if(1===t.length){if("string"==typeof t[0]){const e=document.getElementById(t[0]);e&&(i=e.getAttribute("connection-id"))}i||(i=(t[0]+"").split("-"),i=e._getValidConnectionId(i[0],i[1],i[2],"removeConnection"))}else 3===t.length&&(i=e._getValidConnectionId(t[0],t[1],t[2],"removeConnection"));i&&(e._removeConnection(i),e.$.fireEvent("itemRemove",{type:"connection",id:`${i[0]}-${i[1]}-${i[2]}`,item:{source:i[0],target:i[1],type:i[2]}}))}removeTaskConnection(e,t){const i=this;if(!i.isCompleted)return;if((e+="").indexOf("-")>-1&&!t){const i=e.split("-");t=i[1],e=i[0]}const r=i._getValidItemAndIndex(e),n=i._getValidItemAndIndex(t);e=r?r.index:void 0,t=n?n.index:void 0,isNaN(e)?i.error(i.localize("incorrectArgument",{elementType:i.nodeName.toLowerCase(),methodName:"removeTaskConnection",argumentName:"taskEndIndex"})):i._removeConnection(""+e+(isNaN(t)?"":t))}beginUpdate(){this._isUpdating={started:!0,type:{}},this.$.fireEvent("beginUpdate")}endUpdate(){const e=this;function t(){e._refreshTableDataSource(),e._createTimelineContent(),e._recycleTimelineTasks(),e._setAriaControls();const t=e._resources;for(let i=0;i<t.length;i++)e._refreshTableColumnsData(t[i],void 0,"resource")}function i(){if(e.hideResourcePanel)return;e._refreshTableDataSource("resource"),e._recycleResourceHeaderCells(),e._createResourceTimelineContent(),e._refresh();const t=e._tasks;for(let i=0;i<t.length;i++)e._refreshTableColumnsData(t[i])}if(!e._isUpdating)return;const r=1===Object.keys(e._isUpdating.type).length?Object.keys(e._isUpdating.type)[0]:void 0;let n,s;switch(e._selected&&({task:n,resource:s}=e._selected),delete e._isUpdating,r){case"task":t();break;case"resource":i();break;default:t(),i()}n&&(e._refreshSelectedItems("task",n),e.$.taskTable.selected=e._getSelection("task",e.selectedTaskIds)),s&&(e._refreshSelectedItems("resource",s),e.$.resourceTable.selected=e._getSelection("resource",e.selectedResourceIds)),e.$.fireEvent("endUpdate")}clearFilters(e){this._resetFromAction(e,"clearFilters")}clearSort(e){const t=this;"task"!==e&&"resource"!==e?(t._resetFromAction("task","clearSort"),t._resetFromAction("resource","clearSort")):t._resetFromAction(e,"clearSort")}clearTasks(){this._clearTasks()}_clearTasks(){const e=this;e._selected&&delete e._selected.task,e.set("selectedTaskIds",[]),e._tasks=[],e._timelineCells=[],e._timelineVCells=[],e._timelineHeaderCells=[],e.$.timelineContent.style.width="",e.$.container.style.removeProperty("--smart-gantt-chart-task-timeline-content-height"),e.$.timelineViewDetails.innerHTML="",e.$.timelineViewCells.innerHTML="",e.$.taskTimelineCellsContainer.innerHTML="",e.$.timelineConnectionsContainer.innerHTML="",e.$.timelineTasksContainer.innerHTML="",e.$.timelineContent.style.height="",delete e._hoveredItem,e.$.taskTable.dataSource=[],e._refresh()}clearResources(){const e=this;e._unselectAll("resource"),e._resources=[],e.$.resourceTable&&(e.$.resourceTable.dataSource=[]),e.$.resourceTimelineCellsContainer.innerHTML="",e._tasks.forEach((t=>{t.resources=[],e._refreshTableColumnsData(t,["resources"])})),e._refreshTimeline(),e._createResourceTimeline()}createConnection(){const e=this,t=e._tasks;let i,r=Array.from(arguments).filter((e=>void 0!==e));if(!e.isCompleted||0===t.length)return;if(i=1===r.length?(r[0]+"").split("-"):r,!e._getValidConnectionId(i[0],i[1],i[2],"createConnection"))return;const n=parseInt(i[3]);e._connectTask([i[0],i[1],i[2],isNaN(n)?0:n]),e._recycleConnections(),e.$.fireEvent("itemInsert",{type:"connection",item:{source:i[0],target:i[1],type:i[2],lag:n}})}collapse(e){this._handleCollapseExpandMethods(e,"collapse")}expand(e){this._handleCollapseExpandMethods(e,"expand")}exportData(e,t){const i=this;if(!Smart.Utilities.DataExporter)return void i.error(i.localize("missingReference",{elementType:i.nodeName.toLowerCase(),methodName:"exportData",file:"smart.export.js"}));try{new JSZip}catch(e){return void i.error(i.localize("missingReference",{elementType:i.nodeName.toLowerCase(),methodName:"exportData",file:"jszip.min.js"}))}if("pdf"===e&!window.pdfMake)return void i.error(i.localize("missingReference",{elementType:i.nodeName.toLowerCase(),methodName:"exportData",file:"pdfMake.min.js"}));const r="task"===i.dataExport.itemType?i.$.taskTable:i.$.resourceTable;return r?r.exportData(e,i.dataExport.fileName,i.dataExport.exportFiltered,t):void 0}print(){const e=this,t=e.dataExport.fileName;e.dataExport.fileName=null;const i=e.exportData("html"),r=window.open("","","width=800,height=500"),n=r.document.open(),s='<!DOCTYPE html><html><head><meta charset="utf-8" /><title>'+t+"</title></head><body>"+i+"</body></html>";try{n.write(s),n.close(),setTimeout((function(){r.print(),r.close()}),100)}catch(e){}e.dataExport.fileName=t}getConnectionDetails(e){const t=this;if("string"!=typeof e)return;const i=t._getConnectionObjById(e);if(!i)return;const r=i.startTask,n=i.endTask;return{startTask:t._cloneObject(i.startTask),endTask:t._cloneObject(i.endTask),startTaskId:"string"==typeof r.id||"number"==typeof r.id?r.id:r.$.id,endTaskId:"string"==typeof n.id||"number"==typeof n.id?n.id:n.$.id,type:i.type}}getConnections(){const e=this;return e._connections.map((t=>{const i=t.startTask,r=t.endTask;return{id:t.startIndex+"-"+t.endIndex+"-"+t.type,startTask:e._cloneObject(i),endTask:e._cloneObject(r),startIndex:t.startIndex,startTaskId:"string"==typeof i.id||"number"==typeof i.id?i.id:i.$.id,endTaskId:"string"==typeof r.id||"number"==typeof r.id?r.id:r.$.id,endIndex:t.endIndex,type:t.type,lag:t.lag}}))}getState(){const e=this,t=e._getTasksJSON(!0)||[];return{tasks:JSON.parse(JSON.stringify(t)),selectedTaskIds:e.selectedTaskIds.slice(0),resources:JSON.parse(JSON.stringify(e._resources.slice(0))),scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}get tasks(){return this.isReady?this.getTasks():[]}get resources(){return this.isReady?this.getResources():[]}getTask(e){const t=this,i=t._getValidItemAndIndex(e);if(i.item)return t._cloneObject(i.item)}getTasks(){const e=this,t=e._tasks;return e.isReady&&t&&t.length?t.map((t=>e._cloneObject(t))):[]}getResource(e){const t=this,i=t._getValidItemAndIndex(e,"resource");if(i.item)return t._cloneObject(i.item)}getResources(){const e=this,t=e._resources;return e.isReady&&t&&t.length?t.map((t=>e._cloneObject(t))):[]}getItemPath(e){if(!e||void 0===e.type)return;const t="string"==typeof e.type?"task":"resource",i=this._getValidItemAndIndex(e,t);return i.item?i.item.$.id:void 0}getTaskIndex(e){return this._getItemIndex(e,"task")}getTaskProject(e){const t=this;if((e=t._tasks[t._getItemIndex(e,"task")])&&e.$&&e.$.project)return t._cloneObject(e.$.project)}getTaskConnections(e){const t=this._getValidItemAndIndex(e,"task");return t&&t.item?this._getTaskConnections(t.item).taskConnections.map((e=>({target:e.endIndex,type:e.type,lag:e.lag}))):[]}getResourceIndex(e){return this._getItemIndex(e,"resource")}getResourceTasks(e){const t=this._getValidItemAndIndex(e,"resource");if(e=t?t.item:void 0)return this._getTasksAssigned(e)}getSelectedIds(){const e=this,t=e.selectedTaskIds,i=e.selectedResourceIds;return e.disableSelection||!t.length&&!i.length?null:{task:t.slice(),resources:i.slice()}}getSelectedTasks(){return this._getSelectedItems("task")}getSelectedResources(){return this._getSelectedItems("resource")}getWorkingHours(){const e=this.nonworkingHours;let t=[];for(let i=0,r=23;i<r;i+=1)e.indexOf(i)<0&&t.push(i);return t}isWorkingDay(e){return e=new Date(e),!isNaN(e.getTime())&&this.nonworkingDays.indexOf(e.getDay())<0}clearState(){const e=this;e.id?window.localStorage.removeItem("smartGanttChart"+e.id):e.warn(e.localize("noId"))}loadState(e){const t=this;if(!e){if(!t.id)return;e=JSON.parse(window.localStorage.getItem("smartGanttChart"+t.id))}if(!e)return;let i=JSON.stringify(e.tasks),r=JSON.stringify(e.selectedTaskIds),n=JSON.stringify(e.resources);if(i&&(i=JSON.parse(i)),r&&(r=JSON.parse(r)),n&&(n=JSON.parse(n)),t._noChangeEvent=!0,Array.isArray(i)&&(t._createTasks(i),t.set("dataSource",i)),Array.isArray(n)){let e=n;for(let i=0;i<e.length;i++){const e=n[i];let r=t._resources.find((t=>t.id&&t.id.toString()===e.id.toString()))||{};t._setResource(r,e),Object.values(r).length&&!t._resources.includes(r)&&t._resources.push(r)}t._refreshItemIds("resource")}"number"==typeof e.scrollLeft&&(t.scrollLeft=e.scrollLeft),"number"==typeof e.scrollTop&&(t.scrollTop=e.scrollTop),t._setTable(t.$.taskTable),t._createTimeline(),t._createResourceTimeline(),Array.isArray(r)&&(t.$.taskTable.selected=t._getSelection("task",r)),delete t._noChangeEvent}saveState(){const e=this;e.id?window.localStorage.setItem("smartGanttChart"+e.id,JSON.stringify(e.getState())):e.warn(e.localize("noId"))}insertTask(e,t,i){const r=this;if("object"!=typeof e)return void r.error(r.localize("incorrectArgument",{elementType:r.nodeName.toLowerCase(),methodName:"insertTask",argumentName:"newTask"}));const n=r._tasks;if(n.indexOf(e)>-1)return void r.error(r.localize("alreadyExists",{elementType:r.nodeName.toLowerCase(),methodName:"insertTask"}));const s=r._createTasks([e],!0);if(!n)return;let a,o,l;const c=r._getSelection("task",r.selectedTaskIds);if("string"==typeof i&&i.indexOf(!1)){const e=i.split(".");i=parseInt(e.slice(-1)),null==t&&(t=e.slice(0,-1).join("."))}if("string"==typeof t?(a=n.find((e=>e.id&&e.id.toString()===t)),a||(a=r._getItemByTableId("task",t))):"number"==typeof t&&(a=n[t]),a){if("project"!==a.type)return void r.error(r.localize("notAProject",{elementType:r.nodeName.toLowerCase(),argumentName:"project",methodName:"insertTask"}));s[0].$.project=a}return r._synchronizeProjectVisibility(s[0].$.project,s[0]),r._insertTasks(s,a,i),r._refreshItemIds(),r._refreshConnectionIds(),r._isUpdating?(r._isUpdating.type.task=!0,void(r._isUpdating.type.resource=!0)):(r._selected&&r._selected.task&&r._setSelection("task",l=r._selected.task.map((e=>e.$.id))),r._refreshTableDataSource(),r._refreshTimeline(),l&&c.toString()!==l.toString()&&(r.$.taskTable.selected=l.slice(0)),r._refreshTaskResources(o),r._ensureVisible(o),r.$.fireEvent("itemInsert",{type:"task",item:r._cloneObject(s[0])}),s[0].id||s[0].$.id+"")}openWindow(e){const t=this;if(t.disableWindowEditor)return;if("string"==typeof e){if(e.indexOf(".")>-1){const i=t._getVCellById("task",e),r=i?i.task:void 0;return void(r&&t._openPopupWindow(r))}if(e.indexOf("-")>-1){let e=(arguments[0]+"").split("-");if(e=t._getValidConnectionId(e[0],e[1],e[2],"openEditor"),e)return void t._openPopupWindow(e)}}const i=t._getValidItemAndIndex(e);i&&t._openPopupWindow(i.item)}closeWindow(){const e=this,t=["confirm","task","connection"];for(let i=0;i<t.length;i++){const r=e.$[t[i]+"PopupWindow"];r&&(r.close(),delete r._target)}}updateTask(e,t){const i=this,r=i._getValidItemAndIndex(e),n=r?r.item:void 0;"object"==typeof n?"object"==typeof t?i._updateTask(n,t):i.error(i.localize("incorrectArgument",{elementType:i.nodeName.toLowerCase(),methodName:"updateTask",argumentName:"taskDetails"})):i.error(i.localize("notExisting",{elementType:i.nodeName.toLowerCase(),methodName:"updateTask",argumentName:"newTask"}))}removeTask(e){const t=this,i=t._tasks,r=t._getValidItemAndIndex(e),n=r?r.item:void 0;i&&i.length&&("object"==typeof n?t._removeTask(n):t.error(t.localize("notExisting",{elementType:t.nodeName.toLowerCase(),methodName:"removeTask",argumentName:"index"})))}setWorkTime(e){this._setWorkTime(e,(function(e,t){for(let i=0,r=e.length;i<r;i+=1){const r=parseInt(e[i]),n=t.indexOf(r);n>-1&&t.splice(n,1)}return t}))}selectTask(e){this._handleItemSelection(e,"task")}selectResource(e){const t=this;t.$.mainSplitter.contains(t.$.resourceTable)&&t._handleItemSelection(e,"resource")}sort(e){const t=this;if("none"===t.sortMode)return;Array.isArray(e)||(e="object"==typeof e?[e]:[]);const i=t.taskColumns,r=t.resourceColumns,n=t.$.taskTable,s=t.$.resourceTable;for(let t=0;t<e.length;t++){const a=e[t],o="desc"===a.sortOrder?"desc":"asc",[l,c]="resource"===a.type||r.includes(a)?[s,r]:[n,i],d=c.find((e=>a.value&&e.value===a.value));d&&l.sortBy(d.value,o)}}unselectTask(e){this._handleItemSelection(e,"task",!0)}unselectResource(e){const t=this;t.$.mainSplitter.contains(t.$.resourceTable)&&t._handleItemSelection(e,"resource",!0)}unsetWorkTime(e){this._setWorkTime(e,(function(e,t){for(let i=0,r=e.length;i<r;i+=1){const r=parseInt(e[i]);t.indexOf(r)<0&&t.push(r)}return t}),!0)}_getSelectedItems(e="task"){const t=this,i=t[`_${e}s`],r=t._getSelection(e,"task"===e?t.selectedTaskIds:t.selectedResourceIds);if(!r.length)return[];let n=[];for(let e=0,s=i.length;e<s;e+=1){const s=i[e];r.indexOf(s.$.id)>-1&&n.push(t._cloneObject(s))}return n}_getTasksAssigned(e){const t=this,i=t._tasks||[];let r=[];for(let n=0;n<i.length;n++){const s=i[n];!s.disableResources&&s.resources.find((t=>t===e.id))&&r.push(t._cloneObject(s))}return r}_getItemIndex(e,t){t||(t="task");const i=this[`_${t}s`];if(e instanceof HTMLElement&&e.classList.contains("smart-timeline-task"))return i.indexOf(e._cellObj[`_${t}`]);const r="resource"===t?["id","label","value","progress"]:["id","label","type","class","dateStart","dateEnd","resources","connections"];if("object"==typeof e)for(let t=0;t<i.length;t++)if(r.every((r=>Array.isArray(e[r])?JSON.stringify(e[r])===JSON.stringify(i[t][r]):r.indexOf("date")>-1?new Date(e[r]).getTime()===new Date(i[t][r]).getTime():e[r]===i[t][r])))return i.indexOf(i[t]);return-1}_handleItemSelection(e,t="task",i){const r=this,n=r._getValidItemAndIndex(e,t);if(n.item){const s=n.item,a=r._getSelection(t,"task"===t?r.selectedTaskIds:r.selectedResourceIds);if(e=s.$.id,i){const i=a.indexOf(e);i>-1&&(a.splice(i,1),r.$[`${t}Table`].selected=a)}else a.indexOf(e)<0&&(a.push(e),r.$[`${t}Table`].selected=a);return"string"==typeof s.id||"number"==typeof s.id?s.id:s.$.id}}_refreshAfterWorkingTimeChange(){const e=this;if(e.adjustToNonworkingTime)for(let t=0;t<e._tasks.length;t++){const i=e._tasks[t],r=i.$.project;e._validateTaskDates(i,r),e._synchronizeProjectDates(i,r),e._refreshTableColumnsData(i,["dateEnd","duration"])}e._refreshTimeline()}_refreshItemIds(e="task"){const t=this[`_${e}s`];if(!t)return;let i={},r=0;for(let e=0,n=t.length;e<n;e+=1){const n=t[e],s=n.$.project;if(void 0!==s){const e=s.$.id;i[e]||(i[e]=0),n.$.id=e+"."+i[e],i[e]++}else n.$.id=r+"",r++}}_refreshConnectionIds(){const e=this._tasks,t=this._connections;if(t&&t.length)for(let i=0,r=t.length;i<r;i+=1){const n=t[i],s=e.indexOf(n.startTask),a=e.indexOf(n.endTask);(s<0||a<0)&&(t.splice(i,1),r--),n.startIndex=s,n.endIndex=a}}_refreshSelectedItems(e="task",t){const i=this,r=i[`_${e}s`];if(r&&(!t&&i._selected&&i._selected[e]&&(t=i._selected[e]),t)){for(let e=0,i=t.length;e<i;e+=1){const n=t[e];(r.indexOf(n)<0||n.hidden)&&(t.splice(e,1),e-=1,i--)}i._setSelection(e,t.map((e=>e.$.id)))}}_resetFromAction(e="task",t="clearSort"){const i=this;function r(){i.$.taskTable[t](),i._createTimelineContent(),i._recycleTimelineTasks()}function n(){const e=i.$.resourceTable;e&&(e[t](),i._createResourceTimelineVCells(),i._recycleResourceContent())}"resource"===e?n():"task"===e?r():(r(),n())}_setWorkTime(e,t,i){const r=this;if("object"!=typeof e)return;let n,s=e.days,a=e.hours;null!=s&&(Array.isArray(s)||(s=[s]),s=r._nonworkingDayValidator(void 0,s),n=t(s,i?r.nonworkingDays:[0,1,2,3,4,5,6]),r.set("nonworkingDays",7===n.length?[]:n),r._refreshAfterWorkingTimeChange()),null!=a&&(Array.isArray(a)||(a=[a]),a=r._nonworkingTimeValidator(void 0,a),n=t(a,i?r.nonworkingHours:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]),r.set("nonworkingHours",24===n.length?[]:n),r._refreshAfterWorkingTimeChange())}_getValidConnectionId(e,t,i,r){const n=this,s=n._tasks,a=0===r.indexOf("_");let o;if("string"==typeof e&&(o=n._getTaskIndexById(e),o>=0&&(e=o)),"string"==typeof t&&(o=n._getTaskIndexById(t),o>=0&&(t=o)),e=parseInt(e),t=parseInt(t),i=parseInt(i),isNaN(e)||isNaN(t)||e===t)a||n.error(n.localize("incorrectArgument",{elementType:n.nodeName.toLowerCase(),methodName:r,argumentName:"taskIndex"}));else if(e>=s.length||e<0||t>=s.length||t<0)a||n.error(n.localize("outOfBounds",{elementType:n.nodeName.toLowerCase(),methodName:r,argumentName:"taskIndex"}));else{if(!(isNaN(i)||i<0||i>3))return a?[e,t,i]:e+"-"+t+"-"+i;a||n.error(n.localize("incorrectArgument",{elementType:n.nodeName.toLowerCase(),methodName:r,argumentName:"connectionType"}))}}_autoSchedule(e){const t=this,i=t._tasks;if(t.autoSchedule){e?Array.isArray(e)||(e=[e]):e=i;for(let i=0;i<e.length;i++){const r=e[i];"project"===r.type&&r.synchronized||(r.minDateStart=r.minDateEnd=void 0,t._autoScheduleTasks(r))}t._isUpdateRequired&&(t._createTimelineCells(),t._recycleTimelineTasks(!0),delete t._isUpdateRequired)}}_getTaskConnections(e){const t=this._tasks,i=this._connections;let r=[],n=[];if(t&&t.length&&i&&i.length){const s=t.indexOf(e);for(let e=0;e<i.length;e+=1){const t=i[e];t.startIndex===s?r.push(t):t.endIndex===s&&n.push(t)}}return{taskConnections:r,connectedTasks:n}}_autoScheduleTasks(e){const t=this,i=t._tasks,r=t._getTaskConnections(e),n=r.taskConnections,s=r.connectedTasks;let a,o,l;for(let r=0;r<n.length;r++)t._isAutoScheduled(e,i[n[r].endIndex],!0);for(let r=0;r<s.length;r++){const n=s[r],c=i[n.startIndex],d=n.type,m=n.lag,u=e.$.project;c&&"project"===c.type&&c.synchronized||(0===d||1===d?(l=new Date((0===d?c.dateStart:c.dateEnd).getTime()+m),e.minDateStart=new Date(e.minDateStart?Math.max(e.minDateStart.getTime(),l.getTime()):l),o=e.minDateStart.getTime()-e.dateStart.getTime(),a=new Date(e.dateEnd.getTime()+(t.autoScheduleStrictMode?o:Math.max(0,o))),a.getTime()!==e.dateEnd.getTime()&&(e.dateEnd=a,t._isUpdateRequired=!0),t.autoScheduleStrictMode&&e.minDateStart.getTime()!==e.dateStart.getTime()&&(e.dateStart=e.minDateStart,t._isUpdateRequired=!0)):(l=new Date((2===d?c.dateEnd:c.dateStart).getTime()+m),e.minDateEnd=new Date(e.minDateEnd?Math.min(e.minDateEnd.getTime(),l.getTime()):l),o=e.minDateEnd.getTime()-e.dateEnd.getTime(),a=new Date(e.dateStart.getTime()+(t.autoScheduleStrictMode?o:Math.max(0,o))),a.getTime()!==e.dateStart.getTime()&&(e.dateStart=a,t._isUpdateRequired=!0),t.autoScheduleStrictMode&&e.minDateEnd.getTime()!==e.dateEnd.getTime()&&(e.dateEnd=e.minDateEnd,t._isUpdateRequired=!0)),t._validateTaskDates(e,u),t._synchronizeProjectDates(e,u))}for(let e=0;e<n.length;e++){const r=i[n[e].endIndex];!r||"project"===r.type&&r.synchronized||(r.minDateStart=r.minDateEnd=void 0,t._autoScheduleTasks(r))}}_autoScheduleRestore(e,t){const i=this._tasks;e||(e=i),Array.isArray(e)||(e=[e]);for(let r=0;r<e.length;r++){const n=e[r];i.indexOf(e[r])>-1&&(t?0===t||1===t?n.minDateStart=void 0:n.minDateEnd=void 0:n.minDateStart=n.minDateEnd=void 0)}}_autoScroll(e){const t=this,i=t.hasAttribute("dragged"),r=t.hasAttribute("resized");function n(n,s){if(!t._dragDetails)return clearInterval(t._scrollInterval),t._scrollInterval=void 0,void delete t._autoScrolling;t._autoScrolling=!0,s?i||(t.scrollTop-=t.autoScrollStep*n,t._dragDetails.coordinates.y+=t.autoScrollStep*n):(t.scrollLeft-=(t.rightToLeft?-1:1)*t.autoScrollStep*n,t._dragDetails.coordinates.x+=t.autoScrollStep*n),i?t._handleTaskBarDrag(e):r&&t._handleTaskBarResize(e)}if(t.disableAutoScroll||!e||!i&&!r&&!t.hasAttribute("connecting-task"))return;const s=t.$.timeline.getBoundingClientRect();t._scrollInterval&&clearInterval(t._scrollInterval),t._scrollInterval=setInterval((function(){(t.scrollLeft||t.rightToLeft)&&e.clientX<=s.left+20?n(1):t.scrollLeft!==(t.rightToLeft?0:t.scrollWidth)&&e.clientX>=s.left+s.width-20?n(-1):t.scrollTop&&e.clientY<=s.top+20?n(1,!0):t.scrollTop!==t.scrollHeight&&e.clientY>=s.top+s.height-20?n(-1,!0):(clearInterval(t._scrollInterval),t._scrollInterval=void 0,delete t._autoScrolling)}),1)}_checkTaskBarResizability(e){const t=this;let i=e.originalEvent.target;t.shadowRoot&&i===t&&(i=e.originalEvent.composedPath()[0]);const r=t.$.timeline;if(!i.closest)return void r.removeAttribute("task-bar-hovered");let n,s=i.closest(".smart-timeline-row")||i.closest(".smart-timeline-task");if(t.disabled||t.disableTaskResize||!s||!r.contains(s))return void r.removeAttribute("task-bar-hovered");const a=t._getTaskDOMIndex(s._cellObj.task);if(s.classList.contains("smart-timeline-row")?n=t.$.timelineTasksContainer.children[a]:s.classList.contains("smart-timeline-task")&&(n=s,s=t.$.taskTimelineCellsContainer.children[a]),!n||n.classList.contains("milestone")||n._cellObj.task.synchronized||n._cellObj.task.disableResize)return;if(i.classList&&i.classList.contains("smart-task-connection-point"))return void r.removeAttribute("task-bar-hovered");const o=e.pageX-window.pageXOffset,l="visible"===t.resizeHandlesVisibility||t._isMobile?20:5,c=n.getBoundingClientRect(),d=s.getBoundingClientRect(),m=Math.min(l,o-d.left),u=Math.min(l,d.left+d.width-o);Math.round(c.left)+m>=o&&Math.round(c.left)-m<=o?r.setAttribute("task-bar-hovered","left"):Math.round(c.left+c.width)+u>=o&&Math.round(c.left+c.width)-u<=o?r.setAttribute("task-bar-hovered","right"):r.removeAttribute("task-bar-hovered")}_onShadowDomLoaded(e,t,i){requestAnimationFrame((function r(){const n=(e.shadowRoot||e.getRootNode()).querySelectorAll("link");for(let e=0;e<n.length;e++)if(-1!==n[e].href.indexOf(t))return void i();requestAnimationFrame(r)}))}_getConnectionObjById(e){const t=this._connections;if(!e||!t||!t.length)return;const i=e.split("-"),r=parseInt(i[0]),n=parseInt(i[1]),s=parseInt(i[2]);for(let e=0,i=t.length;e<i;e+=1){const i=t[e];if(i.startIndex===r&&i.endIndex===n&&i.type===s)return i}}_positionWindow(){const e=this,t=e.getShadowRootOrBody(),i=[e.$.taskPopupWindow,e.$.connectionPopupWindow,e.$.confirmPopupWindow];for(let r=0;r<i.length;r++){const n=i[r];if(!n||!t.contains(n))continue;const s=e.getBoundingClientRect();n.opened||(n.style.left=n.style.top=""),e._isMobile?(n.setAttribute("mobile",""),n.style.left=s.left+window.pageXOffset+"px",n.style.top=s.top+window.pageYOffset+"px",n.style.width=s.width+"px",n.style.height=s.height+"px"):(n.style.left=Math.max(s.left+window.pageXOffset,s.left+window.pageXOffset+s.width/2-n.offsetWidth/2)+"px",n.style.top=Math.max(s.top+window.pageYOffset,s.top+window.pageYOffset+s.height/2-n.offsetHeight/2)+"px")}}_openPopupWindow(e,t){const i=this;function r(){function t(){i._positionWindow(),s.opened?(s.bringToFront(),s._onOpenCallback?s._onOpenCallback():s._handleActiveState()):s.open()}if(i.popupWindowCustomizationFunction?i.popupWindowCustomizationFunction(s,n,"connection"===n?e.startIndex+"-"+e.endIndex+"-"+e.type:i._cloneObject(e)):s._onOpenCallback=()=>{const e=(s.shadowRoot||s).querySelectorAll(".smart-gantt-chart-popup-window-editor .smart-input, .smart-popup-window-button");(e[0]||e[1]||s).focus({preventScroll:!0}),s._handleActiveState()},i._setPopupWindowTemplate("header",n,e),i._setPopupWindowTemplate("footer",n,e),i._setPopupWindowTemplate("content",n,e),!i._popupWindow[n+"PopupWindow"]){const e=i["$"+n+"PopupWindow"];e.unlisten("transitionend"),e.unlisten("open"),e.unlisten("close"),e.unlisten("closing"),e.unlisten("click"),e.listen("transitionend",i._popupWindowTransitionendHandler.bind(i)),e.listen("open",i._popupWindowOpenHandler.bind(i)),e.listen("close",i._popupWindowCloseHandler.bind(i)),e.listen("closing",i._popupWindowClosingHandler.bind(i)),e.listen("click",i._popupWindowClickHandler.bind(i))}s.shadowRoot?(s.importStyle(Smart.Utilities.Core.getScriptLocation()+Smart.StyleBaseUrl.replace("/scoped/","/smart.textbox.css")),i._onShadowDomLoaded(s,"smart.window.css",t)):t();const r=(i.getAttribute("aria-owns")||"")+" "+s.id;i.setAttribute("aria-owns",r.trim()),i._popupWindow[n+"PopupWindow"]=s}if(e&&e.classList)if(e.classList.contains("smart-task-connection"))e=i._getConnectionObjById(e.getAttribute("connection-id"));else if("TR"===e.nodeType){const t=e?"task":"resource",r=i._getVCellById(t,e.getAttribute("row-id"));e=r?r[t]:void 0}else e=e._cellObj.task;if(!e||e.isGroup)return;const n=t?"confirm":"string"==typeof e.type?"task":"connection",s=i._createPopupWindow(n);!t&&i.$.fireEvent("opening",{target:s,type:n}).defaultPrevented||(s._target=e,i._popupWindow||(i._popupWindow={}),s.parentElement||i.getShadowRootOrBody().appendChild(s),s.isCompleted?r():s.whenReady((()=>r())))}_createPopupWindow(e){const t=this,i=e+"PopupWindow";if(t.$[i])return t.$[i];const r=document.createElement("smart-window");return r.classList.add("smart-"+e+"-popup-window"),r.classList.add("smart-gantt-chart-popup-window"),r.setAttribute("smart-id",i),t.$[i]=r,t["$"+i]=Smart.Utilities.Extend(r),r.rightToLeft=t.rightToLeft,r.theme=t.theme,r.animation=t.animation,r.disableSnap=!0,r.headerButtons=["close"],r}_popupWindowOpenHandler(e){const t=this,i=t["$"+e.target.getAttribute("smart-id")];i&&(t._handleModal(!0),t.$.fireEvent(e.type,e.detail),i.unlisten("open"))}_popupWindowClosingHandler(e){const t=this["$"+e.target.getAttribute("smart-id")];if(!t)return;const i=e.target.classList.contains("smart-confirm-popup-window")?"confirm":e.target.classList.contains("smart-connection-popup-window")?"connection":"task";this.$.fireEvent(e.type,{target:e.target,type:i}).defaultPrevented?e.preventDefault():t.unlisten(e.type)}_popupWindowCloseHandler(e){const t=this,i=e.target.getAttribute("smart-id"),r=t["$"+i];if(r){if(t._handleModal(),t.$.fireEvent(e.type,e.detail),r.unlisten("close"),r.unlisten("click"),t.hasAttribute("aria-owns")){const e=t.getAttribute("aria-owns").replace(t._popupWindow[i].id,"").trim();e?t.setAttribute("aria-owns",e):t.removeAttribute("aria-owns")}delete t._popupWindow[i];const n=Object.keys(t._popupWindow);1===n.length&&t._popupWindow.confirmPopupWindow&&(delete t._popupWindow.confirmPopupWindow._target,t._popupWindow.confirmPopupWindow.close()),n.length?requestAnimationFrame((()=>{const e=t._popupWindow[n[n.length-1]];e&&e.focus()})):t.keyboardNavigation&&t.$.taskTable.focus({preventScroll:!0})}}_popupWindowTransitionendHandler(e){const t=this,i=e.target;i instanceof Smart.Window&&!i.opened&&"visibility"===e.propertyName&&(t["$"+i.getAttribute("smart-id")].unlisten("transitionend"),i.parentElement&&i.parentElement.removeChild(i))}_handleModal(e){const t=this;let i=(t.shadowRoot||t).querySelector(".smart-popup-window-modal");e?(i||(i=document.createElement("div"),i.classList.add("smart-popup-window-modal")),i.parentElement||(t.$.container.appendChild(i),t.setAttribute("modal",""))):i&&i.parentElement&&Object.keys(t._popupWindow).length<2&&(i.parentElement.removeChild(i),t.removeAttribute("modal"))}_createTaskEditor(e,t,i){const r=this,n=e.value,s=t[e.value];let a,o,l=i.find((e=>e._label===n));if(l)a=l.firstElementChild,o=l.lastElementChild;else{if(l=document.createElement("div"),l.classList.add("smart-gantt-chart-popup-window-editor"),l._label=n,e.customEditor)return l.appendChild(e.customEditor(n,s)),l;if(a=document.createElement("label"),a.id||(a.id="editorLabel"+Math.floor(65536*(1+Math.random())).toString(16).substring(1)),"number"==typeof s||"string"==typeof s)o=document.createElement("input"),o.classList.add("smart-input");else if(s instanceof Date)Smart.DateTimePicker?(o=document.createElement("smart-date-time-picker"),o.locale=r.locale,o.dropDownAppendTo="body",o.calendarButton=!0,o.dropDownDisplayMode="auto",o.enableMouseWheelAction=!0,o.formatString="yyyy-MMM-dd HH:mm:ss"):(o=document.createElement("input"),o.type="datetime-local");else if(Array.isArray(s))if(Smart.DropDownList)o=document.createElement("smart-drop-down-list"),o.virtualized=!0,o.dropDownAppendTo="body",o.selectionMode="zeroOrMany";else{o=document.createElement("input"),o.classList.add("smart-input");const e=document.createElement("datalist");e.id="resourceList",o.setAttribute("list",e.id),l.appendChild(e)}o&&o.setAttribute("aria-labelledby",a.id)}if(!l.parentElement)return l.appendChild(a),l.appendChild(o),l;r._setPopupWindowEditors(e,t,l)}_setAriaControls(){this.setAttribute("role","treegrid")}_setPopupWindowEditors(e,t,i){const r=this,n=i.firstElementChild,s=i.lastElementChild,a=(e.value+"").split(/(?=[A-Z])/).join(" "),o=t[e.value];if(e.customEditor)e.setCustomEditorValue&&e.setCustomEditorValue(i,a,o);else{if(n.innerHTML=r.localize(e.value)||a.charAt(0).toUpperCase()+a.slice(1),"number"==typeof o)s.value=parseFloat(o);else if("string"==typeof o)s.value=o;else if(o instanceof Date)s.value=new Date(o);else if(Array.isArray(o)){const e=r._resources;if(s.placeholder=r.localize("unassigned"),Smart.DropDownList&&s instanceof Smart.DropDownList)s.dataSource=e.map((e=>({label:e.label,value:e.id}))),s.selectedValues=t.disableResources?[]:t.resources.map((e=>e.toString()));else{let r=i.querySelector("datalist"),n=document.createDocumentFragment();r.innerHTML="";for(let t=0;t<e.length;t++){const i=e[t],r=document.createElement("option");r.value=i.id,r.innerHTML=i.label,n.appendChild(r)}s.value=t.resources.toString(),r.appendChild(n)}}"project"===t.type&&t.synchronized&&["duration","date"].indexOf(a.toLowerCase())>-1||"resources"===a&&t.disableResources?s.disabled=!0:s.disabled=!!e.disableEdit,s.rightToLeft=r.rightToLeft,s.animation=r.animation,s.theme=r.theme}}_setPopupWindowContent(e,t){const i=this,r=i.$[e+"PopupWindow"],n=[].slice.call(r.getElementsByClassName("smart-gantt-chart-popup-window-editor"));if(r.content&&(!r.content.innerHTML||n.length))if("task"===e&&t){const e=i.taskColumns;for(let s=0;s<e.length;s++){const a=e[s];if(void 0===t[a.value])continue;const o=i._createTaskEditor(a,t,n);o&&(r.appendChild(o),i._setPopupWindowEditors(a,t,o))}t.id&&r.setAttribute("aria-controls",t.id)}else if("confirm"===e){if(r.innerHTML='<div class="smart-gantt-chart-popup-window-editor">'+i.localize("confirm",{componentName:"The task"})+"</div >",i._popupWindow){const e=Object.keys(i._popupWindow);e.length&&r.setAttribute("aria-controls",i._popupWindow[e[e.length-1]].id)}}else{const e=t.startTask,n=t.endTask;r.innerHTML='<div class="smart-gantt-chart-popup-window-editor">'+i.localize("deleteLink")+"<b> "+e.label+" - "+n.label+"?</b></div>"}}_setPopupWindowTemplate(e,t,i){const r=this,n=r.$[t+"PopupWindow"];if("content"!==e){if(n[e+"Template"]||(n[e+"Template"]=r._createPopupWindowTemplate(e,t)),"header"===e&&i&&"string"==typeof i.type){const e=(n.shadowRoot||n).querySelector(".smart-popup-window-label");e&&(e.innerHTML=i.label)}else if("footer"===e){const e=(n.shadowRoot||n).querySelectorAll(".smart-popup-window-button");for(let i=0;i<e.length;i++){const n=e[i];n.innerHTML="task"===t?'<span class="smart-icon"></span>':"",n.theme=r.theme,n.rightToLeft=r.rightToLeft,n.animation=r.animation,n.classList.contains("ok")?(n.innerHTML+=r.localize("ok"),n.setAttribute("aria-label","ok")):n.classList.contains("cancel")?(n.innerHTML+=r.localize("cancel"),n.setAttribute("aria-label","cancel")):n.classList.contains("delete")&&(n.innerHTML+=r.localize("delete"),n.setAttribute("aria-label","delete"));const s=n.querySelector(".smart-ripple");s&&s.parentElement.removeChild(s)}}}else r._setPopupWindowContent(t,i)}_createPopupWindowTemplate(e,t){const i=this,r=document.createElement("template");if("footer"===e)switch(t){case"task":r.innerHTML=`<smart-button class="smart-popup-window-button ok primary"\n                            animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>\n                        </smart-button>\n                        <smart-button class="smart-popup-window-button cancel"\n                            animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>\n                        </smart-button>\n                        <smart-button class="smart-popup-window-button delete secondary"\n                            animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>\n                        </smart-button>`;break;case"connection":case"confirm":r.innerHTML=`<smart-button class="smart-popup-window-button ok primary"\n                            animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>\n                        </smart-button>\n                    <smart-button class="smart-popup-window-button cancel"\n                        animation="${i.animation}" theme="${i.theme}" ${i.rightToLeft?"right-to-left":""}>\n                    </smart-button>`}else"header"!==e||"task"!==t&&"confirm"!==t||(r.innerHTML='<span class="smart-popup-window-label"></span>');return r}_popupWindowClickHandler(e){const t=this;let i=(e.originalEvent||e).target;i.shadowRoot&&(i=(e.originalEvent||e).composedPath()[0]);const r=i.closest("smart-window")||(i.getRootNode()&&i.getRootNode().host?i.getRootNode().host:void 0),n=r._target;if(i.closest(".smart-popup-window-button.cancel"))return t._popupWindow&&t._popupWindow.confirmPopupWindow&&r!==t._popupWindow.confirmPopupWindow&&t._popupWindow.confirmPopupWindow.close(),r.close(),void delete r._target;if(i.closest(".smart-popup-window-button.ok")){if(r===t.$.connectionPopupWindow&&"number"==typeof n.type)t._removeConnection(n.startIndex+"-"+n.endIndex+"-"+n.type);else if(r===t.$.confirmPopupWindow){const e=n;void 0!==e.$._resourceId?t._removeResource(e):t._removeTask(e),r.close(),t.$.taskPopupWindow&&t.$.taskPopupWindow.close(),delete r._target}else{const e=(r.shadowRoot||r).querySelectorAll(".smart-gantt-chart-popup-window-editor"),i=n;let s={};for(let i=0;i<e.length;i++){const r=e[i]._label,n=t.taskColumns.find((e=>e.value===r));if(n.customEditor&&n.getCustomEditorValue)s[r]=n.getCustomEditorValue(e[i]);else{const t=e[i].lastElementChild;let n;n=Smart.DateTimePicker&&t instanceof Smart.DateTimePicker?t.value.toDate():t instanceof HTMLInputElement&&"datetime-local"===t.type?new Date(t.value):Smart.DropDownList&&t instanceof Smart.DropDownList?t.selectedValues.slice(0):t.hasAttribute("list")?t.value.split(",").map((e=>e.trim())):t.value,n instanceof Date&&isNaN(n.getTime())&&(n=void 0),null!=n&&(s[r]=n)}}void 0!==i.$._resourceId?t._updateResource(i,s):t._updateTask(i,s)}return t._popupWindow&&t._popupWindow.confirmPopupWindow&&r!==t._popupWindow.confirmPopupWindow&&t._popupWindow.confirmPopupWindow.close(),r.close(),void delete r._target}i.closest(".smart-popup-window-button.delete")&&t._openPopupWindow(r._target,!0)}_createTasks(e,t){const i=this,r={},n=[];e||(e=i.dataSource),i.dataSource instanceof Smart.DataAdapter&&(e=i._parseAdapterData(i.dataSource.toArray())),t||i.clearTasks();let s=[];if(function e(a,o){let l=[];if(!a||0===a.length)return[];for(let c=0;c<a.length;c++){let d,m=a[c];if("object"!=typeof m)continue;if(m=i._validateTaskProperties(m,o),!m)continue;const u=m.tasks,h=m.id;m.$.project=o,m.$.id=o?o.$.id+"."+c:c+"","string"!=typeof h&&"number"!=typeof h||(r[h]?n.push(h):r[h]=1),u instanceof Array&&u.length>0&&(m.synchronized&&(m.dateStart=m.minDateStart=m.maxDateStart=void 0,m.dateEnd=m.minDateEnd=m.maxDateEnd=void 0),m.type="project",d=e(u,m),d.length&&(m.hidden=!d.some((e=>!e.hidden)),m.hidden?d.forEach((e=>e.hidden=m.hidden)):i._synchronizeProjectVisibility(o,m))),(!m.type||["project","task","milestone"].indexOf(m.type)<0)&&(m.type="task"),o&&"project"===m.type&&d&&d.length>0?(l.push(m),l=l.concat(d)):(o||((t&&"project"===m.type&&m.synchronized||m.dateStart&&m.dateEnd&&!isNaN(m.dateStart.getTime())&&!isNaN(m.dateEnd.getTime()))&&s.push(m),d&&(s=s.concat(d))),l.push(m))}return o&&i._synchronizeProjectDates(o,l),l}(e),t)return s.slice(0);n.length&&console.warn(i.localize("duplicateIds",{elementType:i.nodeName.toLowerCase(),duplicates:n.toString()})),i._tasks=s.slice(0),i._handleResources()}_createTimeline(){const e=this;e._tasks&&0!==e._tasks.length?(delete e.__tasks,e._createConnections(),e._autoSchedule(),e._createTimelineCells(),e._insertTimelineTasks(),e.$.taskSplitter.refresh()):e._clearTasks()}_createConnections(){const e=this,t=e._tasks;e._connections=[];for(let i=0,r=t.length;i<r;i+=1)t[i].connections&&e._handleTaskConnections(i)}_parseAdapterData(e){let t={};for(let i=0,r=e.length;i<r;i+=1){const r=e[i],n=Object.assign({},r),s=r.parent,a=r.$.id;if(s&&s!==r){const e=s.$.id;t[e]||(t[e]=Object.assign({},s));const i=t[e];i.tasks||(i.tasks=[]),i.tasks.push(n)}else t[a]=n;delete n.parent,delete n.children,delete n.$}return Object.values(t)}_handleTaskConnections(e){const t=this,i=t._tasks;let r;if("number"==typeof e&&(r=e,e=i[e]),!e)return;void 0===r&&(r=i.indexOf(e));const n=e.connections,s=i.length;for(let e=0;e<n.length;e++){const i=n[e],a=t._getTaskIndexById(i.target);null==a||isNaN(a)||a<0||a>=s||a===r||t._connectTask([r,a,i.type,i.lag])}delete e.connections}_insertTasks(e,t,i){const r=this,n=r._tasks;if(t){const s=r._getProjectTasks(t,!0);if(s.length){const t=s[s.length-1];let a,o;"number"==typeof i&&i<s.length?a=s[i=Math.max(0,i)]:(a=t,o=!0);const l=r._getProjectTasks(a);i=o&&l.length?n.indexOf(l[l.length-1]):n.indexOf(a),n.splice.apply(n,[i+(o?1:0),0].concat(e))}else n.splice.apply(n,[n.indexOf(t)+1,0].concat(e))}else"number"==typeof i?(i+="",(i=n.findIndex((e=>e.$.id===i)))<0&&(i=n.length)):i=n.length,n.splice.apply(n,[i,0].concat(e))}_insertTimelineTasks(){const e=this,t=e._timelineVCells;t&&t.length?(e._recycleTimelineTasks(),e._refresh()):e._resetTimeline()}_recycleTimelineTasks(e){const t=this,i=t._timelineVCells;if(!i||!i.length)return;const r=i.indexOf(t._getFirstContentCellInView()),n=t.$.taskTimelineCellsContainer.childElementCount,s=t._getSelection("task",t.selectedTaskIds);for(let a=0,o=n;a<o;a++){const n=i[r+a];if(!n)continue;const o=n.task;t._recycleTaskBars(n,a,s),t._setTimelineTaskBar(n,a),t._setTaskBarProgress(o,a),t._setTaskBarLabel(o,a),e&&t._refreshTableColumnsData(o)}t._recycleConnections()}_ensureVisible(e,t="task"){const i=this;if(null==e)return;let r,n="task"===t?i._timelineVCells:i._timelineResourceVCells;r||(r=i.$[`${t}Table`]);const s=n.find((i=>i[t]===e));if(!s)return;let a,o;if("task"===t){const t=i._getTimelineTaskCellByDate(e.dateStart);if(a=i.$.taskTimelineContainer.offsetHeight,o=i,t){const e=i.scrollLeft,r=i.$.taskTimelineContainer.offsetWidth;t.left+t.width>e+r?i.scrollLeft=Math.max(0,t.left+t.width-r):t.left<e&&(i.scrollLeft=Math.max(0,t.left))}}else a=i.$.resourceTimelineContent.offsetHeight,o=i._resourceScrollView;const l=o.scrollTop;s.top+s.height>l+a?o.scrollTop=Math.max(0,s.top+s.height-a):s.top<l&&(o.scrollTop=Math.max(0,s.top))}_isTaskExpanded(e,t){if(!e||!e.$)return;let i,r=e.$[this.groupByResources?"group":"project"];if(!r)return!0;for(;r;){if(i=r.expanded,!i)return!1;if(r=r.$.project,r===t)break}return i}_getItemByTreeIndex(e,t,i){if(!t)return;const r=t.split(".");let n=this[`_${e}s`].filter((e=>!e.$.project))[t.split(".")[0]];if(n){if(!n[`${e}s`]||!n[`${e}s`].length)return i?null:n;for(let t=1;t<r.length;t++){const s=n[`${e}s`].filter((e=>!e.hidden&&e.$.project===n))[r[t]];if(!s||i&&"project"!==s.type)break;if(n=s,"project"!==n.type)break}return i?n&&"project"===n.type?n:void 0:n}}_getItemByTableId(e,t,i){if(null==t)return;const r=this[`_${e}s`];let n;for(let e=0,i=r.length;e<i;e+=1){const i=r[e];if(i.$.id===t){n=i;break}}return n?i?"project"===n.type?n:void 0:n:void 0}_tableChangeHandler(e){const t=e.target;(t.classList.contains("smart-task-table")||t.classList.contains("smart-resource-table"))&&(e.stopPropagation(),this._handleTableSelection(t===this.$.taskTable?"task":"resource",t.selected))}_tableColumnResizeHandler(e){const t=e.target,i=e.detail,r=t.classList.contains("smart-task-table");if(!r&&!t.classList.contains("smart-resource-table"))return;e.stopPropagation();const n=i.dataField,s=this[(r?"task":"resource")+"Columns"].find((e=>e.value===n));s&&(s.size=i.width),this.$.fireEvent("columnResize",i)}_tableSortFilterHandler(e){const t=this,i=e.target;let r;i.classList.contains("smart-task-table")?(r="task",t._createTimelineContent(),t._recycleTimelineTasks()):i.classList.contains("smart-resource-table")&&(r="resource",t._createResourceTimelineContent(),t._recycleResourceContent()),r&&(t._refresh(),e.stopPropagation(),t.$.fireEvent(e.type,Object.assign({type:r},e.detail)))}_taskTableExpandHandler(e){const t=this,i=e.target;if(!i.classList.contains("smart-task-table")&&!i.classList.contains("smart-resource-table"))return;const r=i===t.$.taskTable?"task":"resource";if(e.stopPropagation(),!t[`${r}s`]||!t[`${r}s`].length)return;const n=e.detail.record.itemId,s=t._getItemByTableId(r,n,!0);s&&(delete t._hoveredItem,s.expanded="collapse"!==e.type,t._createTimelineContent(),t._refresh(),t._recycleTimelineTasks(),t.$.fireEvent(e.type,{item:t._cloneObject(s),id:s.id||s.$.id,index:t._tasks.indexOf(s),label:s.label,value:s.value}))}_taskTableKeyDownHandler(e){const t=this,i=e.key;if(t.keyboardNavigation&&!t.disabled&&!t.readonly)switch(i){case"Delete":case"Enter":{const e=t.$.taskTable._focusedCell;if(!e||!e.closest)return;const r=e.closest("tbody tr");if(!r)return;const n=t._getVCellById("task",r.getAttribute("row-id"));n&&t._openPopupWindow(n.task,"Delete"===i);break}}}_getVCellById(e="task",t){const i="task"===e?this._timelineVCells:this._timelineResourceVCells;if(i&&i.length)for(let r=0,n=i.length;r<n;r+=1){const n=i[r][e];if(n.$&&n.$.id===t)return i[r]}}_getGroupVCellByPath(e,t){const i="task"===e?this._timelineVCells:this._timelineResourceVCells;if(i&&i.length)for(let r=0,n=i.length;r<n;r+=1){const n=i[r][e];if(n.$&&n.$.id===t)return i[r]}}_taskTableGroupEventHandler(e){const t=this,i=e.detail.action,r=e.target;if(["collapse","expand"].indexOf(i)<0||!r.classList.contains("smart-task-table")&&!r.classList.contains("smart-resource-table"))return;const n=r===t.$.taskTable?"task":"resource",s=t.$.taskTable._getGroupByIndex(e.detail.path),a=t._getGroupVCellByPath(n,s.$.id);if(!a||!a[n].isGroup)return;const o=a[n];e.stopPropagation(),o.expanded="collapse"!==i,t._createTimelineContent(),t._refresh(),t._recycleTimelineTasks(),t.$.fireEvent(i,{isGroup:!0,item:t._cloneObject(o),id:o.$.id,label:o.label})}_resetTimeline(){const e=this;e.$.taskTimelineCellsContainer.innerHTML="",e.$.timelineTasksContainer.innerHTML="",e.$.timelineConnectionsContainer.innerHTML="",e.$.timelineContent.style.height="",e.$.container.style.removeProperty("--smart-gantt-chart-task-timeline-content-height")}_refreshTimeline(e){const t=this;e||(e=t.view);const i=t._getDateFromCell(t.scrollLeft,t._getFirstCellObjInView(),e),r=t.scrollTop;t.scrollLeft=0,t.scrollTop=0,t.$.mainSplitter.contains(t.$.resourceTimelineHeader)&&t._resourceScrollView&&(t._resourceScrollView.scrollLeft=0),t._resetTimeline(),t._createTimelineCells(),t._recycleTimelineTasks(!0),t.$.mainSplitter.contains(t.$.resourceSplitter)&&t._refreshResourceTimeline(),t._refresh(),t._scrollTo(i),t.scrollTop=r}_scrollTo(e,t){const i=this,r=i._timelineCells;let n;if(void 0!==e&&!isNaN(new Date(e).getTime()))for(let s=0;s<r.length;s++){const a=r[s],o=a.date;switch(i.view){case"year":if(o.getFullYear()===e.getFullYear()&&o.getMonth()===e.getMonth()){if(t){n=a.left;break}let i=new Date(e);i.setMonth(e.getMonth()+1),i.setDate(0),i=i.getDate(),n=a.left+(e.getDate()-1)/i*a.width}break;case"month":{let i=new Date(o),r=new Date(o);i.setDate(i.getDate()-i.getDay()),r.setDate(r.getDate()+(6-r.getDay())+1),r.setMilliseconds(r.getMilliseconds()-1),e.getTime()>=i.getTime()&&e.getTime()<=r.getTime()&&(n=a.left+(t||t?0:e.getDay()/7*a.width));break}case"week":o.getFullYear()===e.getFullYear()&&o.getMonth()===e.getMonth()&&o.getDate()===e.getDate()&&(n=a.left+parseFloat(e.getHours()+"."+e.getMinutes()+e.getSeconds())/24*a.width);break;case"day":o.getFullYear()===e.getFullYear()&&o.getMonth()===e.getMonth()&&o.getDate()===e.getDate()&&o.getHours()===e.getHours()&&(n=a.left+(t?0:parseFloat(e.getMinutes()+e.getSeconds())/60*a.width))}if(void 0!==n)return i.scrollLeft=n,void(i.$.mainSplitter.contains(i.$.resourceTimelineHeader)&&(i.$.resourceTimelineHeader.scrollLeft=i.$.resourceTimelineContent.scrollLeft=n,i._refreshResourceTimeline()))}}_updateConnection(e,t){const i=this,r=i._tasks,[n,s,a,o]=e,l=r[n],c=r[s];if(!l||!c||"number"!=typeof a)return;let d=i._connections,m=-1;d||(d=i._connections=[]);for(let e=0,t=d.length;e<t;e+=1){const t=d[e];if(t.startIndex===n&&t.endIndex===s){m=e;break}}if(t)return void(m>-1&&d.splice(m,1));const u={startTask:r[n],endTask:r[s],startIndex:n,endIndex:s,type:a,lag:o};if(m<0)d.push(u);else{const e=d[m];if(a===e.type)return;e.type=a}return!0}_createTimelineCells(){const e=this,t=e._tasks,i=new Date(e.properties.dateStart.value),r=new Date(e.properties.dateEnd.value);let n,s;if(isNaN(i.getTime())||(n=i),isNaN(r.getTime())||(s=r),t.length>0){let e=t[0].dateStart,i=t[0].dateEnd;for(let r=0;r<t.length;r++)t[r].dateStart&&t[r].dateEnd&&(e||(e=t[r].dateStart),i||(i=t[r].dateEnd),e.getTime()>t[r].dateStart.getTime()&&(e=t[r].dateStart),i.getTime()<t[r].dateEnd.getTime()&&(i=t[r].dateEnd));(!n||n.getTime()>e.getTime())&&(n=e),(!s||s.getTime()<i.getTime())&&(s=i)}n&&s&&(n=e._minMaxDateValidator(n),s=e._minMaxDateValidator(s),e._createTimelineHeader(n,e._getCellsCount(n,s)),e._createTimelineContent(),e._refresh())}_getCellsCount(e,t,i){let r,n,s,a,o,l,c=new Date(e),d=new Date(t);const m=t.getFullYear()-e.getFullYear();if(n=r=Math.round(m)+1,"year"===i)return{year:n};if(c.setHours(c.getHours(),0,0,0),d.setHours(d.getHours(),0,0,0),l=Math.floor((t.getTime()-e.getTime())/36e5),l>0){let e=new Date(c);if(l=1,c.getFullYear()!==d.getFullYear()){let t=new Date(c.getFullYear()+1,0,1,0,0,0,0);for(;e.getTime()!==t.getTime();){const t=e.getTime();e.setHours(e.getHours()+1),e.getTime()===t&&e.setHours(e.getHours()+2),l++}const i=d.getFullYear()-t.getFullYear();for(let t=0;t<i;t++){const t=e.getFullYear();l+=24*((t%100==0?t%400==0:t%4==0)?366:365)-1,e.setFullYear(t+1)}}for(;e.getTime()<d.getTime();){const t=e.getTime();e.setHours(e.getHours()+1),e.getTime()===t&&e.setHours(e.getHours()+2),l++}}if("hour"===i)return{hour:l};if(c.setHours(0,0,0,0),d.setHours(23,59,59,999),o=r=Math.round((d.getTime()-c.getTime())/864e5),"day"===i)return{day:o};if(c.setDate(c.getDate()-c.getDay()),d.setDate(d.getDate()+6-d.getDay()),a=r=Math.round((d.getTime()-c.getTime())/6048e5),"week"===i)return{week:a};if("month"===this.view&&(0!==e.getDay()&&(e=new Date(e.setDate(e.getDate()-e.getDay()))),6!==t.getDay()&&(t=new Date(t.setDate(t.getDate()+6-t.getDay())))),e.getFullYear()!==t.getFullYear()){r=12-e.getMonth();const i=t.getFullYear();for(let n=e.getFullYear()+1;n<=i;n++)r+=n===t.getFullYear()?t.getMonth()+1:12}else r=t.getMonth()-e.getMonth()+1;return s=Math.ceil(r),"months"===i?{month:s}:{year:n,month:s,week:a,day:o,hour:l}}_recycleTaskBars(e,t,i){const r=e.task,n=this.$.timelineTasksContainer,s=this.$.taskTimelineCellsContainer,a="project"===r.type&&r.synchronized,o=r.type,l=r.$.id,c=n.children[t],d=s.children[t];d._cellObj=e,d.setAttribute("row-id",l),d.style.top=e.top+"px",d.removeAttribute("hover"),c.removeAttribute("hover"),c.classList.contains(o)||(c.innerHTML="milestone"===o?'<div class="smart-task-container" aria-hidden="true">\n                    <div class="smart-task-connection-point start"></div>\n                    <div class="smart-timeline-task-fill"></div>\n                    <div class="smart-task-connection-point end"></div>\n                </div>':'<div class="smart-task-container" aria-hidden="true">\n                    <div class="smart-task-connection-point start"></div>\n                    <div class="smart-timeline-task-fill">\n                        <div class="smart-timeline-task-progress"></div>\n                    </div>\n                    <div class="smart-timeline-task-progress-thumb"></div>\n                    <div class="smart-timeline-task-label"></div>\n                    <div class="smart-task-connection-point end"></div>\n                </div>'),delete c._cellStart,delete c._cellEnd,r.disableDrag||a&&!r.dragProject?c.setAttribute("disable-drag",""):c.removeAttribute("disable-drag"),r.disableResize||a?c.setAttribute("disable-resize",""):c.removeAttribute("disable-resize"),r.isGroup?c.setAttribute("resource-group",""):c.removeAttribute("resource-group"),i&&(i.indexOf(l)>-1?(c.setAttribute("selected",""),d.setAttribute("selected","")):(c.removeAttribute("selected"),d.removeAttribute("selected"))),r.id?c.id=r.id:c.id="ganttTask"+Math.floor(65536*(1+Math.random())).toString(16).substring(1),c._cellObj=e,c.className="smart-timeline-task "+o,c.setAttribute("row-id",l),r.class&&c.classList.add(r.class);const m=e=>e.getFullYear()+"-"+(e.getMonth()<10?"0"+e.getMonth():e.getMonth())+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate());c.setAttribute("aria-label",r.label+" Start date: "+m(r.dateStart)+", End date: "+m(r.dateEnd)),c.setAttribute("aria-selected","false")}_createCells(e){let t,i=document.createDocumentFragment();for(let r=0;r<e;r++)t=document.createElement("div"),t.classList.add("smart-timeline-view-cell"),t.setAttribute("role","columnheader"),i.appendChild(t);return i}_getTimelineVisibleCellsCount(){const e=this,t=e._timelineCells;if(!t)return;const i=e._getFirstCellObjInView(),r=1-(i.left+i.width-e.scrollLeft)/t[0].width;return Math.min(t.length,Math.ceil(parseFloat((e.$.timeline.offsetWidth/i.width).toFixed(2))+r))}_getHeaderVisibleCellsCount(){const e=this;if(!e._timelineHeaderCells)return;const t=Math.abs(e.scrollLeft),i=e.$.timeline.offsetWidth,r=e._timelineHeaderCells;let n=0;for(let e=0;e<r.length;e++){const s=r[e];s.left+s.width>t&&s.left<i+t&&n++}return n}_refreshHeaderDate(e){const t=this,i=t._getCellsViewType(),r=t.$.timelineHeader.scrollLeft,n=t.$.timelineViewCells.children,s=t._timelineCells;let a;t._refreshHeaderDetailsDate(e);for(let e=0;e<s.length;e++){const t=s[e];if(r<=t.left+t.width){a=e;break}}for(let r=0;r<n.length;r++){const o=n[r],l=s[a];if(!l)break;a++;const c=l.date;o.innerHTML=`<div>${t._getDateString(new Date(c),i)}</div>`,e||(o._date=new Date(c),o.style.width=l.width+"px",o.style[t.rightToLeft?"right":"left"]=l.left+"px",l.weekend?o.setAttribute("weekend",""):o.removeAttribute("weekend"),l.nonworking?o.setAttribute("nonworking",""):o.removeAttribute("nonworking"))}}_getDateString(e,t,i){const r=this,n=["2-digit","numeric"][r.dayFormat]||"numeric";let s;return"year"===t?s=e.toLocaleDateString(r.locale,{year:r.yearFormat}):"month"===t?s=e.toLocaleDateString(r.locale,{month:r.monthFormat}):"week"===t?s="numeric"!==r.weekFormat&&i?e.toLocaleDateString(r.locale,{day:n,month:r.monthFormat,year:r.yearFormat}):r._getWeekNumber(e):"day"===t?s=e.toLocaleDateString(r.locale,"day"===r.view?{day:n,month:r.monthFormat,year:r.yearFormat}:["long","short","narrow"].indexOf(r.dayFormat)>-1?{weekday:r.dayFormat}:{day:r.dayFormat}):"hour"===t&&(s="default"===r.hourFormat?e.toLocaleTimeString(r.locale,{hour12:!1}):e.toLocaleDateString(r.locale,{hour:r.hourFormat})),r.timelineHeaderFormatFunction?r.timelineHeaderFormatFunction(new Date(e),t,i,s):s}_refreshHeaderDetailsDate(e){const t=this,i=t.view,r=t.scrollLeft,n=t.$.timelineViewDetails.children,s=t._timelineHeaderCells;let a;for(let e=0;e<s.length;e++){const t=s[e];if(r<=t.left+t.width){a=e;break}}for(let r=0;r<n.length;r++){const o=s[a],l=n[r];let c=new Date(o.date);"week"===t.view&&c.setDate(c.getDate()-c.getDay()),a++,c=new Date(Math.max(o.date.getTime(),c.getTime())),l.innerHTML=`<div>${t._getDateString(c,i,!0)}</div>`,e||(l._date=c,l.style[t.rightToLeft?"right":"left"]=o.left+"px",l.style.width=o.width+"px")}}_getWeekNumber(e){let t,i=new Date(e.getFullYear(),0,1),r=Math.round((e.getTime()-i.getTime()-6e4*(e.getTimezoneOffset()-i.getTimezoneOffset()))/864e5)+1,n=i.getDay();return n=n>=0?n:n+7,n<4?(t=Math.floor((r+n-1)/7)+1,t>52&&(i=new Date(e.getFullYear()+1,0,1),n=i.getDay(),n=n>=0?n:n+7,t=n<4?1:53)):t=Math.round((r+n-1)/7),t}_convertDuration(e,t){if(!e)return 0;let i;switch(this.durationUnit){case"day":i=864e5;break;case"hour":i=36e5;break;case"minute":i=6e4;break;case"second":i=1e3;break;case"milisecond":return e;case"week":i=6048e5}return Math.max(0,t?e/i:e*i)}_createTaskBar(e){const t=document.createElement("div");return t.classList.add("smart-timeline-task"),t.classList.add(e),t.innerHTML="milestone"===e?'<div class="smart-task-container" aria-hidden="true">\n                <div class="smart-task-connection-point start"></div>\n                <div class="smart-timeline-task-fill"></div>\n                <div class="smart-task-connection-point end"></div>\n            </div>':'<div class="smart-task-container" aria-hidden="true">\n                <div class="smart-task-connection-point start"></div>\n                <div class="smart-timeline-task-fill">\n                    <div class="smart-timeline-task-progress"></div>\n                </div>\n                <div class="smart-timeline-task-progress-thumb"></div>\n                <div class="smart-timeline-task-label"></div>\n                <div class="smart-task-connection-point end"></div>\n            </div>',t}_createTimelineHeader(e,t){const i=this,r=i._getCellsViewType();if(!e){const t=i.$.timelineViewCells.children;if(0===t.length)return;e=t[0]._date}if("day"!==i.view&&e.setHours(0,0,0,0),i.$.timelineContent.offsetWidth===i.$.timeline.offsetWidth&&i._timelineCells&&i._timelineCells[0]&&i._timelineCells[0].date.getTime()===e.getTime()&&i._timelineCells.length===t[i._getCellsViewType()])i._refresh();else{if(i.$.timelineContent.style.width=i.$.timelineHeaderContent.style.width="",i._createTimelineCellsObj(e,t),i._createTimelineHeaderCellsObj(e,t),i.$.timelineViewDetails.innerHTML="",i.$.timelineViewDetails.appendChild(i._createCells(i._getHeaderVisibleCellsCount())),i.$.timelineViewCells.innerHTML="",i.$.timelineViewCells.appendChild(i._createCells(i._getTimelineVisibleCellsCount())),i.$.timelineContent.style.width=i.$.timelineHeaderContent.style.width=Math.max(t[r]*i._timelineCells[0].width,i.$.timeline.parentElement.offsetWidth)+"px",i.scrollLeft){const e=i._getScrollLeft(i.scrollLeft);i.$.timelineHeader.scrollLeft=e,i.$.mainSplitter.contains(i.$.resourceTimelineHeader)&&(i.$.resourceTimelineHeader.scrollLeft=e)}i._refreshHeaderDate()}}_createTimelineContent(){const e=this,t=e.$.container,i=window.getComputedStyle(e),r=e.$.timelineContent,n=parseFloat(i.getPropertyValue("--smart-gantt-chart-task-default-height"))||30;if(r.style.height="",t.style.removeProperty("--smart-gantt-chart-task-timeline-content-height"),e._createTimelineVCells(n),r.style.height=e._timelineVCells.length*n+"px",t.style.setProperty("--smart-gantt-chart-task-timeline-content-height",e.$.timeline.offsetHeight+"px"),e.scrollLeft){const t=e._getScrollLeft(e.scrollLeft);e.$.taskTimelineContainer.scrollLeft=t,e.$.mainSplitter.contains(e.$.resourceTimelineHeader)&&(e.$.resourceTimelineContent.scrollLeft=t)}e.scrollTop&&(e.$.taskTimelineContainer.scrollTop=e.scrollTop),e._recycleContentCells()}_createTimelineRowCells(e,t){const i=this,r=e.children,n=e.querySelectorAll(".smart-task-bar-limiter"),s=document.createDocumentFragment(),[a,o]=i.rightToLeft?["right","left"]:["left","right"];t||(t=i.$.timelineViewCells.children);for(let e=0,t=n.length;e<t;e+=1)n[e].remove();const l=t.length;for(;e.childElementCount>l;)e.lastElementChild.remove();for(let t=e.childElementCount;t<l;t+=1){const e=document.createElement("div");e.classList.add("smart-timeline-cell"),s.appendChild(e)}s.childElementCount&&e.appendChild(s);for(let e=0;e<l;e+=1){const i=t[e],n=r[e];i.hasAttribute("weekend")?n.setAttribute("weekend",""):n.removeAttribute("weekend"),i.hasAttribute("nonworking")?n.setAttribute("nonworking",""):n.removeAttribute("nonworking"),n.style[o]=i.style[o],n.style[a]=i.style[a],n.style.width=i.style.width}for(let t=0,i=n.length;t<i;t+=1)e.appendChild(n[t])}_recycleTimelineRowCells(){const e=this,t=e.$.timelineViewCells.children,i=e.$.taskTimelineCellsContainer.children;for(let r=0,n=i.length;r<n;r+=1)e._createTimelineRowCells(i[r],t)}_createTimelineVCells(e){const t=this,i=t._tasks,r=t.$.taskTable.rows,n=t.groupByResources;let s=0,a={};t._timelineVCells=[];for(let o=0,l=r.length;o<l;o++){const l=r[o].data;let c=i[l.itemIndex];if(n)if(!c&&l.groupDataField){const e=l.$.id;c={$:{id:e,project:void 0},label:t._formatResourceGroupLabel(l.label),value:l.label,expanded:l.expanded,synchronized:!0,isGroup:!0,type:"project"},a[e]=c}else l.parent?(c.$.group=a[l.parent.$.id],t._synchronizeProjectDates(c.$.group,[c])):delete c.$.group;else delete c.$.group;!c.hidden&&t._isTaskExpanded(c)&&(t._timelineVCells.push({top:s,height:e,task:c}),s=parseFloat((s+e).toFixed(2)))}}_getCellsViewType(){switch(this.view){case"year":return"month";case"month":return"week";case"week":return"day";case"day":return"hour"}}_createTimelineCellsObj(e,t){const i=this,r=i._getCellsViewType();t=t[r];const n=window.getComputedStyle(i),s=i.$.timeline.parentElement.offsetWidth;let a=Math.max(parseFloat(n.getPropertyValue("--smart-gantt-chart-timeline-cell-size"))||0,parseFloat(n.getPropertyValue("--smart-gantt-chart-timeline-cell-min-size")||0)),o=0,l=new Date(e);t*a<s&&(a=s/t),a=parseFloat(a.toFixed(2)),i._timelineCells=[];for(let e=0;e<t;e++){const e={left:o,width:a};if("year"===r)l.setMonth(0),e.date=new Date(l),l.setFullYear(l.getFullYear()+1);else if("month"===r)l.setDate(1),e.date=new Date(l),l.setMonth(l.getMonth()+1);else if("week"===r)l.setHours(0,0,0,0),l.setDate(l.getDate()-l.getDay()),e.date=new Date(l),l.setDate(l.getDate()+7);else if("day"===r)i.nonworkingDays.indexOf(l.getDay())>-1&&(e.nonworking=!0),l.setHours(0,0,0,0),e.date=new Date(l),l.setDate(l.getDate()+1),e.weekend=0===e.date.getDay()||6===e.date.getDay();else if("hour"===r){(i.nonworkingHours.indexOf(l.getHours())>-1||i.nonworkingDays.indexOf(l.getDay())>-1)&&(e.nonworking=!0),l.setHours(l.getHours(),0,0,0),e.date=new Date(l);const t=l.getTime();l.setHours(l.getHours()+1),t===l.getTime()&&l.setHours(l.getHours()+2),e.weekend=0===e.date.getDay()||6===e.date.getDay()}i._timelineCells.push(e),o=parseFloat((o+a).toFixed(2))}}_createTimelineHeaderCellsObj(e,t){const i=this,r=i.view;let n=0,s=new Date(e);t=t[r],i._timelineHeaderCells=[];for(let e=0;e<t;e++){const t={};switch(t.date=new Date(s),r){case"year":s.setFullYear(s.getFullYear()+1);break;case"month":s.setDate(1),s.setMonth(s.getMonth()+1);break;case"week":s.setDate(s.getDate()+7);break;case"day":s.setDate(s.getDate()+1)}n=i._refreshViewDetailCell(t,n,e),i._timelineHeaderCells.push(t)}}_minMaxDateValidator(e){if(!e||isNaN(e.getTime()))return e;const t=new Date(this.min),i=new Date(this.max);return t&&(e=new Date(Math.max(t.getTime(),e.getTime()))),i&&(e=new Date(Math.min(i.getTime(),e.getTime()))),e}_dateValidator(e,t){const i=this;let r;if(t instanceof Date)return i._minMaxDateValidator(t);if(Smart.Utilities.DateTime&&t instanceof Smart.Utilities.DateTime)return i._minMaxDateValidator(t.toDate());if("string"!=typeof t)return i._minMaxDateValidator(e);{const e=/\d+:\d+:\d+/;if("new Date()"===t.trim()||"new Smart.Utilities.DateTime()"===t.trim())return i._minMaxDateValidator(new Date);if(isNaN(Date.parse(t))){const i=/(\d+[,-.\/]{1}\s*\d+[,-.\/]{1}\s*\d+)/;if(i.test(t)){const n=i.exec(t)[0].replace(/[,-.\/]/g,",").split(",");if(3===n.length){const[i,s]=parseInt(n[0])<parseInt(n[2])?[n[0],n[2]]:[n[2],n[0]];if(r=new Date(parseInt(s),parseInt(n[1])-1,parseInt(i)),e.test(t)){const i=e.exec(t)[0].split(":");r.setHours(i[0]||0,i[1]||0,i[2]||0)}t=r}}}else r=new Date(Date.parse(t)),e.test(t)||r.setHours(0,0,0,0),t=r}return i._minMaxDateValidator(new Date(t))}_getTaskBarPositionLimits(e,t){const i=this;function r(e){const t=i._getTimelineTaskCellByDate(e);if(t)return t.left+i._getTimelineTaskOffset(t,e)||0}return{min:r(e["min"+t]),max:r(e["max"+t])}}_getTimelineTaskOffset(e,t){if(!e)return;let i,r;switch(this.view){case"year":{const n=t.getHours()/24+t.getMinutes()/1440+t.getSeconds()/86400;i=new Date(e.date.getFullYear(),e.date.getMonth()+1,0),r=(t.getDate()-1+n)/i.getDate()*e.width;break}case"month":r=t.getDay()/7*e.width;break;case"week":r=parseFloat(t.getHours()+t.getMinutes()/60+t.getSeconds()/3600)/24*e.width;break;case"day":r=parseFloat(t.getMinutes()+t.getSeconds()/60)/60*e.width}return r}_getTaskBarSizeLimits(e,t){const i=this,r=i._getTaskBarDateRange(e);let n,s=0,a=i._convertDuration(e._cellObj.task.minDuration)||i._getMinDuration(e,t),o=i._convertDuration(e._cellObj.task.maxDuration);function l(n,s){if(!n)return;let a,o;"left"===t&&!i.rightToLeft||"right"===t&&i.rightToLeft?(n*=-1,o=r.dateEnd):o=r.dateStart,s&&Math.abs(a)===Math.abs(n)&&(a=0);let l=i._getTaskWorkingDateEnd({dateStart:o},n);const c=l.getTime()+60*(l.getTimezoneOffset()-o.getTimezoneOffset())*1e3,d=i._getTimelineTaskCellByDate(new Date(c));if(!d)return;const m=i._getTimelineTaskOffset(d,new Date(c));return i.rightToLeft?"left"===t?m-(i.$.timelineContent.offsetWidth-e.offsetLeft-e.offsetWidth-d.left):i.$.timelineContent.offsetWidth-e.offsetLeft-d.left-m:"left"===t?e.offsetLeft+e.offsetWidth-d.left-m:d.left-e.offsetLeft+m}if("left"===t&&!i.rightToLeft||"right"===t&&i.rightToLeft){const t=e._cellObj.task.maxDateStart,i=e._cellObj.task.minDateStart;i&&(s=60*(i.getTimezoneOffset()-r.dateEnd.getTimezoneOffset())*1e3,n=Math.abs(i.getTime()-r.dateEnd.getTime())+s,o=o?Math.min(n,o):n),t&&(s=60*(t.getTimezoneOffset()-r.dateEnd.getTimezoneOffset())*1e3,n=Math.abs(t.getTime()-r.dateEnd.getTime())+s,a=a?Math.max(n,a):n)}else{const t=e._cellObj.task.maxDateEnd,i=e._cellObj.task.minDateEnd;i&&(s=60*(i.getTimezoneOffset()-r.dateStart.getTimezoneOffset())*1e3,n=Math.abs(i.getTime()-r.dateStart.getTime())+s,a=a?Math.max(n,a):n),t&&(s=60*(t.getTimezoneOffset()-r.dateStart.getTimezoneOffset())*1e3,n=Math.abs(t.getTime()-r.dateStart.getTime())+s,o=o?Math.min(n,o):n)}return o&&(a=Math.min(a,o)),{min:l(a,!0),max:l(o)}}_getMinDuration(e,t){const i=this,r=parseFloat(getComputedStyle(i).getPropertyValue("--smart-gantt-chart-timeline-task-min-width"))||0;if(!r||!i._timelineCells||0===i._timelineCells.length)return;const n=e._cellObj.task;let s,a,o=1;a=i.rightToLeft?parseFloat(e.style.right)||i.$.timelineContent.offsetWidth-e.offsetLeft-e.offsetWidth:parseFloat(e.style.left)||e.offsetLeft,"left"===t?(s=n.dateEnd,a+=parseFloat(e.style.width)||e.offsetWidth,o=-1):s=n.dateStart;const l=a+o*r;let c;for(let e=0;e<i._timelineCells.length;e++){const t=i._timelineCells[e];if(l<t.left)break;c=t}const d=i._getDateFromCell(l,c);return d?Math.abs(s.getTime()-d.getTime()):void 0}_createDelimiter(e,t){const i=this,r=i._dragDetails,n=e.slice(0,3),s=document.createElement("div");if(s.classList.add("smart-task-bar-limiter",e),e.indexOf("date")>-1){if(!r[n]||!r[n].left)return;const e=r.timelineTask,t=i.$.taskTimelineCellsContainer.children[i._getTaskDOMIndex(e._cellObj.task)];n.indexOf("max")>-1?s.style.width=t.offsetWidth-i._dragDetails[n].left-e.offsetWidth+"px":s.style.width=r[n].left+"px"}else{if(!this._dragDetails[n].width)return;s.style["left"===t?"right":"left"]=r[n].width+"px"}return s}_doubleClickHandler(e){const t=this;let i=e.target;if(t.disabled||t.disableWindowEditor)return;t.shadowRoot&&i===t&&(i=e.composedPath()[0]);let r=i.closest?i.closest(".smart-task-connection"):void 0;if(r)t._openPopupWindow(r);else if(r=i.closest(".smart-timeline-task")||i.closest(".smart-table tbody tr[row-id]"),r&&t.$.taskSplitter.contains(r))if(r.classList.contains("smart-timeline-task"))t._openPopupWindow(r._cellObj.task);else{const e=t._getVCellById("task",r.getAttribute("row-id"));e&&t._openPopupWindow(e.task)}}_checkDoubleClick(e){const t=this;let i=e.target;if(t.shadowRoot&&i===t&&(i=e.composedPath()[0]),void 0===t._dblClickDetails&&(t._dblClickDetails={clicks:0}),clearTimeout(t._dblClickDetails.timeOut),i!==t._dblClickDetails.target&&(t._dblClickDetails.clicks=0),t._dblClickDetails.target=i,t._dblClickDetails.clicks++,t._dblClickDetails.timeOut=setTimeout((function(){t._dblClickDetails&&(t._dblClickDetails.clicks=0)}),300),2===t._dblClickDetails.clicks)return t._doubleClickHandler(e),t._dblClickDetails.clicks=0,!0}_downHandler(e){const t=this,i=e.originalEvent,r=t.shadowRoot||t.isInShadowDOM?i.composedPath()[0]:i.target,n=r.closest?r.closest(".smart-timeline-row")||r.closest(".smart-timeline-task"):null;if(e.stopPropagation(),delete t._itemClickDetails,t._dragDetails)return delete t._dragDetails,void t._setConnectionFeedback();const s=t.$.taskSplitter.contains(r)?"task":"resource";if((r.closest(".smart-timeline-content")||r.closest(`.smart-${s}-table`))&&requestAnimationFrame((()=>t.$[`${s}Table`].focus({preventScroll:!0}))),t._itemClickDetails={target:r},!t._isMobile&&0!==e.button)return;if(!n){if(r.classList.contains("smart-popup-window-modal")){if(t._popupWindow){const e=Object.keys(t._popupWindow);requestAnimationFrame((()=>t._popupWindow[e[e.length-1]].focus()))}return}return void((r.closest(".smart-table tbody tr[row-id]")&&!r.classList.contains("smart-arrow")||r.closest(".smart-task-connection"))&&t._checkDoubleClick(i))}if(r.closest(".smart-resource-timeline-view-cell")||t.disabled)return;const a=Array.from(t.$.timelineTasksContainer.children).find((e=>e._cellObj.task===n._cellObj.task));if(!a)return;const o=a._cellObj.task;if(o&&(a.getElementsByClassName("smart-timeline-task-fill")[0]||t.$.timeline.hasAttribute("task-bar-hovered"))){if((r.closest(".smart-timeline-task-fill")||a.classList.contains("milestone")&&r.closest(".smart-task-container"))&&t._checkDoubleClick(i))return;const n=r.closest(".smart-timeline-task-progress-thumb"),s=e.pageX-window.pageXOffset,l=e.pageY-window.pageYOffset,c=t._dragDetails={};c.target=(n||r).className,c.timelineTask=a,c.task=a._cellObj.task,c.taskDimensions={width:a.offsetWidth,height:a.offsetHeight,left:a.offsetLeft,top:a.offsetTop},c.coordinates={x:s,y:l},t.rightToLeft&&(c.taskDimensions.right=t.$.timelineContent.offsetWidth-(c.taskDimensions.left+c.taskDimensions.width));const d=(n||a).getBoundingClientRect();if(c.offset={x:s-d.left,y:l-d.top},n||!n&&"project"===o.type&&o.synchronized&&!o.dragProject)return void(r.closest(".smart-task-connection-point")&&(c.timelineTask=void 0,c.relatedConnections={}));("visible"===t.resizeHandlesVisibility||t._isMobile&&"auto"===t.resizeHandlesVisibility)&&(r.closest(".smart-timeline-task-fill")?t._checkTaskBarResizability(e):t.$.timeline.removeAttribute("task-bar-hovered")),t.rightToLeft?c.originalPosition={x:t.$.timelineContent.offsetWidth-(a.offsetLeft+a.offsetWidth),y:a.offsetTop}:c.originalPosition={x:a.offsetLeft,y:a.offsetTop},c.originalSize={width:a.offsetWidth,height:a.offsetHeight},c.min={},c.max={},t._setDragLimits(r)}}_documentMoveHandler(e){const t=this;if(!t._dragDetails||!t._dragDetails.target){let i=e.originalEvent.target;t.shadowRoot&&i===t&&(i=e.originalEvent.composedPath()[0]);const r=i.closest&&i.closest(".smart-table tbody tr[row-id]");return r&&r.data?t._handleTableItemHover(r.data.itemId,i):t._handleTimelineHover(e),void t._checkTaskBarResizability(e)}if(t._dragDetails.target.includes("smart-task-connection-point"))return t._setConnectionFeedback(e),t._handleTimelineHover(e),void t._autoScroll(e);if(t._dragDetails.target.includes("smart-timeline-task-progress-thumb"))t._handleTaskProgressChange(e);else if(t._autoScroll(e),!t._autoScrolling)if(t.$.timeline.hasAttribute("task-bar-hovered"))t._handleTaskBarResize(e);else if(t._dragDetails.target.includes("smart-timeline-task-fill")){const i=t._dragDetails.task;if(!i||i.disableDrag||"project"===i.type&&i.synchronized&&!i.dragProject)return;t._handleTaskBarDrag(e)}}_documentUpHandler(e){const t=this,i=e.originalEvent;let r=i.target;if(t._upHandler(),!t._dragDetails)return void t._handleItemClick(i);if(t._scrollView.disableSwipeScroll=t._touchmoveInside=!1,t.shadowRoot&&r===t&&(r=i.composedPath()[0]),t.hasAttribute("connecting-task")){const i=t._connectTask(e),r=t._tasks;if(t._setConnectionFeedback(),i){const e=i.taskStart,n=i.taskEnd,[s,a,o]=[r.indexOf(i.taskStart),r.indexOf(i.taskEnd),i.type];t.$.fireEvent("connectionEnd",{id:`${s}-${a}-${o}`,startIndex:s,startTaskId:"string"==typeof e.id||"number"==typeof e.id?e.id:e.$.id,endIndex:a,endTaskId:"string"==typeof n.id||"number"==typeof n.id?n.id:n.$.id,type:o}),t._autoSchedule(i.taskStart)}return t._isMobile&&t._handleTimelineHover(e,!0),void delete t._dragDetails}const n=t._dragDetails.task;if(!n)return void delete t._dragDetails;let s;s||(s=Array.from(t.$.timelineTasksContainer.children).find((e=>e._cellObj.task===n))),t.hasAttribute("dragged")?(t._snapToNearest(s),t._checkWorkingDays(s),t._refreshProject(n.$.project),t.groupByResources&&t._refreshProject(n.$.group),t._autoSchedule(n),t._resourceTreeRefreshTimeout?(clearTimeout(t._resourceTreeRefreshTimeout),delete t._resourceTreeRefreshTimeout,t._refreshAssignedResources(n)):(t.snapToNearest||t.nonworkingDays.length>0||t.nonworkingHours.length>0)&&t._refreshAssignedResources(n),t.removeAttribute("dragged"),t.$.fireEvent("dragEnd",{id:"string"==typeof n.id||"number"==typeof n.id?n.id:n.$.id,item:t._cloneObject(n),dateStart:new Date(n.dateStart),dateEnd:new Date(n.dateEnd)})):t.hasAttribute("progress-change")?(t._resourceTreeRefreshTimeout&&(clearTimeout(t._resourceTreeRefreshTimeout),delete t._resourceTreeRefreshTimeout,t._refreshAssignedResources(n,["progress"])),t.removeAttribute("progress-change"),t.$.fireEvent("progressChangeEnd",{id:"string"==typeof n.id||"number"==typeof n.id?n.id:n.$.id,item:t._cloneObject(n),progress:n.progress||0})):t.hasAttribute("resized")?(t._snapToNearest(s),t._refreshProject(n.$.project),t.groupByResources&&t._refreshProject(n.$.group),t._resourceTreeRefreshTimeout?(clearTimeout(t._resourceTreeRefreshTimeout),delete t._resourceTreeRefreshTimeout,t._refreshAssignedResources(n,["workload"])):t.snapToNearest&&t._refreshAssignedResources(n,["workload"]),t.removeAttribute("resized"),t.$.fireEvent("resizeEnd",{id:"string"==typeof n.id||"number"==typeof n.id?n.id:n.$.id,item:t._cloneObject(n),dateStart:n.dateStart,dateEnd:n.dateEnd}),t._autoSchedule(n)):r.closest(".smart-timeline-task")===s&&(t._select("task",n.$.id,!0),delete t._dragDetails,t._handleItemClick(i));const a=t.$.timelineContent.querySelectorAll(".smart-task-bar-limiter");for(let e=0,t=a.length;e<t;e+=1)a[e].remove();delete t._dragDetails}_handleItemClick(e){const t=this,i=e.target;if(t._dragDetails||!t._itemClickDetails||t._itemClickDetails.target!==i)return void delete t._itemClickDetails;let r,n,s;if(i.closest(".smart-timeline-task-fill"))n=i.closest(".smart-timeline-task")._cellObj.task,s="task";else if(r=i.closest(".smart-task-connection"),r)n=r.getAttribute("connection-id").split("-"),n={source:n[0],target:n[1],type:n[2]},s="connection";else if(r=i.closest(".smart-table tbody tr"),r){const e=t._getVCellById(s,r.getAttribute("row-id"));s=t.$.taskTable.contains(r)?"task":"resource",n=e?e[s]:void 0}if(!n)return;const a={originalEvent:e,type:s,item:t._cloneObject(n)};a.id="connection"===s?`${n.source}-${n.target}-${n.type}`:"string"==typeof n.id||"number"==typeof n.id?n.id:n.$.id,delete t._itemClickDetails,t.$.fireEvent("itemClick",a)}_moveHandler(e){const t=this;t._isMobile||e.stopPropagation(),(t.hasAttribute("dragged")||t.hasAttribute("progress-change"))&&"touchmove"===e.originalEvent.type&&e.originalEvent.preventDefault()}_handleTableItemHover(e,t){const i=this,r=i._hoveredItem;let n,s;if(t&&([n,s]=i.$.taskSplitter.contains(t)?[i.$.taskTable,"task"]:[i.$.resourceTable,"resource"]),r&&"itemType"===r.type&&r.id===e)return;const a=i.$.mainSplitter.querySelectorAll("table tbody tr[hover]");for(let e=0;e<a.length;e++)a[e].removeAttribute("hover");if(void 0===e)return void i._handleTimelineHover({target:i});if(!n)return;i._setTableHoverState(n,e);const o=i.$["task"===s?"taskTimelineCellsContainer":"resourceTimelineCellsContainer"].children;for(let t=0,r=o.length;t<r;t+=1){const r=o[t];if(r._cellObj[s].$.id===e){i._handleTimelineHover({target:r});break}}}_setTableHoverState(e,t){const i=this;e||(e=i.$.taskTable);const r=e===i.$.taskTable?"task":"resource",n=e.querySelectorAll("table tbody tr");if(!i._isMobile&&i[r+"Columns"].length)for(let e=0;e<n.length;e++){let i=n[e];const r=i.data;r&&r.itemId===t&&i.setAttribute("hover","")}}_checkWorkingDays(e){const t=this;if((t._dragDetails._taskDuration||t._timelineCells.length)&&e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")&&t.hasAttribute("dragged")){if(0===t.nonworkingDays.length&&0===t.nonworkingHours.length||!t._dragDetails._taskDuration)return;const i=e._cellObj.task,r=t._getTaskWorkingDateEnd(i);let n=new Date(t._timelineCells[t._timelineCells.length-1].date);"year"===t.view?(n.setMonth(n.getMonth()+1),n.setDate(0),n.setHours(23,59,59,999)):"month"===t.view?(n.setDate(n.getDate()+6-n.getDay()),n.setHours(23,59,59,999)):"week"===t.view?n.setHours(23,59,59,999):n.setHours(n.getHours(),59,59,999),r&&(i.dateEnd=i.maxDateEnd?new Date(Math.min(r.getTime(),i.maxDateEnd.getTime())):r),i.dateEnd=new Date(Math.min(n.getTime(),i.dateEnd.getTime())),i.duration=t._convertDuration(t.nonworkingDays.length>0||t.nonworkingHours.length>0?t._getWorkingTime(i.dateStart,i.dateEnd):i.dateEnd.getTime()-i.dateStart.getTime(),!0),t._setTimelineTaskBar(e._cellObj,void 0,!0),t._refreshTaskConnections(e._cellObj.task),t._refreshTableColumnsData(i,["dateEnd","duration"])}}_getTaskWorkingDateEnd(e,t){const i=this;if(!e||!e.dateStart)return;let r,n,s=new Date(e.dateStart);if(t||(t=i._dragDetails?i._dragDetails._taskDuration:i._getWorkingTime(e.dateStart,e.dateEnd)),!i.adjustToNonworkingTime)return new Date(e.dateStart.getTime()+t);const a=t<0?-1:1,o=i.nonworkingDays,l=i.nonworkingHours;for(t=Math.abs(t);t>0;){const e=Math.min(t,36e5-(60*s.getMinutes()*1e3+1e3*s.getSeconds()+s.getMilliseconds()));if(o.indexOf(s.getDay())>-1)n=new Date(s),n.setHours(0,0,0,0),n.setDate(s.getDate()+1*a),r=Math.min(e,n.getTime()-s.getTime()),s=new Date(s.getTime()+r);else if(l.indexOf(s.getHours())>-1){n=new Date(s);const t=n.getTime();n.setHours(s.getHours()+1*a,0,0,0),t===n.getTime()&&n.setHours(s.getHours()+2*a,0,0,0),r=Math.min(e,n.getTime()-s.getTime()),s=new Date(s.getTime()+r)}else t-=e,s=new Date(s.getTime()+a*e)}return s}_createConnectingElement(e,t,i,r,n){const s=this;if(!s._connectionDetails||!s._connectionDetails.start)return;const a=s._connectionDetails,o=a.type,l=s.$.timelineConnectionsContainer;let c=a.connections.shift();c||(c=document.createElement("div"),c.classList.add("smart-task-connection")),c.style.width=c.style.width="","horizontal"===r?(c.style.width=Math.abs(i)+"px",c.style.height=""):(c.style.width="",c.style.height=Math.abs(i)+"px"),c.style[s.rightToLeft?"left":"right"]="",c.style[s.rightToLeft?"right":"left"]=e+"px",c.style.top=t+"px",c.setAttribute("connection-id",a.id);const d=a.start.task.label,m=0===o||3===o?"start":"end",u=a.end.task.label,h=0===o||1===o?"start":"end";if(c.setAttribute("aria-label","Connection between "+d+" ("+m+") and "+u+" ("+h+")"),n){let e=0===o||1===o?"right":"left";s.rightToLeft&&(e="left"===e?"right":"left"),c.setAttribute("arrow-direction",e)}else c.removeAttribute("arrow-direction");c.parentElement||l.appendChild(c)}_getConnectionType(e,t){if(!e||!t)return;let i,r;return"string"==typeof e?i=!e.includes("end"):e instanceof HTMLElement&&(i=!e.classList.contains("end")),"string"==typeof t?r=t.includes("end"):t instanceof HTMLElement&&(r=t.classList.contains("end")),i&&!r?0:i||r?!i&&r?2:i&&r?3:void 0:1}_setConnectionFeedback(e){const t=this,i=t._dragDetails;if(!i||!i.target||!e){const e=t._connectionFeedback;return e&&e.parentElement&&e.remove(),t.removeAttribute("connecting-task"),void delete t._connectionFeedback}if(!i.target||!i.target.includes("smart-task-connection-point"))return;const r=i.task,n=i.taskDimensions;if(!r)return;if(!t.hasAttribute("connecting-task")){if(t.$.fireEvent("connectionStart",{startIndex:t._tasks.indexOf(r)}).defaultPrevented)return void delete t._dragDetails.target;t.setAttribute("connecting-task",""),t._isMobile&&(t._scrollView.disableSwipeScroll=t._touchmoveInside=!0)}const s="milestone"===r.type,a=t.rightToLeft;let o=s?-1*n.height/2:0;t._dragDetails.target.includes("end")&&(o=s?-1*o:n.width),t._connectionFeedback||(t._connectionFeedback=document.createElement("div"),t._connectionFeedback.classList.add("smart-task-connection-feedback"));const l=t._dragDetails.coordinates.x+(a?-1:1)*o,c=t._dragDetails.coordinates.y,d=t._dragDetails.offset.x-(a?n.width:0),m=t._dragDetails.offset.y,u=e.pageX-window.pageXOffset+d,h=e.pageY-window.pageYOffset+m-n.height/2;a?(t._connectionFeedback.style.left="",t._connectionFeedback.style.right=n.right+o+"px"):(t._connectionFeedback.style.left=n.left+o+"px",t._connectionFeedback.style.right=""),t._connectionFeedback.style.top=n.top+n.height/2+"px",t._connectionFeedback.style.width=Math.sqrt(Math.pow(Math.abs(u-l),2)+Math.pow(Math.abs(h-c),2))+"px",t._connectionFeedback.style.transform=t.rightToLeft?"rotate("+180*(Math.atan2(c-h,l-u)||0)/Math.PI+"deg)":"rotate("+180*(Math.atan2(h-c,u-l)||0)/Math.PI+"deg)",t._connectionFeedback.parentElement||t.$.timelineContent.appendChild(t._connectionFeedback)}_connectTask(e){const t=this,i=t._tasks;let r,n,s,a,o,l,c,d,m;if(e.originalEvent){const a=e.originalEvent;let o=t._isMobile?document.elementFromPoint(a.pageX-window.pageXOffset,a.pageY-window.pageYOffset):a.target;if(!(t._dragDetails&&t._dragDetails.target&&o&&o.classList))return;if(t.shadowRoot&&o===t&&(o=t._isMobile?t.shadowRoot.elementFromPoint(a.pageX-window.pageXOffset,a.pageY-window.pageYOffset):a.composedPath()[0]),r=t._dragDetails.target.includes("smart-task-connection-point")?t._dragDetails.target:void 0,n=o.classList.contains("smart-task-connection-point")?o:void 0,r&&(l=t._dragDetails.task),n)s=n.closest(".smart-timeline-task");else if(t._isMobile&&o.classList.contains("smart-timeline-task-fill")&&(s=o.closest(".smart-timeline-task"),s)){const e=a.pageX-window.pageXOffset-s.getBoundingClientRect().left;n=s.querySelector(".smart-task-connection-point."+(e>=s.offsetWidth/2?"end":"start"))}if(!l||!s)return;c=s._cellObj.task;for(let e=0,t=i.length;e<t;e+=1){const t=i[e];if(t!==l)if(t!==c){if(void 0!==d&&void 0!==m)break}else m=e;else d=e}}else{if(!e||e.length<3)return;const r=t._getValidConnectionId(e[0],e[1],e[2],"_connectTask");if(void 0===r)return;[d,m]=[parseInt(r[0]),parseInt(r[1])],[l,c]=[i[d],i[m]],a=parseInt(e[2]),o=e[4]||0}if(!l||!c||l===c||l.isGroup||c.isGroup||t._isAutoScheduled(l,c)||t.hasAttribute("dragged")||t.hasAttribute("resized"))return;void 0===a&&(a=t._getConnectionType(r,n));let u=t._connections;return u||(t._connections=u=[]),t._updateConnection([d,m,a,o])?(e.originalEvent&&t._recycleConnections([{startIndex:d,endIndex:m,type:a}]),e.originalEvent&&t.$.fireEvent("itemInsert",{type:"connection",item:{source:d,target:m,type:a}}),{taskStart:l,taskEnd:c,type:a}):void 0}_recycleConnections(e){const t=this,i=t._tasks;if(e?Array.isArray(e)||(e=[e]):e=t._connections,!i||!i.length||!e)return;const r=t.$.timelineTasksContainer.children,n=t.$.timelineConnectionsContainer;let s,a=[];if(r.length){const n=r[0],o=(()=>{let e=[];for(let t=0,n=r.length;t<n;t+=1)e.push(i.indexOf(r[t]._cellObj.task));return e})(),l=n.querySelector(".smart-task-connection-point."+(t.rightToLeft?"end":"start"));s={top:l.offsetTop,width:l.offsetWidth},s.offset=Math.abs(l.offsetLeft)-s.width;for(let r=0,n=e.length;r<n;r+=1){const n=e[r],l=n.startIndex,c=n.endIndex;if(o.indexOf(l)<0&&o.indexOf(c)<0)continue;const d=i[l],m=i[c],{vCellStart:u,vCellEnd:h}=t._getTasksVCell(d,m);if(!u||!h)continue;const g=n.type,f={start:{width:s.width,top:s.top,index:l,task:d},end:{width:s.width,top:s.top,index:c,task:m},type:g},p=t._getTaskBarDetails(u,t._getTimelineCellByDate(d.dateStart),t._getTimelineCellByDate(d.dateEnd)),_=t._getTaskBarDetails(h,t._getTimelineCellByDate(m.dateStart),t._getTimelineCellByDate(m.dateEnd));"milestone"===d.type?p.width=u.height:"milestone"===m.type&&(_.width=u.height),f.start.left=0===g||3===g?-1*(s.width+s.offset):p.width+s.offset,f.end.left=0===g||1===g?-1*(s.width+s.offset):_.width+s.offset,t._connectionDetails=f,p.height=_.height=u.height,p.type=d.type,_.type=m.type,t._setConnectionDetails(p,_),t._createTaskConnection(),a.push(t._connectionDetails.id),delete t._connectionDetails}}if(arguments.length)return;const o=Array.from(n.children);for(let e=0,t=o.length;e<t;e+=1){const t=o[e];a.indexOf(t.getAttribute("connection-id"))<0&&t.remove()}}_getTasksVCell(e,t){const i=this._timelineVCells;let r,n;for(let s=0,a=i.length;s<a;s+=1){const a=i[s];if(a.task===e&&(r=a),a.task===t&&(n=a),r&&n)break}return{vCellStart:r,vCellEnd:n}}_isAutoScheduled(e,t,i){const r=this,n=r._tasks;let s={};if(r.autoSchedule)return e instanceof HTMLElement&&(e=e._cellObj.task),t instanceof HTMLElement&&(t=t._cellObj.task),function e(t,a){const o=r._getTaskConnections().taskConnections,l=n.indexOf(t);s[l]=!0;for(let t=0;t<o.length;t++){const c=o[t],d=c.endIndex;if(d===a)return i&&r._removeConnection(l+"-"+d+"-"+c.type,!0),!0;if(!s[d]&&e(n[d],a))return!0}}(t,n.indexOf(e))}_setConnectionDetails(e,t){const i=this;if(!i._connectionDetails)return;const r=i._connectionDetails,n=r.start,s=r.end,a=r.type;if(!n||!s)return;let o,l=e.width,c=t.width,d=e.left,m=t.left,u=e.top,h=t.top,g=n.left,f=s.left;const p=n.index,_=s.index;if("milestone"===e.type?(l=e.height,d-=l/2):"milestone"===t.type&&(c=t.height,m-=c/2),r.id=p+"-"+_+"-"+a,!r.connectionStartOffset||!r.connectionEndOffset){switch(a){case 0:g=Math.abs(g)-n.width,f=Math.abs(f)-s.width;break;case 1:g-=l,f=Math.abs(f)-s.width;break;case 2:g-=l,f-=c;break;default:g=Math.abs(g)-n.width,f-=c}r.start.offset=g+=n.width/2,r.end.offset=f+=s.width/2}if(0===a&&d>m||1===a&&d+l+g>m-f&&h>u||2===a&&m+c>d+l||3===a&&(d-g<m+c+f&&h>u||d-g>m+c+f&&u>h)){o=!0;let i=e;e=t,t=i,i=g,g=f,f=i,i=l,l=c,c=i,i=d,d=m,m=i,i=u,u=h,h=i}let T=d,k=m;!o&&1===a||o&&3===a?T+=l:!o&&3===a||o&&1===a?k+=c:2===a&&(T+=l,k+=c);let b=i.$.timelineConnectionsContainer.querySelectorAll('.smart-task-connection[connection-id^="'+p+"-"+_+'-"]');0===b.length&&(b=i.$.timelineConnectionsContainer.querySelectorAll('.smart-task-connection[connection-id^="'+_+"-"+p+'"]')),r.connections=[].slice.call(b),r.start.x=T,r.start.y=u+n.top,r.end.x=k,r.end.y=h+s.top,r.type=a,r.inverted=o}_createTaskConnection(){const e=this,t=e._connectionDetails;if(!t)return;const i=2*(parseFloat(getComputedStyle(e).getPropertyValue("--smart-gantt-chart-timeline-task-connection-width"))||1),r=t.start.x,n=t.start.y,s=t.start.offset,a=t.start.top,o=t.end.x,l=t.end.y,c=t.end.offset,d=t.type,m=t.inverted,u=!m&&3===d||m&&1===d,h=!m&&1===d||m&&3===d;let g,f,p,_=r,T=o;u?(_=r-c,T=o+c):h&&(_=r+s,T=o-c);const k=_<=T&&u,b=_>=T&&h,y=2===d||h;!function c(u){g!==o&&(u?"horizontal"===u?(p=g-o+(k?-1:1)*s,g=_>T?g-Math.abs(p):g,e._createConnectingElement(g,f,(_===T?0:Math.abs(p))+(y?i:0),"horizontal"),g=_<T?g-p:g,c("vertical")):(p=Math.abs(f-l),f+=n<l?0:-1*p,g-=m&&1===d||!m&&3===d&&n>l?i:0,e._createConnectingElement(g,f,p,"vertical"),c()):(g?(p=Math.abs(g-o),g>=o&&(g+=-1*p,p+=i),e._createConnectingElement(g,f+(n<l?Math.abs(f-l):0),p,"horizontal",!t.inverted),g=o):(g=r,f=n,(0===d||!m&&3===d||m&&1===d)&&(g-=s),e._createConnectingElement(g,f,s,"horizontal",t.inverted),y&&(g+=s-i),k||b?(e._createConnectingElement(g,f-=n>l?a:0,a,"vertical"),f+=n<l?a:0):c("vertical")),c("horizontal")))}(),t.connections.map((e=>e.parentElement.removeChild(e)))}_getTaskIndexById(e,t){const i=this;if(t||(t=i._tasks),"number"==typeof e)return isNaN(parseInt(e))?-1:parseInt(e);if("object"==typeof e)return i._getItemIndex(e,"task");for(let i=0,r=t.length;i<r;i+=1)if(t[i].id===e)return i;return-1}_refreshTaskConnections(e){const t=this,i=e instanceof HTMLElement?e._cellObj.task:e,r=t._tasks.indexOf(i);if(void 0===r||e.classList&&e.classList.contains("smart-visibility-hidden"))return;let n;if(t._dragDetails&&(n=t._dragDetails.relatedConnections[r]),!n){n=[];const e=t._connections;if(!e||!e.length)return;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];i.startIndex!==r&&i.endIndex!==r||n.push(i)}t._dragDetails&&(t._dragDetails.relatedConnections[r]=n)}t._recycleConnections(n)}_dragStartHandler(e){const t=this,i=e.target.closest;(t._dragDetails||i&&i.call(t,"smart-gantt-chart")===t)&&e.preventDefault()}_getFirstCellObjInView(e){const t=this;if(e||(e=t._timelineCells),!e)return;const i=Math.abs(t.scrollLeft);let r,n;for(let t=0;t<e.length;t++){const s=e[t];if(s.left+s.width>i){r=s;break}n=s}return!r&&n&&(r=i>n.left?n:e[0]),r}_getFirstContentCellInView(e="task"){const t=this;let i,r,n,s;if("task"===e?(i=t._timelineVCells,r=t.scrollTop):(i=t._timelineResourceVCells,r=t.$.resourceVerticalScrollBar.value),!i)return 0;for(let e=0;e<i.length;e++){const t=i[e];if(t.top+t.height>r){n=t;break}s=t}return!n&&s&&(n=r>s.left?s:i[0]),n}_getProjectTasks(e,t){const i=this,r=i.groupByResources&&e.isGroup?"group":"project",n=i._tasks;if(!e||"project"!==e.type)return[];let s=[];for(let a=0,o=n.length;a<o;a+=1){const o=n[a];o.$[r]===e&&(s.push(o),"project"!==o.type||t||(s=s.concat(i._getProjectTasks(o,t))))}return s}_getSubTaskLimits(e){const t=this;if(!e)return;const i=e._cellObj.task,r=t._getProjectTasks(i);let n,s;if(!r.length)return;let a=r[0],o=r[0];for(let e=0;e<r.length;e++){const t=r[e];r[e].dateEnd&&r[e].dateStart&&(a.dateStart||(a=t[e]),o.dateEnd||(o=t[e]),r[e].dateEnd.getTime()>o.dateEnd.getTime()&&(o=r[e]),r[e].dateStart.getTime()<a.dateStart.getTime()&&(a=r[e]))}const l=t.$.timelineContent.offsetWidth;let c,d,m;if(a&&(c=t._getTimelineSubTaskOffset(a),c&&(d=c.left,m=c.width,n=Math.max(0,t.rightToLeft?l-e.offsetLeft-e.offsetWidth-(l-d-m):e.offsetLeft-d))),o&&(c=t._getTimelineSubTaskOffset(o),c))if(d=c.left,m=c.width,t.rightToLeft){const t=l-e.offsetLeft-e.offsetWidth;s=Math.max(t,t+l-(l-d))}else s=Math.max(e.offsetLeft,e.offsetLeft+l-(d+m));return{min:n,max:s}}_getTimelineSubTaskOffset(e){const t=this,i=t.$.timelineTasksContainer.children[t._tasks.filter((e=>!e.hidden)).indexOf(e)];let r,n,s;if(i)r=i.offsetLeft,s=i.offsetWidth;else{const i=t._getTimelineTaskCellByDate(e.dateStart),a=t._getTimelineTaskCellByDate(e.dateEnd);i&&(r=i.left+t._getTimelineTaskOffset(i,e.dateStart)||0),a&&(n=a.left+t._getTimelineTaskOffset(a,e.dateEnd)||0),s=n-r}return{left:r,width:s}}_getTaskDragLimits(e){const t=this,i=t._getTaskBarPositionLimits(e._cellObj.task,"DateStart"),r=t._getTaskBarPositionLimits(e._cellObj.task,"DateEnd"),n=t._dragDetails.taskDimensions;let s={};return(i.min||r.min)&&(s.min=Math.max(i.min||0,Math.max(0,(r.min||0)-n.width))),r.max&&(s.max=Math.max(0,r.max-n.width)),i.max&&(s.max=s.max?Math.min(i.max,s.max):i.max),s}_getTaskBarDateRange(e){if(!e)return;const t=this,i=e.classList.contains("milestone"),r=parseFloat(e.style.width)||e.offsetWidth,n=i?r/2:r,s=t.rightToLeft?parseFloat(e.style.right)||t.$.timelineContent.offsetWidth-e.offsetLeft-n:parseFloat(e.style.left)||e.offsetLeft,a=e._cellStart,o=e._cellEnd,l=e._cellObj.task,c=l.minDateStart,d=l.maxDateEnd;let m,u;return m=t._getDateFromCell(s,a),!c||"project"===e._cellObj.task.type&&e._cellObj.task.synchronized||(m=new Date(Math.max(c.getTime(),m.getTime()))),u=i?new Date(m):t._getDateFromCell(s+n,o),!d||"project"===e._cellObj.task.type&&e._cellObj.task.synchronized||(u=new Date(Math.min(d.getTime(),u.getTime()))),{dateStart:m,dateEnd:u}}_getTaskBarDetails(e,t,i){const r=this,n=e.task;if(!e)return;let s=new Date(n.dateStart);const a=new Date(n.dateEnd);if(!r._dragDetails&&r.snapToNearest){let s,a,o=n.dateStart,l=n.dateEnd;const c=new Date(t.date),d=r._getDateFromCell(t.left+t.width,t),m=new Date(i.date),u=r._getDateFromCell(i.left+i.width,i);return d.getTime()-o.getTime()>=d.getTime()-c.getTime()?(o=c,s=t.left):(o=d,s=t.left+t.width),"milestone"!==n.type&&(u.getTime()-l.getTime()>=l.getTime()-m.getTime()?(l=m,a=i.left-s):(l=u,a=i.left-s+i.width)),n.dateEnd=l,l.getTime()<o.getTime()&&(o=new Date(l)),n.dateStart=o,{left:s,width:a,top:e.top}}let o,l,c,d,m,u;switch(r.view){case"year":{c=new Date(s.getFullYear(),s.getMonth()+1,0).getDate(),d=new Date(a.getFullYear(),a.getMonth()+1,0).getDate();const e=s.getHours()/24+s.getMinutes()/1440+s.getSeconds()/86400,r=a.getHours()/24+a.getMinutes()/1440+a.getSeconds()/86400;o=t.left+(s.getDate()-1+e)/c*t.width,l=i.left+(a.getDate()-1+r)/d*i.width-o;break}case"month":m=parseFloat(s.getHours()+"."+s.getMinutes()+s.getSeconds())/24*(t.width/7),u=parseFloat(a.getHours()+"."+a.getMinutes()+a.getSeconds())/24*(t.width/7),o=t.left+s.getDay()/7*t.width+m,l=i.left+a.getDay()/7*i.width-o+u;break;case"week":m=parseFloat(s.getHours()+"."+s.getMinutes()+s.getSeconds())/24*t.width,u=parseFloat(a.getHours()+"."+a.getMinutes()+a.getSeconds())/24*t.width,o=t.left+m,l=i.left+(u-m)-t.left;break;case"day":m=parseFloat(s.getMinutes()+s.getSeconds()/60)/60*t.width,u=parseFloat(a.getMinutes()+a.getSeconds()/60)/60*t.width,o=t.left+m,l=i.left+(u-m)-t.left}return{width:"milestone"===n.type?"":l,left:o,top:e.top}}_getTimelineTaskCellByDate(e){if(!e)return;const t=this,i=t._timelineCells;let r;e:for(let n=0;n<i.length;n++){const s=i[n];switch(t.view){case"year":if(s.date.getYear()===e.getYear()&&s.date.getMonth()===e.getMonth()){r=i[n];break e}break;case"month":{let t=new Date(s.date);if(t.setDate(t.getDate()+(6-t.getDay())+1),t.setMilliseconds(t.getMilliseconds()-1),e.getTime()>=s.date.getTime()&&e.getTime()<=t.getTime()){r=i[n];break e}break}case"week":if(s.date.getYear()===e.getYear()&&s.date.getMonth()===e.getMonth()&&s.date.getDate()===e.getDate()){r=i[n];break e}break;case"day":if(s.date.getYear()===e.getYear()&&s.date.getMonth()===e.getMonth()&&s.date.getDate()===e.getDate()&&s.date.getHours()===e.getHours()){r=i[n];break e}}}return r}_handleInverted(e){const t=this;function i(e){e||(e="task");const i=t.$[`${e}Splitter`];if(!t.$.mainSplitter.contains(i))return;const[r,n,s,a,o]="task"===e?[t.$.tableSplitterItem,t.$.timelineSplitterItem,t,t.$.taskTimelineContainer,"scrollTop"]:[t.$.resourceTableItem,t.$.resourceTimelineSplitterItem,t.$.resourceVerticalScrollBar,t.$.resourceTimelineContent,"value"],l=t.treeSize!==r.size?r.style[i._measurements.dimension]:t.treeSize;r.size="",i.removeChild(n),t.inverted&&!t.rightToLeft||!t.inverted&&t.rightToLeft?i.insertBefore(n,r):i.appendChild(n),r.size=l,a.scrollTop=s[o]}(!e||t.inverted||t.rightToLeft)&&(i("task"),i("resource"))}_createResourceTimeline(){const e=this;if(e._handleResourcePanelVisibility(),e.$.taskSplitterItem._setSize("size",e.taskPanelSize),!e._resources||!e.$.mainSplitter.contains(e.$.resourceTable))return;const t=e.$.resourceSplitterItemHeader.innerHTML;(e.resourcePanelHeaderTemplate&&!t||!e.resourcePanelHeaderTemplate&&t)&&e._handleHeaderTemplate("resource"),e._setTable(e.$.resourceTable),e._recycleResourceHeaderCells(),e._createResourceTimelineContent(),e._synchronizeSplitters(e.$.taskSplitter,e.$.resourceSplitter),e.$.resourceTimelineContent.scrollLeft=e.$.resourceTimelineHeader.scrollLeft=e.$.timelineHeader.scrollLeft,e.$.resourceSplitter.refresh(),e._refresh(),e._highlightAssignedItem("task",e._getSelection("task",e.selectedTaskIds))}_createResourceTimelineContent(){const e=this,t=e._timelineVCells,i=t.length?t[0].height:parseFloat(window.getComputedStyle(e).getPropertyValue("--smart-gantt-chart-task-default-height"))||30;e._createResourceTimelineVCells(i);const r=e._timelineResourceVCells.length*i;e.$.resourceTimelineCellsContainer.style.height=r+"px",e.$.container.style.setProperty("--smart-gantt-chart-resource-timeline-content-height",r+"px"),e._recycleResourceContent()}_recycleResourceContent(){const e=this;if(!e.$.mainSplitter.contains(e.$.resourceSplitterItem))return;const t=e._timelineResourceVCells,i=e.$.resourceTimelineCellsContainer,r=e._getFirstContentCellInView("resource");if(!r)return void(i.innerHTML="");const n=t.indexOf(r),s=r.height,a=1-(r.top+s-Math.abs(e.$.resourceVerticalScrollBar.value))/s,o=t?t.length:0,l=!e.$.resourceSplitter.offsetHeight,c=e.$.resourceTimelineContent.offsetHeight,d=!l&&c?Math.min(o,Math.ceil((parseFloat((c/s).toFixed(2))+a).toFixed(2))):o,m=i.children,u=e.$.timelineViewCells.children,h=document.createDocumentFragment();for(;i.childElementCount>d;)i.lastElementChild.remove();for(let t=0;t<d;t+=1){let i=m[t];i||(i=document.createElement("div"),i.classList.add("smart-timeline-row"),h.appendChild(i)),e._createTimelineRowCells(i,u)}h.childElementCount&&i.appendChild(h);const g=i.children,f=e._getSelection("resource",e.selectedResourceIds);for(let i=0;i<d;i+=1){const r=t[n+i],s=g[i];if(!r){s&&s.remove();continue}const a=r.resource,o=a.$.id;f.indexOf(o)>-1?s.setAttribute("selected",""):s.removeAttribute("selected"),s._cellObj=r,s.setAttribute("row-id",o),s.style.top=r.top+"px",e._refreshResourceTimelineContent(a,s)}}_createResourceTimelineVCells(e){const t=this,i=t._resources,r=t.$.resourceTable.rows,n=t._timelineResourceVCells=[];let s=0;if(void 0===e){const i=t._timelineVCells;e=i.length?i[0].height:parseFloat(window.getComputedStyle(t).getPropertyValue("--smart-gantt-chart-task-default-height"))||30}for(let t=0,a=r.length;t<a;t+=1){const a=i[r[t].data.itemIndex];a.hidden||(n.push({top:s,height:e,resource:a}),s=parseFloat((s+e).toFixed(2)))}}_handleResourcePanelVisibility(){const e=this,t=e._resources.filter((e=>!e.hidden)),i=e.$.mainSplitter,r=e.$.resourceSplitterItem,n=e.$.taskSplitterItem;if(!t||!t.length||e.hideResourcePanel)return r&&!r.size&&(r._size=r.style[i._measurements.dimension]),e._resourceScrollView&&(e._resourceScrollView.unlisten(),delete e._resourceScrollView),n.size="",n.min="",e.$.resourceTable&&e.$.resourceTable.clearSelection(),i.contains(r)&&(i.removeChild(r),e._refresh()),void e._highlightAssignedItem("resource");i.contains(r)||(n.min=e.taskPanelMin,e._createResourcePanel(),e._setupResourcePanel(),e._resourceScrollView=new Smart.Utilities.Scroll(e.$.resourceSplitterItem,e.$.horizontalScrollBar,e.$.resourceVerticalScrollBar)),e._synchronizeSplitters(e.$.taskSplitter,e.$.resourceSplitter)}_createResourcePanel(){const e=this,t=e.$.mainSplitter;let i=e.$.resourceSplitterItem;if(!i){i=document.createElement("smart-splitter-item"),i.classList.add("smart-resource-splitter-item"),i.innerHTML=`<div smart-id="resourceSplitterItemHeader" class="smart-resource-panel-header"></div>\n                <smart-splitter smart-id="resourceSplitter" wait class="smart-resource-splitter" auto-fit-mode="end">\n                    <smart-splitter-item smart-id="resourceTableItem" class="smart-resource-table-item">\n                        <smart-table wait smart-id="resourceTable" class="smart-resource-table" virtualization deferred-scroll-delay="0"></smart-table>\n                    </smart-splitter-item>\n                    <smart-splitter-item smart-id="resourceTimelineSplitterItem" class="smart-timeline-splitter-item">\n                        <div class="smart-timeline" smart-id="resourceTimeline">\n                            <div class="smart-timeline-container" role="presentation">\n                                <div class="smart-timeline-header" smart-id="resourceTimelineHeader" role="rowgroup">\n                                    <div class="smart-timeline-view-cells" smart-id="resourceTimelineViewCells" role="row"></div>\n                                </div>\n                                <div smart-id="resourceTimelineContent" class="smart-timeline-content" role="rowgroup">\n                                    <div smart-id="resourceTimelineCellsContainer" class="smart-timeline-cells-container" aria-hidden="true"></div>\n                                </div>\n                            </div>\n                        </div>\n                         <smart-scroll-bar wait smart-id="resourceVerticalScrollBar" class="smart-timeline-scroll-bar smart-resource-scroll-bar" \n                            orientation="vertical" aria-controls="[[${e.id||""}]]">\n                         </smart-scroll-bar>\n                    </smart-splitter-item>\n                </smart-splitter>`,t.contains(i)||t.appendChild(i);const r=Smart.Utilities,n=i.querySelectorAll(".smart-resource-panel-header, .smart-resource-splitter, .smart-resource-table-item, \n                .smart-resource-table, .smart-timeline-splitter-item, .smart-timeline, .smart-timeline-header, .smart-timeline-view-cells, .smart-timeline-content,\n                .smart-timeline-cells-container, .smart-timeline-scroll-bar"),[s,a,o,l,c,d,m,u,h,g,f]=n;e.$.resourceSplitterItem=i,e.$resourceSplitterItem=r.Extend(i),e.$.resourceSplitterItemHeader=s,e.$resourceSplitterItemHeader=r.Extend(s),e.$.resourceSplitter=a,a.hasResizeObserver=!1,a.wait=!1,e.$resourceSplitter=r.Extend(a),e.$.resourceTableItem=o,e.$resourceTableItem=r.Extend(o),e.$.resourceTable=l,l.hasResizeObserver=!1,e.$resourceTable=r.Extend(l),e.$.resourceTimelineSplitterItem=c,e.$resourceTimelineSplitterItem=r.Extend(c),e.$.resourceTimelineViewCells=u,e.$resourceTimelineViewCells=r.Extend(u),e.$.resourceTimeline=d,e.$resourceTimeline=r.Extend(d),e.$.resourceTimelineContent=h,e.$resourceTimelineContent=r.Extend(h),e.$.resourceTimelineHeader=m,e.$resourceTimelineHeader=r.Extend(m),e.$.resourceTimelineCellsContainer=g,e.$resourceTimelineCellsContainer=r.Extend(g),e.$.resourceVerticalScrollBar=f,e.$resourceVerticalScrollBar=r.Extend(f)}}_setupResourcePanel(){const e=this,t=e.rightToLeft,i=e.$.resourceSplitterItem,r=e.$.resourceTableItem,n=e.$.resourceTable,s=e.$.resourceTimelineSplitterItem,a=e.$.resourceVerticalScrollBar;e.$.mainSplitter.contains(i)?([e.$.resourceSplitter,n,e.$.resourceVerticalScrollBar].forEach((e=>e.rightToLeft=t)),n.$.virtualizationContainer._scrollView.disableSwipeScroll=!0,n.$.virtualizationContainer.verticalScrollBarVisibility="hidden",n.$.virtualizationContainer.disabled=!0,r.size=e.treeSize,r.min=e.treeMin,s.min=e.timelineMin,i.min=e.resourcePanelMin,i.size=i._size||e.resourcePanelSize,a.hasStyleObserver=!1,a.hasResizeObserver=!1,a.wait=!1):e.$.mainSplitter.appendChild(i)}_refreshResourceTimeline(){const e=this;e._resources&&e.$.mainSplitter.contains(e.$.resourceSplitter)&&(e._recycleResourceHeaderCells(),e._recycleResourceContent())}_getResourceCellWorkTime(e,t){const i=e.dateStart,r=e.dateEnd,n=t.dateStart,s=t.dateEnd,a=e.dateStart.getTime()<n.getTime()?n:i,o=r.getTime()>s.getTime()?s:r,l=Math.round(this._getWorkingTime(a,o)/36e5);return{value:l,max:a.getTime()===n.getTime()&&o.getTime()===s.getTime()?l:Math.round(this._getWorkingTime(n,s)/36e5)}}_refreshResourceTimelineContent(e,t){const i=this,r=i._resources.indexOf(e),n=i._getResourceTasks(e);if(t||(t=(()=>{const t=i.$.resourceTimelineCellsContainer.children;for(let i=0,r=t.length;i<r;i+=1){const r=t[i];if(r._cellObj&&r._cellObj.resource===e)return r}})()),r<0||!t||!t.childElementCount)return;let s=t.children;const a=i.$.resourceTimelineViewCells.children,o=i._tasks.filter((e=>!e.hidden));for(let t=0,l=s.length;t<l;t+=1){const l=s[t];let c,d=l.firstElementChild;n.length&&!e.hidden?(d?(d.classList.remove("hide-left-border","hide-right-border"),d.removeAttribute("load"),d.innerHTML=d.style.height=""):(d=document.createElement("div"),d.classList.add("smart-resource-timeline-view-cell"),c=!0),e.class&&d.classList.add(e.class),i._setResourceCellLoad({cell:d,cellIndex:t,resource:e,resourceCell:l,resourceIndex:r,resourceTasks:n,tasks:o,viewCells:a}),d.hasAttribute("load")?c&&l.appendChild(d):d.remove()):d&&d.remove()}}_setResourceCellLoad(e){const t=this,i=t.resourceTimelineFormatFunction,{cell:r,cellIndex:n,resource:s,resourceCell:a,resourceIndex:o,resourceTasks:l,tasks:c,viewCells:d}=e;let m={};for(let e=0,u=l.length;e<u;e+=1){const u=l[e];if(u.hidden)continue;const h=c.indexOf(u),g=t._getCellDateRange(d[n]),{dateStart:f,dateEnd:p}=g;if(!f||f.getTime()>=u.dateEnd.getTime()||p.getTime()<=u.dateStart.getTime())continue;if(m[n]&&m[n].indexOf(h)<0?m[n].push(h):m[r]||(m[n]=[h]),"custom"===t.resourceTimelineMode){i&&(r.innerHTML=i.call(t,m[n]||[],o,new Date(f))||"");continue}const _=t._getResourceCellCapacity({cell:r,cellDateRange:g,cellTaskIndexAssigned:m,index:o,resource:s,task:u,cellIndex:n});if(!_)continue;const{capacity:T,maxCapacity:k}=_,b=parseFloat(((parseFloat(r.getAttribute("load"))||0)+(T||0)).toFixed(1));b>k?r.classList.add("warning"):r.classList.remove("warning"),"histogram"!==t.resourceTimelineMode?b&&r.setAttribute("load",b):t._setCellHistogram({cell:r,load:b,maxCapacity:k,previousViewCell:a.previousElementSibling})}}_getResourceCellCapacity(e){const t=this,{cell:i,cellDateRange:r,cellTaskIndexAssigned:n,index:s,resource:a,task:o,cellIndex:l}=e;let c,d;if("tasks"===t.resourceTimelineView)c=1,d=a.maxCapacity;else if("hours"===t.resourceTimelineView){const e=t._getResourceCellWorkTime(o,r),i=e.max/24;c=parseFloat((e.value/e.max*a.capacity*i).toFixed(1)),d=Math.min(e.max,parseFloat((a.maxCapacity*i).toFixed(1)))}else{const e=t.resourceTimelineFormatFunction;if(!e)return;let a=e.call(t,n[l]||[],s,new Date(r.dateStart));if(null!=a)if(a="object"!=typeof a?[a]:Object.values(a),2===a.length)c=parseFloat(a[0])||0,d=parseFloat(a[1])||0;else if(1===a.length)return void i.setAttribute("load",a[0])}return{capacity:c,maxCapacity:d}}_setCellHistogram(e){const{load:t,cell:i,maxCapacity:r,previousViewCell:n}=e,s=Math.min(100,100*parseFloat((t/r).toFixed(2))),a=n?n.firstElementChild:void 0;if(a){const e=parseFloat(a.style.height)||0;s?e===s?(i.classList.add("hide-left-border"),a.classList.add("hide-right-border")):e>s?(i.classList.add("hide-left-border"),a.classList.remove("hide-right-border")):e<s&&(i.classList.remove("hide-left-border"),a.classList.add("hide-right-border")):(i.classList.remove("hide-left-border"),a.classList.remove("hide-right-border"))}i.style.height=s+"%",t&&i.setAttribute("load",t+"/"+r)}_recycleResourceHeaderCells(){const e=this;if(!e.$.mainSplitter.contains(e.$.resourceSplitterItem))return;const t=e.$.resourceTimelineViewCells,i=t.children,r=e.$.timelineViewCells.children;let n=document.createDocumentFragment();for(;i.length>r.length;)i[0].remove();for(let e=0;e<r.length;e++){const t=r[e];let s=i[e];s||(s=t.cloneNode(!0),n.appendChild(s)),s.style.left=t.style.left,s.style.right=t.style.right,s.style.width=t.style.width,s.innerHTML=t.innerHTML,s._date=t._date,t.hasAttribute("weekend")?s.setAttribute("weekend",""):s.removeAttribute("weekend"),t.hasAttribute("nonworking")?s.setAttribute("nonworking",""):s.removeAttribute("nonworking")}n.childElementCount&&t.appendChild(n),e.$.resourceTimelineCellsContainer.style.width=e.$.resourceTimelineViewCells.style.width=e.$.timelineContent.style.width}_refreshResourceScrollBar(){const e=this,t=e.$.resourceVerticalScrollBar;if(!e.$.mainSplitter.contains(e.$.resourceSplitter))return;const i=Math.max(0,e.$.resourceTimelineCellsContainer.offsetHeight-e.$.resourceTimelineContent.offsetHeight);0===i&&"visible"===e.verticalScrollBarVisibility?(t.max=1,e.scrollHeight||e.$container.removeClass("vscroll")):(e.$container.addClass("vscroll"),t.max=i),t.disabled="disabled"===e.verticalScrollBarVisibility||e.disabled||i<=0,!e.$.container.classList.contains("vscroll")&&t.disabled?t.classList.add("smart-hidden"):(t.classList.remove("smart-hidden"),t.refresh(),e.$.container.classList.contains("hscroll")?e.$.horizontalScrollBar.classList.add("bottom-corner"):e.$.container.classList.contains("vscroll")||e.$.horizontalScrollBar.classList.remove("bottom-corner"))}_handleResources(e){const t=this,i=e?[e]:t._tasks;t._resources||(t._resources=[]);for(let e=0;e<i.length;e++){let r=i[e].resources;Array.isArray(r)||(r=[r].reduce(((e,t)=>e.concat(t)),[]));for(let n=0;n<r.length;n++){let s=r[n];if("object"!=typeof s||!s||void 0===s.id||null===s.id){"number"==typeof s&&(r[n]=s+"");continue}let a=t._resources.find((e=>e.id&&e.id.toString()===s.id.toString()))||{};t._setResource(a,s,i[e]),r[n]=a.id,Object.values(a).length&&!t._resources.includes(a)&&t._resources.push(a)}}t._refreshItemIds("resource");const r=t._resources;for(let e=0,i=r.length;e<i;e+=1)t._refreshResource(r[e])}_refreshAssignedResources(e,t=[]){const i=this;if(!e.$.id||i._tasks.indexOf(e)<0)return;const r=i._getTaskResources(e);for(let e=0;e<r.length;e++){const n=r[e];let s=[];i.resourceColumns.forEach((e=>{void 0!==e.formatFunction&&s.push(e.value)})),s.concat(t),i.$.mainSplitter.contains(i.$.resourceSplitter)&&i._refreshResourceTimelineContent(n),t.includes("workload")?i._refreshResource(n,"workload"):t.includes("progress")&&i._refreshResource(n,"progress"),s.length&&i._refreshTableColumnsData(n,s,"resource")}}_refreshResource(e,t){const i=this;if(!i._resources.length)return;const r=i._getResourceTasks(e),n=864e5;switch(t){case"progress":e.progress=parseFloat((r.reduce(((e,t)=>e+t.progress),0)/r.length).toFixed(2));break;case"workload":e.workload=parseFloat((i._convertDuration(r.reduce(((e,t)=>e+t.duration),0))/n*e.maxCapacity).toFixed(2));break;default:e.progress=parseFloat((r.reduce(((e,t)=>e+t.progress),0)/r.length).toFixed(2)),e.workload=parseFloat((i._convertDuration(r.reduce(((e,t)=>e+t.duration),0))/n*e.maxCapacity).toFixed(2))}i.$.mainSplitter.contains(i.$.resourceSplitter)&&i._refreshResourceTimelineContent(e)}_setResource(e,t){if(t&&"object"==typeof t)return e.id?e.id=e.id.trim():e.id=(t.id+"").trim(),e.$||(e.$={}),e.class=t.class||e.class,e.minCapacity=t.minCapacity||e.minCapacity||0,e.maxCapacity=t.maxCapacity||e.maxCapacity||24,e.progress=t.progress||e.progress||0,e.capacity=t.capacity||e.capacity||8,e.type=t.type||e.type,e.hidden=!!("boolean"==typeof t.hidden?t.hidden:e.hidden),e.workload=e.workload||0,t.label?e.label=t.label:void 0===e.label&&(e.label=""),t.value&&(e.value=t.value),e}insertResource(e,t){const i=this,r=Array.from(arguments).filter((e=>void 0!==e));let n,s=i._resources;if(1===r.length&&(t=r[0]),"object"!=typeof t)return void i.error(i.localize("incorrectArgument",{elementType:i.nodeName.toLowerCase(),methodName:"insertResources",argumentName:"resource"}));if(t.id&&s.find((e=>e.id&&e.id.toString()===t.id.toString())))return void i.updateResource(t.id,t);if(t.assignedTo&&(n=[t.assignedTo].reduce(((e,t)=>e.concat(t,[])))),!(t=i._setResource({},t)))return;i._refreshItemIds("resource"),s=i._resources;const a=i._getValidItemAndIndex(e,"resource").index;if(a<0?s.push(t):s.splice(a,0,t),i._tasks.length){if(void 0!==n){Array.isArray(n)||(n=[n]);for(let e=0,r=n.length;e<r;e+=1){const r=i._getValidItemAndIndex(n[e],"task");if(r){const e=r.item;!e||e.disableResources||e.resources.includes(t.id.toString())||e.resources.push(t.id)}}if(i._isUpdating)return void(i._isUpdating.type.resource=!0);i._highlightAssignedItem("task",i._getSelection("task",i.selectedTaskIds)),i._refreshResource(t)}if(i._isUpdating)return i._isUpdating.type.resource=!0,void(i._isUpdating.type.task=!0);if(i.groupByResources)i._refreshTableDataSource(),i._refreshTimeline();else if(i.taskColumns.find((e=>"resources"===e.value))){const e=i._tasks.filter((e=>e.resources.includes(t.id)));for(let t=0;t<e.length;t++)i._refreshTableColumnsData(e[t],["resources"])}}i._isUpdating?i._isUpdating.type.resource=!0:(i._createResourceTimeline(),i.$.fireEvent("itemInsert",{type:"resource",item:i._cloneObject(t)}))}_insertTimelineResource(e,t,i){const r=this,n=r.$.resourceTimelineCellsContainer,s=document.createElement("div");s.classList.add("smart-timeline-row"),s._resource=t,r._refreshResourceTimelineContent(t,s),r.$.resourceTimelineCellsContainer.insertBefore(s,e>-1?n.children[e]:void 0),r.$.container.style.setProperty("--smart-gantt-chart-resource-timeline-content-height",n.offsetHeight+"px"),r._refreshResourceScrollBar(),r._insertNewTreeItem(e,t,i,"resource"),r.$.resourceTree.refresh(),r._highlightAssignedItem("task",r._getSelection("task",r.selectedTaskIds))}updateResource(e,t){if(void 0===e)return;const i=this._getValidItemAndIndex(e,"resource");i&&i.item&&this._updateResource(i.item,t)}removeResource(e){if(void 0===e)return;const t=this._getValidItemAndIndex(e,"resource");t&&t.item&&this._removeResource(t.item)}_getResourceTasks(e){const t=this._resources,i=this._tasks;if(!e||!t.length||!i.length)return;let r=[];for(let t=0;t<i.length;t++)i[t].resources.includes(e.id)&&r.push(i[t]);return r}_getTaskResources(e){const t=this;if(!e)return[];const i=[e.resources].reduce(((e,t)=>e.concat(t)),[]);let r=[];for(let e=0;e<i.length;e++){const n=t._resources.find((t=>t.id&&t.id.toString()===i[e].toString()));n&&r.push(n)}return r}_resourceValidator(e,t){const i=this;return Array.isArray(t)||t instanceof Smart.ObservableArray||"number"==typeof t||"string"==typeof t||null==t?t:(i.error(i.localize("invalidValue",{elementType:i.nodeName.toLowerCase(),property:"resources",typeOne:"array",typeTwo:"number"})),null)}_handleTaskProgressChange(e){const t=this,i=t._dragDetails.task,r=t._dragDetails.timelineTask;if(t.disableTaskProgressChange)return;if(!t.hasAttribute("progress-change")){if(t.$.fireEvent("progressChangeStart",{id:"string"==typeof i.id||"number"==typeof i.id?i.id:i.$.id,item:t._cloneObject(i),progress:i.progress||0}).defaultPrevented)return void delete t._dragDetails.target;t.setAttribute("progress-change",""),t._scrollView.disableSwipeScroll=t._touchmoveInside=!0}const n=r.querySelector(".smart-timeline-task-progress"),s=n.parentElement,a=s.getBoundingClientRect().left,o=s.offsetWidth,l=e.pageX-window.pageXOffset;t._dragDetails.progress||(t._dragDetails.progress=n.offsetWidth),t._dragDetails.progress=Math.max(0,Math.min(o,t._dragDetails.progress+(t.rightToLeft?-1:1)*(l-t._dragDetails.coordinates.x))),t._dragDetails.coordinates.x=Math.max(a+t._dragDetails.offset.x,Math.min(a+o+t._dragDetails.offset.x,l));const c=t._dragDetails.task.progress=t._dragDetails.progress/o*100;i.progress=parseFloat(c.toFixed(2)),t._setTaskBarProgress(i,r),t._refreshTableColumnsData(i,["progress"]),clearTimeout(t._resourceTreeRefreshTimeout),t.$.mainSplitter.contains(t.$.resourceSplitter)&&(t._resourceTreeRefreshTimeout=setTimeout((function(){t._refreshAssignedResources(i,["progress"]),delete t._resourceTreeRefreshTimeout}),t.resourcePanelRefreshRate))}_handleTaskBarDrag(e){const t=this;if(t.disableTaskDrag)return;if(Math.abs(e.pageX-t._dragDetails.coordinates.x)<=5)return void(t._scrollView.disableSwipeScroll=!0);const i=t._dragDetails.task,r=t._dragDetails.timelineTask,n=Array.from(t.$.taskTimelineCellsContainer.children).find((e=>e._cellObj.task===i));if(!t.hasAttribute("dragged")){if(t.$.fireEvent("dragStart",{id:"string"==typeof i.id||"number"==typeof i.id?i.id:i.$.id,item:t._cloneObject(i),dateStart:i.dateStart,dateEnd:i.dateEnd}).defaultPrevented)return void delete t._dragDetails.timelineTask;t.setAttribute("dragged",""),t._touchmoveInside=!0;const e=t._createDelimiter("min-date"),r=t._createDelimiter("max-date");e&&n.appendChild(e),r&&n.appendChild(r)}t._dragDetails.position||(t._dragDetails.position={x:t._dragDetails.originalPosition.x,y:t._dragDetails.originalPosition.y});const s=n.getBoundingClientRect().left,a=n.offsetWidth,o=r.offsetWidth,l=t._dragDetails.min.left||0,c=t._dragDetails.max.left,d=e.pageX-window.pageXOffset,m=t.rightToLeft;let u=0;t._dragDetails.position.x=Math.max(l,Math.min(a-o,t._dragDetails.position.x+(m?-1:1)*(d-t._dragDetails.coordinates.x))),void 0!==c&&(t._dragDetails.position.x=Math.min(c,t._dragDetails.position.x),u=a-o-c),t._dragDetails.coordinates.x=m?Math.max(s+t._dragDetails.offset.x+u,Math.min(s+a-(o-t._dragDetails.offset.x+l),d)):Math.max(s+t._dragDetails.offset.x+l,Math.min(s+a-(o-t._dragDetails.offset.x+u),d));const h=i.dateStart.getTime(),g=i.dateEnd.getTime();r.style[m?"right":"left"]=t._dragDetails.position.x+"px",t._refreshTask(r),t._refreshProject(i.$.project),t.groupByResources&&t._refreshProject(i.$.group),"project"===i.type&&i.dragProject&&t._refreshProjectTasks(i,{startTime:i.dateStart.getTime()-h,endTime:i.dateEnd.getTime()-g}),t.$.mainSplitter.contains(t.$.resourceSplitter)&&(clearTimeout(t._resourceTreeRefreshTimeout),t.$.mainSplitter.contains(t.$.resourceSplitter)&&(t._resourceTreeRefreshTimeout=setTimeout((function(){t._refreshAssignedResources(r._cellObj.task),delete t._resourceTreeRefreshTimeout}),t.resourcePanelRefreshRate)))}_handleTaskBarResize(e){const t=this;if(t.disableTaskResize)return;const i=t._dragDetails.timelineTask,r=t._dragDetails.task,n=Array.from(t.$.taskTimelineCellsContainer.children).find((e=>e._cellObj.task===r));if(!t.hasAttribute("resized")){if(t.$.fireEvent("resizeStart",{id:"string"==typeof r.id||"number"==typeof r.id?r.id:r.$.id,item:t._cloneObject(r),dateStart:r.dateStart,dateEnd:r.dateEnd}).defaultPrevented)return void t.$.timeline.removeAttribute("task-bar-hovered");t.setAttribute("resized",""),t._scrollView.disableSwipeScroll=t._touchmoveInside=!0}t._dragDetails.position||(t._dragDetails.position={x:t._dragDetails.originalPosition.x,y:t._dragDetails.originalPosition.y}),t._dragDetails.size||(t._dragDetails.size={width:t._dragDetails.originalSize.width});const s=t.$.timeline.getAttribute("task-bar-hovered"),a=n.getBoundingClientRect().left,o=t._dragDetails.min.width||0,l=t._dragDetails.max.width,c=e.pageX-window.pageXOffset;let d=t._dragDetails.size.width,m="object"==typeof e?c-t._dragDetails.coordinates.x:e;if("left"===s&&!t.rightToLeft||"right"===s&&t.rightToLeft)if(t.rightToLeft){m<0?m=-1*Math.min(Math.abs(m),d-(o||0)):void 0!==l&&(m=Math.min(l-d,Math.abs(m))),d=t._dragDetails.size.width=Math.max(o,Math.min(n.offsetWidth-i.offsetLeft,d+m));const e=i.offsetLeft;i.style.left="",i.style.right=Math.max(0,(parseFloat(i.style.right)||n.offsetWidth-i.offsetLeft-i.offsetWidth)-m)+"px",t._dragDetails.coordinates.x=Math.max(a+i.offsetLeft+o,Math.min(a+e+d,c))}else m>0?m=Math.min(m,d-(o||0)):void 0!==l&&(m=-1*Math.min(l-d,Math.abs(m))),d=t._dragDetails.size.width=Math.max(o,Math.min(i.offsetLeft+d,d-m)),i.style.right="",i.style.left=Math.max(0,(parseFloat(i.style.left)||i.offsetLeft)+m)+"px",t._dragDetails.coordinates.x=Math.max(a+i.offsetLeft,Math.min(a+i.offsetLeft+d-o,c));else t.rightToLeft?(m<0&&void 0!==l&&(m=-1*Math.min(l-d,Math.abs(m))),d=t._dragDetails.size.width=Math.max(o,Math.min(i.offsetLeft+i.offsetWidth,d-m)),i.style.width=t._dragDetails.size.width+"px",t._dragDetails.coordinates.x=Math.max(a+i.offsetLeft,Math.min(a+i.offsetLeft+d-o,c))):(m>0&&void 0!==l&&(m=Math.min(l-d,m)),d=t._dragDetails.size.width=Math.max(o,Math.min(n.offsetWidth-i.offsetLeft,d+m)),t._dragDetails.coordinates.x=Math.max(a+i.offsetLeft+o,Math.min(a+i.offsetLeft+(l||d),c)));i.style.width=t._dragDetails.size.width+"px",t._refreshTask(i),t._refreshProject(r.$.project),t.groupByResources&&t._refreshProject(r.$.group),clearTimeout(t._resourceTreeRefreshTimeout),t.$.mainSplitter.contains(t.$.resourceSplitter)&&(t._resourceTreeRefreshTimeout=setTimeout((function(){t._refreshAssignedResources(i._cellObj.task,["workload"]),delete t._resourceTreeRefreshTimeout}),t.resourcePanelRefreshRate))}_handleTimelineConnectionHover(e){const t=this;if(!(t.shadowRoot||t).contains(e))return;const i=t.$.timelineConnectionsContainer.children,r=e.closest(".smart-task-connection");if(r||!t.$.timelineConnectionsContainer.querySelector(".smart-task-connection[hover]")){if(r){const e=r.getAttribute("connection-id");for(let t=0;t<i.length;t++){const r=i[t];r.getAttribute("connection-id")===e?r.setAttribute("hover",""):r.removeAttribute("hover")}t._hoveredConnectionTasks=r.tasks}}else for(let e=0;e<i.length;e++)i[e].removeAttribute("hover")}_resetItemHover(){const e=this;if(e._hoveredItem){const t=e.$.mainSplitter.querySelectorAll(".smart-timeline-task[hover], .smart-timeline-row[hover], tr[hover]");for(let e=0;e<t.length;e++)t[e].removeAttribute("hover");e.$.timeline.removeAttribute("task-bar-hovered"),delete e._hoveredItem}}_handleTimelineHover(e,t){const i=this,r=i._isMobile;if(!e||r)return void i._resetItemHover();const n=e.originalEvent||e;let s="task",a=n.pageX&&r?document.elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset):n.target;if(n.pageX&&i.shadowRoot&&a===i&&(a=n.pageX&&r?i.shadowRoot.elementFromPoint(n.pageX-window.pageXOffset,n.pageY-window.pageYOffset):n.composedPath()[0]),!a||!a.closest||a===i||t)return void i._resetItemHover();i.$.resourceSplitter&&i.$.resourceSplitter.contains(a)?s="resource":i._handleTimelineConnectionHover(a);let o=a.closest(".smart-timeline-row")||a.closest(".smart-timeline-task");if(!o||!(i.shadowRoot||i).contains(o))return void i._resetItemHover();const l=o._cellObj[s],c=l.$.id,d=i._hoveredItem;if(!(d&&d.type===s&&d.id===c||(i._resetItemHover(),l.isGroup||("task"===s&&o.classList.contains("smart-timeline-row")&&(o=i.$.timelineTasksContainer.querySelector(`.smart-timeline-task[row-id="${c}"]`)),!o||i._connectionFeedback&&o.contains(i._connectionFeedback)||(o.setAttribute("hover",""),i._hoveredItem={id:c,type:s},r))))){const e=("task"===s?i.$.taskTimelineCellsContainer:i.$.resourceTimelineCellsContainer).querySelector(`.smart-timeline-row[row-id="${c}"]`);e&&(e.setAttribute("hover",""),i._handleTableItemHover(c,a))}}_getScrollLeft(e){return this.rightToLeft?e*=-1:e}_synchronizeSplitters(e,t){if(this.$.mainSplitter.contains(this.$.resourceSplitter)){const i=e._measurements,r=e.items,n=t.items,[s,a,o]=[i.dimension,i.minDimension,i.maxDimension],[l,c]=[n[0],r[0]],[d,m]=[n[1],r[1]];t.keepProportionsOnResize=!0,t.setAttribute("orientation-change",""),[a,o,s].forEach((e=>{const t=e===s?"size":e===a?"min":"max";l.set(t,""),d.set(t,""),l[t]=c.style[e],d[t]=m.style[e]})),t.removeAttribute("orientation-change"),t.keepProportionsOnResize=!1}}_resizeEventHandler(e){const t=this,i=t.$.taskSplitter;function r(e){e.refresh(),e===i&&t._synchronizeSplitters(i,t.$.resourceSplitter)}if(e&&"resizeEnd"===e.type){if(e.target===t.$.taskTreeSplitter||e.target===t.$.resourceTreeSplitter)return void r(e.target);e.target===t.$.resourceSplitter&&t._synchronizeSplitters(t.$.resourceSplitter,i)}if(!t._timelineCells)return void t._refresh();t.$.mainSplitter.refresh(),r(i);const n=t._getScrollLeft(t.scrollLeft);t._autoSchedule(),t._createTimelineCells(),t._recycleTimelineTasks(),t._recycleTimelineRowCells(),t._refreshResourceTimeline(),t._refresh(),t.$.taskTable.refresh(),t.$.timelineHeader.scrollLeft=t.$.taskTimelineContainer.scrollLeft=n,t.$.taskTable.scrollTop=t.$.taskTimelineContainer.scrollTop=t.scrollTop,t.$.mainSplitter.contains(t.$.resourceTimelineHeader)&&(t.$.resourceTimelineHeader.scrollLeft=t.$.resourceTimelineContent.scrollLeft=n,t.$.resourceTable.refresh(),t.$.resourceTable.scrollTop=t.$.resourceTimelineContent.scrollTop=t.$.resourceVerticalScrollBar.value),t._positionWindow()}_recycle(e){const t=this;if(t._recycleHeaderCells(t.$.timelineViewCells),t._recycleHeaderCells(t.$.timelineViewDetails),t._recycleResourceContent(),e&&"horizontal"===e.context.orientation)return;if(t._recycleContentCells(),t._recycleTimelineTasks(),!e)return;const i=Math.round(e.detail.value);e.target!==t.$.resourceVerticalScrollBar?t._refreshTableScrollTop(t.$.taskTable,i):t._refreshTableScrollTop(t.$.resourceTable,i)}_recycleContentCells(){const e=this,t=e._getFirstContentCellInView(),i=e.$.taskTimelineCellsContainer,r=e.$.timelineTasksContainer;if(!t)return void(i.innerHTML=r.innerHTML="");const n=t.height,s=1-(t.top+n-Math.abs(e.scrollTop))/n,a=e._timelineVCells?e._timelineVCells.length:0,o=!e.$.taskSplitter.offsetHeight,l=e.$.taskTimelineContainer.offsetHeight,c=!o&&l?Math.min(a,Math.ceil((parseFloat((l/n).toFixed(2))+s).toFixed(2))):a,d=e.$.timelineViewCells.children,m=document.createDocumentFragment();for(;i.childElementCount>c;)i.lastElementChild.remove();for(;r.childElementCount>c;)r.lastElementChild.remove();for(let t=i.childElementCount;t<c;t+=1){const t=document.createElement("div");t.classList.add("smart-timeline-row"),e._createTimelineRowCells(t,d),m.appendChild(t)}m.childElementCount&&i.appendChild(m);for(let e=r.childElementCount;e<c;e+=1){const e=document.createElement("div");e.classList.add("smart-timeline-task"),m.appendChild(e)}m.childElementCount&&r.appendChild(m)}_refreshTableScrollTop(e,t){this.$.mainSplitter.contains(e)&&void 0!==t&&(e.scrollTop=t)}_recycleHeaderCells(e){const t=this,i=e.children,r=t.scrollLeft,n=e===t.$.timelineViewCells,s=n?t._timelineCells:t._timelineHeaderCells;if(!s.length)return;let a=document.createDocumentFragment();for(;i.length;)a.appendChild(e.firstElementChild);const o=t._getFirstCellObjInView(s),l=1-(o.left+o.width-Math.abs(r))/s[0].width,c=a.children.length,d=n?Math.ceil((parseFloat((t.$.timeline.offsetWidth/o.width).toFixed(2))+l).toFixed(2)):t._getHeaderVisibleCellsCount();if(c>d)for(;a.children.length&&a.children.length!==d;)a.removeChild(a.firstElementChild);else if(c<d){const e=t._createCells(d-c);for(;e.children.length;)a.appendChild(e.firstElementChild)}const m=[t.rightToLeft?"right":"left"],u=n?t._getCellsViewType():t.view;let h=s.indexOf(o);for(let e=0;e<a.children.length;e++){const i=a.children[e],r=s[h];if(!r)break;let o=new Date(r.date);n||"week"!==t.view||(o.setDate(o.getDate()-o.getDay()),o=new Date(Math.max(r.date.getTime(),o.getTime()))),i.style[m]=r.left+"px",i.style.width=r.width+"px",i._date=o,i.innerHTML=`<div>${t._getDateString(o,u,!n)}</div>`,r.weekend?i.setAttribute("weekend",""):i.removeAttribute("weekend"),r.nonworking?i.setAttribute("nonworking",""):i.removeAttribute("nonworking"),h++}e.appendChild(a),n&&(t._recycleTimelineRowCells(),t._recycleResourceHeaderCells())}_refresh(){const e=this;let t="disabled"===e.verticalScrollBarVisibility;function i(){const t=e.$.timelineHeader,i=t.scrollWidth-t.offsetWidth;return i>0&&"hidden"!==e.horizontalScrollBarVisibility||"visible"===e.horizontalScrollBarVisibility?e.$container.addClass("hscroll"):e.$container.removeClass("hscroll"),i}function r(){let i=Math.max(0,e.$.timelineContent.offsetHeight-e.$.taskTimelineContainer.offsetHeight);return i>0&&"hidden"!==e.verticalScrollBarVisibility||"visible"===e.verticalScrollBarVisibility?e.$container.addClass("vscroll"):e.$.mainSplitter.contains(e.$.resourceSplitter)?(i=1,t=!0,e.$.resourceVerticalScrollBar.max||e.$container.removeClass("vscroll")):e.$container.removeClass("vscroll"),i}const n=e.scrollWidth,s=e.scrollHeight;let a=i(),o=r();o&&s===o||(a=i()),a&&n===a||(o=r()),e.scrollWidth=a,e.scrollHeight=o,e.$.verticalScrollBar.disabled=t,e.$.horizontalScrollBar.refresh(),e.$.verticalScrollBar.refresh(),e.$.mainSplitter.contains(e.$.resourceSplitter)&&(e._refreshResourceScrollBar(),e._refreshTableScrollTop(e.$.resourceTable))}_refreshProjectTasks(e,t){const i=this,r=i._getProjectTasks(e);if(!r.length)return;const n=i.nonworkingDays,s=i.nonworkingHours,a=i._timelineVCells;for(let e=0,o=r.length;e<o;e++){const o=r[e];if(o){const e=i._getTaskDOMIndex(o),r=a[e];o.dateStart=new Date(Math.max(i.dateStart.getTime(),o.dateStart.getTime()+t.startTime)),o.dateEnd=new Date(Math.min(i.dateEnd.getTime(),o.dateEnd.getTime()+t.endTime)),o.duration=i._convertDuration(n.length>0||s.length>0?i._getWorkingTime(o.dateStart,o.dateEnd):o.dateEnd.getTime()-o.dateStart.getTime(),!0),r&&(i._recycleTaskBars(r,e),i._setTimelineTaskBar(r,e),i._refreshTaskConnections(o),i._refreshTableColumnsData(o,["dateStart","dateEnd","duration"]))}}}_refreshProject(e){const t=this;function i(e){let i,r,n;if(e instanceof HTMLElement)i=e.offsetLeft,n=e.offsetWidth;else if(e){const s=t._getTimelineTaskCellByDate(e.dateStart),a=t._getTimelineTaskCellByDate(e.dateEnd);s&&a&&(i=s.left+t._getTimelineTaskOffset(s,e.dateStart)||0,r=a.left+t._getTimelineTaskOffset(a,e.dateEnd)||0,n=r-i)}return[i,n]}if(!e)return;const r=t.groupByResources&&e.isGroup?"group":"project";if(e.synchronized)for(;e&&e.synchronized;){const n=t._getProjectTasks(e);let s=n[0],a=n[0];for(let e=0;e<n.length;e++)s.dateStart.getTime()>=n[e].dateStart.getTime()&&(s=n[e]),a.dateEnd.getTime()<=n[e].dateEnd.getTime()&&(a=n[e]);const o=t.$.timelineTasksContainer.children,l=t.$.timelineContent.offsetWidth;let c,d,m;for(let t=0,i=o.length;t<i;t+=1){const i=o[t],r=i._cellObj?i._cellObj.task:void 0;r&&(r===e?c=i:r===s?d=i:r===e&&(m=i))}if(!c){s&&(e.dateStart=s.dateStart),a&&(e.dateEnd=a.dateEnd),e=e.$[r];continue}s&&(e.dateStart=s.dateStart);let[u,h]=i(d||s);void 0!==u&&void 0!==h&&(t.rightToLeft?(c.style.width=c.offsetWidth-(l-u-h-(l-c.offsetLeft-c.offsetWidth))+"px",c.style.right=d?d.style.right:u+"px"):(c.style.width=c.offsetWidth-(u-c.offsetLeft)+"px",c.style.left=d?d.style.left:u+"px")),a&&(e.dateEnd=a.dateEnd),[u,h]=i(m||a),void 0!==u&&void 0!==h&&(t.rightToLeft?c.style.width=Math.max(0,c.offsetWidth-(l-c.offsetLeft-(l-u)))+"px":c.style.width=Math.max(0,c.offsetWidth-(c.offsetLeft+c.offsetWidth-(u+h)))+"px"),t._refreshTask(c),e=e.$[r]}else t._refreshProject(e.$[r])}_refreshTask(e){const t=this,i=t._getTaskBarCellRange(e),r=i.cellStart,n=i.cellEnd;if(!i||!r||!n)return;e._cellStart=r,e._cellEnd=n;const s=t._getTaskBarDateRange(e);if(!s)return;const a=e._cellObj.task;if(!Array.from(t.$.taskTimelineCellsContainer.children).find((e=>e._cellObj.task===a)))return;a.dateStart=a.dateStart=s.dateStart,a.dateEnd=a.dateEnd=s.dateEnd,a.duration=a.duration=t._convertDuration(t.nonworkingDays.length>0||t.nonworkingHours.length>0?t._getWorkingTime(a.dateStart,a.dateEnd):a.dateEnd.getTime()-a.dateStart.getTime(),!0);const o=e=>e.getFullYear()+"-"+(e.getMonth()<10?"0"+e.getMonth():e.getMonth())+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate());e.setAttribute("aria-label",a.label+" Start date: "+o(a.dateStart)+", End date: "+o(a.dateEnd)),t._refreshTaskConnections(e),t._refreshTableColumnsData(a,["dateStart","dateEnd","duration"])}_refreshTaskResources(e,t=[]){const i=this;if(e&&(t||(t=i._getTaskResources(e)),t.length))for(let e=0;e<t.length;e++){const r=t[e];i._refreshResource(r),i._refreshTableColumnsData(r,void 0,"resource")}}_refreshTableColumnsData(e,t,i){const r=this;if(i||(i="task"),!e)return;const n=r[`${i}Columns`],s=r.$[`${i}Table`];if(!r.$.mainSplitter.contains(s))return;const a=e.$.id;t=t?t.map((e=>n.find((t=>t.value===e)))):n;for(let i=0;i<t.length;i++){const n=t[i];n&&s.setValue(a,n.value,r._formatColumnData(e,n))}r.$[`${i}Splitter`].refresh()}_removeConnection(e,t){const i=this,r=i.$.connectionPopupWindow,n=i.$.timelineConnectionsContainer;if(e.classList&&e.classList.contains("smart-task-connection")?e=e.getAttribute("connection-id"):e+="",void 0===e)return;const s=n.querySelectorAll('.smart-task-connection[connection-id^="'+e+(e.indexOf("-")<0?"-":"")+'"]'),a=i._tasks,o=e.split("-"),l=parseInt(o[1]);for(let e=0;e<s.length;e++)n.removeChild(s[e]);let c;const d=parseInt(o[0]),m=parseInt(o[1]),u=parseInt(o[2]);if(r&&"number"==typeof r._target.type){const t=r._target;c=t.startIndex+"-"+t.endIndex+"-"+t.type===e}i._updateConnection([d,m,u],!0),!t&&i.autoSchedule&&(i._autoScheduleRestore(a[l],parseInt(o[2])),i._autoSchedule(a[l])),c&&i.$.fireEvent("itemRemove",{type:"connection",id:`${d}-${m}-${u}`,item:{source:d,target:m,type:u}})}_removeTaskConnections(e,t){const i=this,r=i._connections;if(r&&r.length){for(let t=0,i=r.length;t<i;t+=1)r[t].startTask===e&&(r.splice(t,1),i--);e.connections=[],t&&i._recycleConnections()}}_removeTask(e){const t=this,i=t._tasks;if(!e||!i||!i.length)return;const r=t._getSelection("task",t.selectedTaskIds),n=t.$.taskPopupWindow;let s;if(t._highlightAssignedItem("task",[e]),n&&n._target===e&&n.close(),"project"===e.type){const r=t._getProjectTasks(e);for(let e=0,t=r.length;e<t;e+=1)i.splice(i.indexOf(r[e]),1)}if(i.splice(i.indexOf(e),1),t._refreshItemIds(),t._refreshConnectionIds(),t._isUpdating)return t._isUpdating.type.task=!0,void(t._isUpdating.type.resource=!0);t._refreshSelectedItems(),t._refreshTableDataSource(),t._refreshTimeline(),t._selected&&t._selected.task&&(s=t._selected.task.map((e=>e.$.id)),r.toString()!==s.toString()&&(t.$.taskTable.selected=t._getSelection("task",t.selectedTaskIds))),t.$.fireEvent("itemRemove",{type:"task",id:"string"==typeof e.id||"number"==typeof e.id?e.id:e.$.id,item:t._cloneObject(e)})}_removeResource(e){const t=this,i=t._resources,r=i.indexOf(e);if(e&&!(r<0)){if(t._isUpdating)return i.splice(r,1),t._isUpdating.type.resource=!0,void(t._isUpdating.type.task=!0);if(i.splice(r,1),t.groupByResources)t._refreshTableDataSource(),t._createTimelineContent(),t._refresh(),t._recycleTimelineTasks();else if(t.taskColumns.find((e=>"resources"===e.value))){const i=t._tasks.filter((t=>t.resources.includes(e.id)));for(let e=0;e<i.length;e++)t._refreshTableColumnsData(i[e],["resources"])}if(!i.filter((e=>!e.hidden)).length)return t._createResourceTimeline(),t._resizeEventHandler(),void n();t._refreshResourceTimeline(),t._refreshTableDataSource("resource"),t.$.mainSplitter.contains(t.$.resourceSplitter)?(t._refreshResourceScrollBar(),t._resizeEventHandler(),n()):n()}function n(){t.$.fireEvent("itemRemove",{type:"resource",id:"string"==typeof e.id||"number"==typeof e.id?e.id:e.$.id,item:t._cloneObject(e)})}}_updateTask(e,t){const i=this,r=i._tasks;if(!e||!r||!r.length)return;const n=i.$.taskPopupWindow,s=i._getSelection("task",i.selectedTaskIds);n&&n._target===e&&n.close();let a,o=i._getTaskResources(e);for(let n in t){let s=e[n],l=t[n];if("type"===n&&s!==l&&["task","project","milestone"].indexOf(l)>-1&&"project"===s){const t=i._getProjectTasks(e);for(let e=0,i=t.length;e<i;e+=1)r.splice(r.indexOf(t[e]),1);delete e.tasks}if("project"!==e.type||!e.synchronized||!(n.toLowerCase().indexOf("date")>-1||n.toLowerCase().indexOf("duration")>-1))if("dateEnd"===n&&new Date(s).getTime()!==new Date(l).getTime()&&(a=!0),"tasks"!==n)"connections"===n&&(i._removeTaskConnections(e),i._handleTaskConnections(e)),e[n]=l,"resources"===n&&(i._handleResources(e),e.disableResources||(o=o.concat(i._getTaskResources(e)),o=o.filter(((e,t)=>o.indexOf(e)===t)))),"milestone"!==e.type||"dateStart"!==n&&"dateEnd"!==n||(e.dateEnd=e.dateStart=l);else if("project"===e.type){const t=i._getProjectTasks(e);for(let e=0,i=t.length;e<i;e+=1)r.splice(r.indexOf(t[e]),1);const n=i._createTasks(l,!0);for(let t=0,i=n.length;t<i;t+=1)n[t].$.project=e;i._insertTasks(n,e,r.indexOf(e))}}a&&delete e.duration;const l=e.$,c=e.$.project;if(i._validateTaskProperties(e,c),e.$=l,c&&i._synchronizeProjectDates(c),"project"===e.type&&e.hidden&&i._getProjectTasks(e).forEach((t=>t.hidden=e.hidden)),i._synchronizeProjectVisibility(e.$.project,e),i._refreshItemIds(),i._refreshConnectionIds(),i._isUpdating)return void(i._isUpdating.type.task=!0);let d;i._selected&&i._selected.task&&i._setSelection("task",d=i._selected.task.map((e=>e.$.id))),i._refreshTableDataSource(),i._refreshTimeline(),i._ensureVisible(e),d&&s.toString()!==d.toString()&&(i.$.taskTable.selected=d.slice(0)),i._refreshTaskResources(e,o),i._highlightAssignedItem("task",i._getSelection("task",i.selectedTaskIds)),i.$.fireEvent("itemUpdate",{type:"task",id:"string"==typeof e.id||"number"==typeof e.id?e.id:e.$.id,item:i._cloneObject(e)})}_updateResource(e,t){const i=this;if(!e)return;const r=e.hidden;if(i._setResource(e,t),i._isUpdating)i._isUpdating.type.resource=!0;else{if(i.groupByResources)i._refreshTableDataSource(),i._refreshTimeline();else if(i.taskColumns.find((e=>"resources"===e.value))){const t=i._tasks.filter((t=>t.resources.includes(e.id)));for(let e=0;e<t.length;e++)i._refreshTableColumnsData(t[e],["resources"])}if(r!==e.hidden)return i._createResourceTimeline(),void i.$.fireEvent("itemUpdate",{type:"resource",id:"string"==typeof e.id||"number"==typeof e.id?e.id:e.$.id,item:i._cloneObject(e)});if(i._refreshTableColumnsData(e,void 0,"resource"),i.$.mainSplitter.contains(i.$.resourceTimelineCellsContainer)){const t=i.$.resourceTimelineCellsContainer.children;for(let r=0;r<t.length;r++){const n=t[r];n._resource===e&&i._refreshResourceTimelineContent(e,n)}}i.$.fireEvent("itemUpdate",{type:"resource",id:"string"==typeof e.id||"number"==typeof e.id?e.id:e.$.id,item:i._cloneObject(e)})}}_select(e="task",t){const i=this;if(i.disableSelection||!t)return void i._unselectAll(e);let r,n;"task"===e?(r="selectedTaskIds",n=i._tasks):(r="selectedResourceIds",n=i._resources);const s=n.findIndex((e=>e.$.id===t)),a=i._getSelection(e,i[r]);s<0||(a.indexOf(t)>-1?i.$[`${e}Table`].unselect(t):i.$[`${e}Table`].select(t))}_handleTableSelection(e="task",t){const i=this;if(i.disableSelection||!t.length)return void i._unselectAll(e);let r,n,s,a,o,l=i._selected;l||(l=i._selected={});const c=t[t.length-1],d=l[e]=[];"task"===e?(o=i._tasks,r="selectedTaskIds",n=i.$.taskTimelineCellsContainer.children,s=i.$.timelineTasksContainer.children):(o=i._resources,r="selectedResourceIds",n=i.$.resourceTimelineCellsContainer.children,s=[]);for(let e=0,i=o.length;e<i;e+=1){const i=o[e];t.indexOf(i.$.id)>-1&&d.push(i)}for(let i=0,r=n.length;i<r;i+=1){const r=n[i],o=s[i],l=r._cellObj[e].$.id;c===l&&(a=s[i]),t.indexOf(l)>-1?(r.setAttribute("selected",""),r.setAttribute("aria-selected","true"),o&&o.setAttribute("selected","")):(r.removeAttribute("selected"),r.setAttribute("aria-selected","false"),o&&o.removeAttribute("selected"))}const m=i[r].slice(0);if(i._setSelection(e,t),!i._tableChangeEventFired){const r=document.scrollingElement||document.documentElement,n=r.scrollLeft,s=r.scrollTop;i._highlightAssignedItem(e,t),i.$[`${e}Table`].focus({preventScroll:!0}),window.scrollTo(n,s)}if("task"===e&&a){const e=a._cellStart;if(i.scrollLeft>e.left||e.left+a.offsetWidth>i.scrollLeft+i.$.timeline.offsetWidth){const t=i._timelineCells.indexOf(e);i._scrollTo((i._timelineCells[t-1]?i._timelineCells[t-1]:e).date)}}i._noChangeEvent||i.$.fireEvent("change",{type:e,value:i[r].slice(0),oldValue:m})}_setSelection(e="task",t){const i=this;let[r,n]="task"===e?[i._tasks,"selectedTaskIds"]:[i._resources,"selectedResourceIds"],s=[];for(let e=0,i=t.length;e<i;e+=1){const i=t[e],n=r.find((e=>e.$.id===i));n&&s.push(void 0!==n.id?n.id:i)}i.set(n,s)}_getSelection(e="task",t){const i="task"===e?this._tasks:this._resources;let r=t.slice(0);if(!t||!t.length)return r;for(let e=0,n=i.length;e<n;e+=1){const n=i[e],s=t.indexOf(n.id);s>-1&&(r[s]=n.$.id)}return r}_highlightAssignedItem(e,t){const i=this,[r,n]="task"===e?["resource","_getTaskResources"]:["task","_getResourceTasks"],s=i.$[`${r}Table`],a=i[`_${r}s`];if(!s||!i.$.mainSplitter.contains(s)||!a.length)return;t&&Array.isArray(t)||(t=[]);let o=[];for(let r=0,s=t.length;r<s;r+=1){const s=i._getValidItemAndIndex(t[r],e);s&&(o=o.concat(i[n](s.item).filter((e=>!e.hidden))))}i._tableChangeEventFired=!0,s.selected=o.map((e=>e.$.id)),o.length&&i._ensureVisible(o[0],r),delete i._tableChangeEventFired}_selectResource(e){const t=this,i=t._resources.indexOf(e);if(i<0)return void t._unselectAll("resource");const r=t.$.resourceTimelineCellsContainer.children[i];r&&r.hasAttribute("selected")?t._unselectAllTasks():t.$.resourceTree.focus({preventScroll:!0})}_snapToNearest(e){const t=this;if(e instanceof HTMLElement&&e.classList.contains("smart-timeline-task")&&t.snapToNearest){const i=t._getTaskBarCellRange(e);if(!i)return;const r=i.cellStart,n=i.cellEnd;let s=parseFloat(e.style.width)||e.offsetWidth,a=parseFloat(e.style[t.rightToLeft?"right":"left"])||e.offsetLeft;if(t.hasAttribute("dragged")){const i=n.width-(a+s-n.left);a-r.left<=i?e.style[t.rightToLeft?"right":"left"]=r.left+"px":e.style[t.rightToLeft?"right":"left"]=a+i+"px"}else if(t.hasAttribute("resized")){const i=r===n&&parseFloat(getComputedStyle(t).getPropertyValue("--smart-gantt-chart-timeline-task-min-width"))||0;let o;"left"===t.$.timeline.getAttribute("task-bar-hovered")?(o=a-r.left,o-=o>=r.width/2?r.width-i:0,e.style[t.rightToLeft?"right":"left"]=(a-=o)+"px",o=a+s>n.left+n.width/2?n.left+n.width-(a+s):n.left-(a+s),e.style.width=Math.max(i,s+o)+"px"):(a>r.left+r.width/2?e.style[t.rightToLeft?"right":"left"]=r.left+r.width+"px":e.style[t.rightToLeft?"right":"left"]=r.left+"px",a=parseFloat(e.style[t.rightToLeft?"right":"left"])||e.offsetLeft,o=a+s-n.left,o=-1*(o-(o>=r.width/2?n.width:i)),e.style.width=s+o+"px")}t._refreshTask(e);const o=e._cellObj.task;if("project"!==o.type||!o.dragProject)return;const l=t._getProjectTasks(o);if(!l||!Array.isArray(l))return;for(let e=0;e<l.length;e++){const i=t.$.timelineTasksContainer.children[t._tasks.indexOf(l[e])];i&&t._snapToNearest(i)}}}_setDragLimits(e){const t=this;if(!t._dragDetails)return;const i=t._dragDetails.timelineTask;if(!i||!e)return;const r=t.$.timeline.getAttribute("task-bar-hovered"),n=i._cellObj.task;if(r){if(n.disableResize)return void delete t._dragDetails;const e=t._getTaskBarSizeLimits(i,r);t._dragDetails.min.width=e.min,t._dragDetails.max.width=e.max;const s=t._createDelimiter("min",r),a=t._createDelimiter("max",r);s&&i.appendChild(s),a&&i.appendChild(a)}else if(e.closest(".smart-task-connection-point"))t._dragDetails.timelineTask=void 0;else if(e.closest(".smart-timeline-task")===i){let e;if(t._connections){const r=t._tasks.indexOf(i._cellObj.task);e=t._connections.some((e=>e.startIndex===r||e.endIndex===r))}if(n.disableDrag||e&&t.autoSchedule&&t.autoScheduleStrictMode)return void delete t._dragDetails.target;t._dragDetails._taskDuration=t._getWorkingTime(n.dateStart,n.dateEnd),i.classList.contains("milestone")&&(t._dragDetails.target="smart-timeline-task-fill");const r=t._getTaskDragLimits(i),s=t.rightToLeft?t.$.timelineContent.offsetWidth-i.offsetLeft-i.offsetWidth:i.offsetLeft;if(void 0!==r.min&&(t._dragDetails.min.left=r.min,"project"===i._cellObj.task.type&&r.min>s&&(t._dragDetails.min.left=s)),void 0!==r.max&&(t._dragDetails.max.left=r.max,"project"===i._cellObj.task.type&&r.max<s&&(t._dragDetails.max.left=s)),"project"===n.type&&n.dragProject&&!t.synchronized){const e=t._getSubTaskLimits(i);void 0!==e.min&&(t._dragDetails.min.left=t._dragDetails.min.left?Math.max(t._dragDetails.min.left,e.min):e.min),void 0!==e.max&&(t._dragDetails.max.left=t._dragDetails.max.left?Math.min(t._dragDetails.max.left,e.max):e.max)}else"milestone"===n.type&&(t._dragDetails.target="smart-timeline-task-fill")}else t._dragDetails.timelineTask=void 0;t._dragDetails.relatedConnections={}}_setScrollBars(){const e=this;e._scrollView||(e._scrollView=new Smart.Utilities.Scroll(e.$.taskSplitterItem,e.$.horizontalScrollBar,e.$.verticalScrollBar));const t=e._scrollView.vScrollBar,i=e._scrollView.hScrollBar;i.$.addClass("smart-hidden"),t.$.addClass("smart-hidden"),t.hasStyleObserver=!1,i.hasStyleObserver=!1,t.hasResizeObserver=!1,i.hasResizeObserver=!1,t.rightToLeft=i.rightToLeft=e.rightToLeft,i.wait=!1,e._refresh()}_getWorkingTime(e,t){const i=this;if(!e||!t)return;if(!i.adjustToNonworkingTime)return t.getTime()-e.getTime();const r=i.nonworkingHours,n=i.nonworkingDays;function s(e,t){let i,s,a=t.getTime()-e.getTime(),o=new Date(e),l=0;for(;a>0;){const e=Math.min(a,36e5-(60*o.getMinutes()*1e3+1e3*o.getSeconds()+o.getMilliseconds()));if(n.indexOf(o.getDay())>-1)s=new Date(o),s.setHours(0,0,0,0),s.setDate(o.getDate()+1),i=Math.min(e,s.getTime()-o.getTime()),o=new Date(o.getTime()+i),a-=i;else if(r.indexOf(o.getHours())>-1){s=new Date(o);const t=s.getTime();s.setHours(o.getHours()+1,0,0,0),t===s.getTime()&&s.setHours(o.getHours()+2,0,0,0),i=Math.min(e,s.getTime()-o.getTime()),o=new Date(o.getTime()+i),a-=i}else l+=e,a-=e,o=new Date(o.getTime()+e)}return l}if(e.getFullYear()===t.getFullYear())return s(e,t);let a=new Date(e.getFullYear()+1,0,1,0,0,0,0),o=s(e,a);if(t.getFullYear()>a.getFullYear()){const e=Math.max(0,t.getFullYear()-a.getFullYear());for(let t=0;t<e;t++){let e=i._getWorkingDaysBetweenDays(a);o+=60*(24*e-e*i.nonworkingHours.length)*60*1e3,a.setFullYear(a.getFullYear()+1)}}return o+=s(a,t),o}_getWorkingDaysBetweenDays(e){const t=this,i=e.getFullYear(),r=(i%100==0?i%400==0:i%4==0)?366:365;let n=new Date(e),s=0;for(let e=0;e<r;e++)t.nonworkingDays.indexOf(n.getDay())<0&&s++,n.setDate(n.getDate()+1);return s}_setFocusable(){const e=this;e.disabled||e.unfocusable?e.tabIndex=-1:e.tabIndex=e.tabIndex>0?e.tabIndex:0}_setTaskBarLabel(e,t,i){const r=this;void 0===t&&(t=r._getTaskDOMIndex(e));const n=r.$.timelineTasksContainer.children[t];if(!n)return;const s=n.getElementsByClassName("smart-timeline-task-label")[0];s&&(s.innerHTML=e.formatFunction?e.formatFunction(e.label,t)||"":i||e.label)}_setTaskBarProgress(e,t){const i=this;if("number"==typeof t?t=i.$.timelineTasksContainer.children[t]:void 0===t&&(t=i.$.timelineTasksContainer.children[i._getTaskDOMIndex(e)]),!t||!e)return;let r=e.progress;const n=t.querySelector(".smart-timeline-task-progress"),s=t.querySelector(".smart-timeline-task-progress-thumb");if(n)if(r=Math.min(100,Math.max(0,r))||0,s.style[i.rightToLeft?"left":"right"]="",s.style[i.rightToLeft?"right":"left"]=n.style.width=r+"%",i.showProgressLabel){const e=i.progressLabelFormatFunction;n.setAttribute("value",e?e(r)+"":parseFloat(r.toFixed(2))+"%")}else n.removeAttribute("value")}_setTimelineTaskBar(e,t,i){const r=this,n=e.task,s=void 0===t?r._getTaskDOMIndex(n):t,a=r.$.timelineTasksContainer.children,o=a[s];let l,c;if(0===a.length||!o||!o.classList||!o.classList.contains("smart-timeline-task"))return;if(l=!i&&o._cellStart||r._getTimelineCellByDate(n.dateStart instanceof Date?n.dateStart:new Date(n.dateStart)),c=!i&&o._cellEnd||r._getTimelineCellByDate(n.dateEnd instanceof Date?n.dateEnd:new Date(n.dateEnd)),!l||!c)return void o.classList.add("smart-visibility-hidden");o._cellStart=l,o._cellEnd=c,o.classList.remove("smart-visibility-hidden");const d=r._getTaskBarDetails(e,l,c);d&&(o.style[r.rightToLeft?"left":"right"]="",o.style[r.rightToLeft?"right":"left"]=d.left+"px",o.style.width=d.width?d.width+"px":"",o.style.top=d.top+"px")}_getTaskDOMIndex(e){const t=this.$.timelineTasksContainer.children;if(!e||void 0===e.$.id)return-1;for(let i=0,r=t.length;i<r;i+=1)if(t[i]._cellObj.task===e)return i;return-1}_getTimelineCellByDate(e){const t=this,i=t._timelineCells;if(!i||0===i.length)return;for(let r=0;r<i.length;r++){const n=i[r],s=n.date;switch(t.view){case"year":if(s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth())return n;break;case"month":{const t=new Date(s);let i=new Date(s);if(i.setDate(i.getDate()+(6-i.getDay())+1),i.setMilliseconds(i.getMilliseconds()-1),e.getTime()>=t.getTime()&&e.getTime()<=i.getTime())return n;break}case"week":if(s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth()&&s.getDate()===e.getDate())return n;break;case"day":if(s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth()&&s.getDate()===e.getDate()&&s.getHours()===e.getHours())return n}}const r=i[0],n=i[i.length-1];return e.getTime()<r.date.getTime()?r:e.getTime()>n.date.getTime()?n:void 0}_refreshViewDetailCell(e,t,i){const r=this,n=r._timelineCells,s=e.date;let a=0,o=0===i?0:void 0;for(void 0===t&&(t=0);t<n.length;t++){const e=n[t],i=r._getCellWidth(e,s);if(i)void 0===o&&(o=e.left+e.width-i),a+=i;else if(e.date.getTime()>s.getTime())break}return r._isLastWeekCellNotFull&&(delete r._isLastWeekCellNotFull,t--),e.width=a,e.left=o,t}_getCellWidth(e,t){const i=this,r=e.date,n=(e,t)=>e.getFullYear()===t.getFullYear(),s=(e,t)=>e.getMonth()===t.getMonth(),a=e.width;switch(i.view){case"month":{let e=new Date(r),o=new Date(e),l=0;for(o.setDate(o.getDate()+(6-e.getDay())+1),o.setMilliseconds(o.getMilliseconds()-1);e.getTime()<=o.getTime();)n(e,t)&&s(e,t)&&l++,e.setDate(e.getDate()+1);if(0===l)return;return i._isLastWeekCellNotFull=l/7!=1,a*l/7}case"year":if(n(r,t))return a;break;case"week":{const e=new Date(t),i=new Date(t);if(e.setDate(t.getDate()-t.getDay()),i.setDate(t.getDate()+(6-t.getDay())),r.getTime()>=e.getTime()&&r.getTime()<=i.getTime())return a;break}case"day":if(n(r,t)&&s(r,t)&&r.getDate()===t.getDate())return a}}_getCellByOffsetLeft(e){const t=this._timelineCells;if(!e)return;let i;for(let r=0;r<t.length&&!(t[r].left>=e);r++)i=t[r];return i}_unselectAll(e,t){const i=this,r=i.$[`${e}TimelineCellsContainer`];let n;delete i._selected;const s=r.querySelectorAll(".smart-timeline-row[selected]");for(let e=0;e<s.length;e++)s[e].removeAttribute("selected");if("task"===e){n="selectedTaskIds";const e=i.$.timelineTasksContainer.querySelectorAll(".smart-timeline-task[selected]");for(let t=0;t<e.length;t++)e[t].removeAttribute("selected"),e[t].setAttribute("aria-selected","false")}else n="selectedResourceIds";if(i[`_${e}TreeChangeEventFired`]||i.$[e+"Table"].clearSelection(),i._highlightAssignedItem(e),t)return;const a=i[n].slice(0);a.length&&(i[n]=[],i._noChangeEvent||i.$.fireEvent("change",{value:[],oldValue:a,type:e}))}_getTaskBarCellRange(e){const t=this;if(!e.classList||!e.classList.contains("smart-timeline-task"))return;let i=parseFloat(e.style.width)||e.offsetWidth;const r=t._timelineCells,n=t.$.timelineContent,s=parseFloat(e.style[t.rightToLeft?"right":"left"])||(t.rightToLeft?(parseFloat(n.style.width)||n.offsetWidth)-(e.offsetLeft+e.offsetWidth):e.offsetLeft);let a,o;e.classList.contains("milestone")&&(i/=2);for(let e=0;e<r.length;e++){const t=r[e],n=t.left,l=t.width,c=parseFloat((n+l).toFixed(2)),d=parseFloat((s+i).toFixed(2));if(s>=n&&s<=c&&(a=t),!o&&d>n&&d<=c&&(o=t),a&&o)break}return a||(a=e.classList.contains("milestone")&&o?o:r[0]),o||(o=r[r.length-1]),{cellStart:a,cellEnd:o}}_getDateFromCell(e,t,i){if(!t)return new Date;const r=this,n=new Date(t.date);let s,a=0,o=0,l=new Date(n);switch(l.setHours(0,0,0,0),i||(i=r.view),i){case"year":s=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),a=1,l.setDate(s);break;case"month":a=n.getDate(),s=7,l.setDate(l.getDate()+6);break;case"week":s=1,a=n.getDate();break;case"day":s=1/24,a=n.getDate(),o=n.getHours()}l.setHours(23,59,59,999);const c=parseFloat(((e-t.left)/t.width*s).toFixed(12)),d=Math.min(s,Math.floor(c)),m=c%1*24,u=Math.floor(m),h=60*Math.abs(m-u),g=Math.floor(h),f=60*Math.abs(h-g),p=Math.floor(f),_=1e3*Math.abs(f-p),T=Math.floor(_),k=new Date(n.getFullYear(),n.getMonth(),a+d,o+u,g,p,T);return k.getTime()>l?l:k}_getCellDateRange(e){if(!e||!e._date)return;const t=new Date(e._date);let i=new Date(t);switch(i.setHours(0,0,0,0),this.view){case"year":i.setDate(1),i.setMonth(i.getMonth()+1),i.setDate(0);break;case"month":i.setDate(i.getDate()+6);break;case"day":return i.setHours(i.getHours(),59,59,999),{dateStart:t,dateEnd:i}}return i.setHours(23,59,59,999),{dateStart:t,dateEnd:i}}_getTasksJSON(){const e=this;let t=e._tasks;return function t(i,r){if(!i)return;let n=[];for(let s=0;s<i.length;s++){const a=i[s];let o;if(!a.$.project&&!r||a.$.project===r){const i=e._getTaskConnections(a).taskConnections;o=e._cloneObject(a,!0),i.length&&(o.connections=i.map((e=>{const t={target:e.endIndex,type:e.type};return e.lag&&(t.lag=e.lag),t}))),o.tasks=t(e._getProjectTasks(a),a),delete o.$,n.push(o)}}return n}(t)}_cloneObject(e,t){let i={};for(let r in e){let n=e[r];"tasks"!==r&&("connections"!==r?n instanceof Date?i[r]=t?n.toISOString():new Date(n):i[r]=n:i[r]=JSON.parse(JSON.stringify(n)))}return t||delete i.$,i}_setTable(e){const t=this;e||(e=t.$.taskTable);const[i,r]=e===t.$.taskTable?[t.taskColumns,"task"]:[t.resourceColumns,"resource"];if(!t.contains(e))return;if(!i.length)return void(t.$[r+"Table"].dataSource=[]);const n=t._getTableColumns(r);"task"===r&&(e.filterRow=t.filterRow,[e.grouping,e.groupFormatFunction]=t.groupByResources?[!0,t._formatResourceGroups.bind(t)]:[!1,null]),e.isRendered&&e.resetState("expanded"),e.style.setProperty("--smart-table-row-height",""),e.columns=n,e.dataSource=t._getTableDataSource(r,n),e.wait&&(t.$.taskTable.hasResizeObserver=!1,e.$.virtualizationContainer._scrollView.disableSwipeScroll=!0,e.$.virtualizationContainer.verticalScrollBarVisibility="hidden",e.$.virtualizationContainer.disabled=!0,e.columnMinWidth=t.columnMinWidth,e.columnResize=t.columnResize,e.columnResizeFeedback=t.columnResizeFeedback,e.filtering=t[`${r}Filtering`],e.sort=t.sortFunction,e.sortMode=t.sortMode,e.keyboardNavigation=t.keyboardNavigation,e.selectionByHierarchy=!1,e.selection=!t.disableSelection,e.onKeyboardScroll=(i,r)=>{const n=e===t.$.taskTable?t:t._resourceScrollView;r!==n.scrollTop&&(n.scrollTop=r)},e.wait=!1),e.$.virtualizationContainer.scrollTop="task"===r?t.scrollTop:t.$.resourceVerticalScrollBar.value,t._refresh()}_formatResourceGroups(e){const t=this,i=t._resources,r=e.data.data.resources.split(",");let n=[];for(let e=0,t=i.length;e<t;e+=1){const t=i[e],s=t.id+"";r.indexOf(s)>-1&&n.push(t.label||t.value||t.id)}t.resourceGroupFormatFunction?e.template=t.resourceGroupFormatFunction(r):e.template="<strong>"+(n.length?n.join(", "):t.localize("unassigned"))+"</strong>"}_formatResourceGroupLabel(e){const t=this,i=t._resources,r=e.split(",");if(!e)return t.localize("unassigned");let n=[];for(let e=0,t=i.length;e<t;e+=1){const t=i[e],s=t.id+"";r.indexOf(s)>-1&&n.push(t.label||t.value||t.id)}return n.length?n.join(", "):t.localize("unassigned")}_getTableColumns(e="task"){const t=this,i=["dateStart","dateEnd","minDateStart","maxDateStart","minDateEnd","maxDateEnd"],r=["progress","capacity","workload","maxCapacity","minCapacity"];let n="task"===e?t.taskColumns:t.resourceColumns,s=[];"task"===e&&t.groupByResources&&!n.find((e=>"resources"===e.value))&&(n=n.slice(0),n.push({label:"",value:"resources",hidden:!0}));for(let a=0,o=n.length;a<o;a++){const o=n[a],l=o.value,c={};c.label=t.localize(o.label)||o.label,c.dataField=l,l.startsWith("date")||i.indexOf(l)>-1?c.dataType="date":c.dataType=l.startsWith("duration")||r.indexOf(l)>-1?"number":"string",o.hidden&&(c.visible=!1),"function"==typeof o.formatFunction?c.formatFunction=i=>{const r=t._getValidItemAndIndex(i.data.itemId,e).item,n=i.column.toLowerCase();let s=i.value;n.indexOf("date")>-1?s=new Date(s):"resources"===n&&(s=s?s.split(","):[]),i.template=o.formatFunction.call(t,s,r?t._cloneObject(r):void 0)}:(o.dateFormat||o.numberFormat)&&(c.formatFunction=i=>{const r=t._getValidItemAndIndex(i.data.itemId,e).item,n=t._formatColumnData(t._cloneObject(r),o);i.template=n}),o.size&&(c.width=o.size),s.push(c)}return s}_getTableDataSource(e="task",t){const i=this,r="task"===e?i._getTableData(i._tasks,i.taskColumns,e):i._getTableData(i._resources,i.resourceColumns,e),n=i.groupByResources,s=(()=>{let e=[];e.push("itemId: string"),e.push("projectId: string"),e.push("itemIndex: number"),n&&e.push("resources: string");for(let i=0,r=t.length;i<r;i+=1){const r=t[i];e.push(`${r.dataField}: ${r.dataType}`)}return e})();return i.groupByResources?new window.Smart.DataAdapter({dataFields:s,dataSource:r,groupBy:["resources"],id:"itemId"}):new window.Smart.DataAdapter({dataFields:s,dataSource:r,keyDataField:"itemId",parentDataField:"projectId",id:"itemId"})}_refreshTableDataSource(e="task"){const t=this,i="task"===e?t.$.taskTable:t.$.resourceTable;t.contains(i)&&(i.resetState("expanded"),i.dataSource=t._getTableDataSource(e,t._getTableColumns(e)))}_refreshColumnsHeaders(e){const t=this;e||(e="task");const i=t.$[`${e}Table`].columns,r=t[`${e}Columns`];for(let e=0,n=i.length;e<n;e++)i[e].label=t.localize(r[e].label)||r[e].label;!arguments.length&&t.$.mainSplitter.contains(t.$.resourceSplitter)&&t._refreshColumnsHeaders("resource")}_getTaskResourceIds(e){const t=e.resources,i=this._resources.map((e=>e.id));let r=[];if(Array.isArray(t))for(let e=0,n=t.length;e<n;e+=1){const n=t[e].id||t[e];i.indexOf(n)>-1&&r.push(n)}return r.sort()}_getTableData(e,t,i){const r=this,n=r.groupByResources;i||(i="task");const s=t.map((e=>e.value));let a=[],o=[];for(let l=0,c=e.length;l<c;l+=1){const c=e[l];if(c.hidden||n&&c.disableResources)continue;const d={},m=c.$.project,u=r._getTaskResourceIds(c);for(let e=0,n=s.length;e<n;e+=1)d[s[e]]=r._formatColumnData(c,t[e],i);d.expanded=n||c.expanded,d.itemId=c.$.id||c.id||"",d.itemIndex=l,u&&u.length?d.resources=u.toString():delete d.resources,c.$&&m&&(m.$.id?d.projectId=c.$.project.$.id:o.push(((e,t)=>{e.projectId=t.$.id}).bind(null,c,m))),a.push(d)}for(let e=0,t=o.length;e<t;e+=1)o[e]();return a}_formatColumnData(e,t){const i=this,r=t.value;let n=e[r];if(r){const e=(r+"").toLowerCase();if(e.indexOf("date")>-1||t.dateFormat){const e=Date.parse(n);if(!isNaN(e)){let r=t.dateFormat;return"string"==typeof t.dateFormat?new Smart.Utilities.DateTime(new Date(e)).toString(t.dateFormat):(r="object"==typeof t.dateFormat?t.dateFormat:{year:"numeric",month:"2-digit",day:"numeric"},new Intl.DateTimeFormat(i.locale,r).format(new Date(e)))}}else if(e.indexOf("duration")>-1||t.numberFormat){const e=parseFloat(n.toFixed(1));return t.numberFormat?i._formatNumber(e,t.numberFormat):e}}return void 0!==n?n.toString():i.localize("unassigned")}_formatNumber(e,t,i){const r=this;if("object"==typeof t)return new Intl.NumberFormat(r.locale,t).format(""+e);i||(i={percentSymbol:"%",currencySymbol:"$",currencySymbolPosition:"before",decimalSeparator:".",thousandsSeparator:","});const n=e=>"number"==typeof e&&isFinite(e);if(""===t||null===t)return e;let s;n(e)||(e*=1),t.length>1&&(s=parseInt(t.slice(1),10));let a={},o=t.charAt(0).toUpperCase();switch(a.thousandsSeparator=i.thousandsSeparator,a.decimalSeparator=i.decimalSeparator,o){case"D":case"d":case"F":case"f":a.decimalPlaces=s;break;case"N":case"n":a.decimalPlaces=0;break;case"C":case"c":a.decimalPlaces=s,"before"===i.currencySymbolPosition?a.prefix=i.currencySymbol:a.suffix=i.currencySymbol;break;case"P":case"p":a.suffix=i.percentSymbol,a.decimalPlaces=s;break;default:throw"Bad number format specifier: "+o}if(n(e)){const t=e<0;let i=e+"";const r=a.decimalSeparator?a.decimalSeparator:".";let s;if(n(a.decimalPlaces)){var l=a.decimalPlaces,c=Math.pow(10,l);if(i=(e*c).toFixed(0)/c+"",s=i.lastIndexOf("."),l>0)for(s<0?(i+=r,s=i.length-1):"."!==r&&(i=i.replace(".",r));i.length-1-s<l;)i+="0"}else{let t=e+"";s=t.lastIndexOf("."),s>0&&void 0===l&&"."!==r&&(t=t.replace(".",r))}if(a.thousandsSeparator){const e=a.thousandsSeparator;s=i.lastIndexOf(r),s=s>-1?s:i.length;let n=i.substring(s),o=-1;for(var d=s;d>0;d--)o++,o%3==0&&d!==s&&(!t||d>1)&&(n=e+n),n=i.charAt(d-1)+n;i=n}return i=a.prefix?a.prefix+i:i,i=a.suffix?i+a.suffix:i,i}return e}_validateDate(e,t){return e[t]=this._dateValidator(void 0,e[t]),e[t]&&!isNaN(e[t].getTime())||(e[t]=void 0),e[t]}_validateTaskProperties(e,t){if(e.$={},e.tasks instanceof Array&&e.tasks.length>0?e.type="project":(!e.type||["project","task","milestone"].indexOf(e.type)<0)&&(e.type="task"),this._validateTaskDuration(e),void 0===e.hidden&&t&&(e.hidden=t.hidden),e.hidden=!!e.hidden,void 0===e.resources?e.resources=[]:e.resources=[e.resources].reduce(((e,t)=>e.concat(t)),[]),"project"===e.type?e.expanded=!!e.expanded:delete e.expanded,e.progress=Math.min(Math.max(0,parseFloat(e.progress)||0),100),this._validateTaskDates(e,t),!e.dateStart&&!e.dateEnd&&"project"===e.type&&!e.synchronized)return;const i=e.connections;if(i instanceof Array){for(let e=0;e<i.length;e++){const t=i[e],r=t.target="string"==typeof t.target?t.target:parseInt(t.target),n=t.type=parseInt(t.type);null==r||"number"==typeof r&&isNaN(r)||isNaN(n)?(i.splice(i.indexOf(t),1),e--):t.lag=parseInt(t.lag)||0}e.connections=e.connections.map((e=>Object.assign({},e)))}else e.connections=[];return e.class=e.class?e.class+"":"",e.class=void 0!==e.class&&null!==e.class?e.class:"",e}_validateTaskDuration(e){const t=this;let i=t._convertDuration(parseFloat(e.duration))||0,r=t._convertDuration(parseFloat(e.minDuration))||0,n=t._convertDuration(parseFloat(e.maxDuration))||0;r&&n&&(n=Math.max(r,n)),i&&(r?i=Math.max(r,i):n&&(i=Math.min(i,n))),e.duration=t._convertDuration(i,!0),e.minDuration=t._convertDuration(r,!0),e.maxDuration=t._convertDuration(n,!0)}_validateTaskDates(e,t){const i=this,r=i._convertDuration(e.minDuration),n=i._convertDuration(e.maxDuration);let s=i._convertDuration(e.duration);if(e.minDateStart=i._validateDate(e,"minDateStart"),e.maxDateStart=i._validateDate(e,"maxDateStart"),e.minDateStart&&e.maxDateStart&&(e.maxDateStart=new Date(Math.max(e.minDateStart.getTime(),e.maxDateStart.getTime()))),e.minDateEnd=i._validateDate(e,"minDateEnd"),e.maxDateEnd=i._validateDate(e,"maxDateEnd"),e.minDateEnd&&e.maxDateEnd&&(e.maxDateEnd=new Date(Math.max(e.minDateEnd.getTime(),e.maxDateEnd.getTime()))),e.dateStart=i._validateDate(e,"dateStart"),e.dateEnd=i._validateDate(e,"dateEnd"),e.dateStart||(e.minDateStart?e.dateStart=e.minDateStart:e.maxDateStart?e.dateStart=e.maxDateStart:e.dateStart=i.dateStart),e.dateEnd||(e.minDateEnd?e.dateEnd=e.minDateEnd:e.maxDateEnd&&(e.dateEnd=e.maxDateEnd)),e.minDateStart&&(e.dateStart=new Date(Math.max(e.minDateStart.getTime(),e.dateStart.getTime()))),e.maxDateStart&&(e.dateStart=new Date(Math.min(e.maxDateStart.getTime(),e.dateStart.getTime()))),e.minDateEnd&&(e.dateEnd=new Date(Math.max(e.minDateEnd.getTime(),e.dateEnd.getTime()))),e.maxDateEnd&&(e.dateEnd=new Date(Math.min(e.maxDateEnd.getTime(),e.dateEnd.getTime()))),e.dateStart&&(i.min&&(s=Math.min(e.dateStart.getTime()-i.min.getTime(),s),e.duration=i._convertDuration(s,!0)),i.max&&(s=Math.min(i.max.getTime()-e.dateStart.getTime(),s),e.duration=i._convertDuration(s,!0))),!e.dateStart&&s&&e.dateEnd&&(e.dateStart=new Date(e.dateEnd.getTime()-s)),"task"!==e.type||e.dateStart&&!isNaN(e.dateStart.getTime())||!t||(e.dateStart=new Date(t.dateStart)),r&&e.dateStart)if(i.adjustToNonworkingTime&&(i.nonworkingDays.length>0||i.nonworkingHours.length>0)){const t=i._getTaskWorkingDateEnd(e,r);e.dateEnd=new Date(Math.max(e.dateEnd?e.dateEnd.getTime():0,t.getTime()))}else e.dateEnd=new Date(Math.max(e.dateEnd?e.dateEnd.getTime():0,e.dateStart.getTime()+r));if(s&&e.dateStart&&(i.adjustToNonworkingTime&&(i.nonworkingDays.length>0||i.nonworkingHours.length>0)?e.dateEnd=i._getTaskWorkingDateEnd(e,s):e.dateEnd=new Date(e.dateStart.getTime()+s)),s||n){let t;t=i.adjustToNonworkingTime&&(i.nonworkingDays.length>0||i.nonworkingHours.length>0)?i._getTaskWorkingDateEnd(e,Math.max(s,n)):new Date(e.dateStart.getTime()+Math.max(s,n)),e.dateEnd.getTime()>t.getTime()&&(e.dateEnd=t)}"task"===e.type&&!e.dateEnd&&t&&(e.dateEnd=new Date(t.dateEnd)),e.dateStart=i._minMaxDateValidator(e.dateStart),e.dateEnd=i._minMaxDateValidator(e.dateEnd),"milestone"===e.type&&(e.dateStart=i._validateDate(e,"dateStart"),e.dateEnd=i._validateDate(e,"dateEnd"),e.dateStart=e.dateEnd=new Date(Math.max(e.dateStart?e.dateStart.getTime():0,e.dateEnd?e.dateEnd.getTime():0))),(e.dateStart||e.dateEnd||"project"!==e.type||e.synchronized)&&("milestone"!==e.type&&e.dateStart&&(e.dateEnd&&e.dateStart.getTime()>e.dateEnd.getTime()||!e.dateEnd)&&(e.dateEnd=new Date(e.dateStart.getTime()+36e5*("day"===i.view?1:24))),e.dateStart&&e.dateEnd&&(e.duration=i._convertDuration(i.nonworkingDays.length>0||i.nonworkingHours.length>0?i._getWorkingTime(e.dateStart,e.dateEnd):e.dateEnd.getTime()-e.dateStart.getTime(),!0)))}_synchronizeProjectDates(e,t){const i=this;if(e){void 0===t&&(t=i._getProjectTasks(e));for(let n=0,s=t.length;n<s;n+=1){const s=t[n];e.synchronized&&(s.dateStart&&(e.dateStart=r(s,"dateStart","min")),s.dateEnd&&(e.dateEnd=r(s,"dateEnd","max")),s.minDateStart&&(e.minDateStart=r(s,"minDateStart","max")),s.maxDateStart&&(e.maxDateStart=r(s,"maxDateStart","min")),s.minDateEnd&&(e.minDateEnd=r(s,"minDateEnd","max")),s.maxDateEnd&&(e.maxDateEnd=r(s,"maxDateEnd","min")),e.dateStart&&e.dateEnd&&(e.duration=i._convertDuration(i.nonworkingDays.length>0||i.nonworkingHours.length>0?i._getWorkingTime(e.dateStart,e.dateEnd):e.dateEnd.getTime()-e.dateStart.getTime(),!0)))}e.$&&i._synchronizeProjectDates(e.$.project,t)}function r(t,i,r){const n=e[i];let s=t[i];return void 0===n?new Date(s):s instanceof Date?new Date(Math[r](n.getTime(),s.getTime())):void 0}}_synchronizeProjectVisibility(e,t){const i=this;e&&e.hidden&&!t.hidden&&(e.hidden=t.hidden,e.$&&i._synchronizeProjectVisibility(e.$.project,e))}_mouseWheelHandler(e){const t=this,i=(t.shadowRoot||t).querySelector(".smart-task-popup-window");if(i&&i.modal&&i.opened)return void e.stopPropagation();if(t.disabled||!t.computedHorizontalScrollBarVisibility&&!t.computedVerticalScrollBarVisibility)return;if(e.shiftKey)return void t._handleHorizontalScroll(e);const r=t.$.resourceSplitterItem;t.$.mainSplitter.contains(r)&&r.contains(e.target)?t._handleVerticalScroll(e,!0):t.$.taskSplitterItem.contains(e.target)&&t._handleVerticalScroll(e)}_handleVerticalScroll(e,t){const i=this;let r,n,s,a;if(t){if(r=i.$.resourceVerticalScrollBar,r.classList.contains("smart-hidden")||r.disabled)return!0;n=r.value,s=r.max,a=i._resourceScrollView}else{if(!i.computedVerticalScrollBarVisibility||i.$.verticalScrollBar.disabled)return!0;n=i.scrollTop,s=i.scrollHeight,a=i}if(0===n&&e.deltaY<0||n===s&&e.deltaY>0)return void e.stopPropagation();const o=i.$[t?"resourceTable":"taskTable"];if(e.stopPropagation(),e.preventDefault(),n+=i._getScrollCoefficient(e,i.offsetHeight),a){const e=o.$.virtualizationContainer;e.scrollHeight!==a.scrollHeight&&(e.scrollHeight=a.scrollHeight),a.scrollTo(n,void 0)}o.scrollTop=n,i._hoveredItem&&i._handleTableItemHover()}_handleHorizontalScroll(e){const t=this;if(!t.computedHorizontalScrollBarVisibility)return!0;const i=t.scrollLeft;(0===i&&e.deltaX<0||i===t.scrollHeight&&e.deltaX>0)&&e.stopPropagation(),e.stopPropagation(),e.preventDefault(),t.scrollWidth>0&&t.scrollTo(void 0,t.scrollLeft+t._getScrollCoefficient(e,t.offsetWidth))}_handleHeaderTemplate(e="task"){const t=this;if(!("content"in document.createElement("template")))return void t.error(t.localize("htmlTemplateNotSuported",{elementType:t.nodeName.toLowerCase()}));const i=t.$[`${e}SplitterItemHeader`],r=t.$[`${e}SplitterItem`],n="task"===e?"headerTemplate":"resourcePanelHeaderTemplate";let s=t[n];if(r.removeAttribute("show-header"),i.innerHTML="",!s)return;if("function"==typeof s)return s(i,{}),void(i.innerHTML?r.setAttribute("show-header",""):r.removeAttribute("show-header"));if("string"==typeof s&&(s=document.getElementById(s)),null===s||!("content"in s))return void t.error(t.localize("invalidTemplate",{elementType:t.nodeName.toLowerCase(),property:n}));let a=document.importNode(s.content,!0);if(r.setAttribute("show-header",""),t.shadowRoot)return i.innerHTML="<slot></slot>",void t.appendChild(a);i.appendChild(a)}_handleCollapseExpandMethods(e,t){const i=this,r=i._tasks;if(null==e||!r||!r.length)return;const n=i._getValidItemAndIndex(e);if(!n||!n.item)return void i.error(i.localize("incorrectArgument",{elementType:i.nodeName.toLowerCase(),methodName:"collapse",argumentName:"task"}));let s=n.item;"project"!==s.type&&(s=s.$.project),s&&(s.hidden?s.expanded="expand"===t:i.$.taskTable["expand"===t?"expandRow":"collapseRow"](s.$.id))}_getValidItemAndIndex(e,t="task"){const i=this,r="task"===t?i._tasks:i._resources;let n;if(null==e||!r||!r.length)return{};if("string"==typeof e||"number"==typeof e){const t=e.toString();let i,s;for(let n=0,a=r.length;n<a;n+=1){const a=r[n];if(!i){const r=a.id;if(null!=r&&r.toString&&r.toString()===t){i=a,e=n;break}}a.$.id===t&&(s=a,e=n)}n=i||s}else"object"==typeof e&&(n=r[i._getItemIndex(e,t)],e=r.indexOf(n));return{item:n,index:e}}_horizontalScrollbarHandler(e){const t=this,i=t._getScrollLeft(e.detail.value);e.stopPropagation&&e.stopPropagation(),t.$.timelineHeader.scrollLeft=t.$.taskTimelineContainer.scrollLeft=i,t.$.mainSplitter.contains(t.$.resourceTimelineHeader)&&(t.$.resourceTimelineHeader.scrollLeft=t.$.resourceTimelineContent.scrollLeft=i),t._recycle(e),e.context.min!==e.context.value?e.context.max===e.context.value&&(t._handleInfiniteTimeline(),t.$.fireEvent("scrollRightReached")):t.$.fireEvent("scrollLeftReached")}_verticalScrollbarHandler(e){const t=this,i=e.target,r=Math.round(e.detail.value);e.stopPropagation&&e.stopPropagation(),i&&i===t.$.resourceVerticalScrollBar?t.$.resourceTable.scrollTop=t.$.resourceTimelineContent.scrollTop=r:(t.$.taskTimelineContainer.scrollTop=r,t.$.taskTable.scrollTop=r),t._recycle(e),e.context.max!==e.context.value?e.context.min===e.context.value&&t.$.fireEvent("scrollTopReached"):t.$.fireEvent("scrollBottomReached")}_handleInfiniteTimeline(){const e=this,t=e._timelineCells;if(!e.infiniteTimeline||!t||!t.length)return;const i=e.infiniteTimelineStep,r=t[t.length-1].date;switch(e.view){case"year":r.setMonth(r.getMonth()+i);break;case"month":r.setDate(r.getDate()+7*i);break;case"week":r.setDate(r.getDate()+i);break;case"day":r.setHours(r.getHours()+i)}e.set("dateEnd",r),e._createTimelineCells(),e._recycleTimelineTasks(!0),e.$.mainSplitter.contains(e.$.resourceSplitter)&&e._refreshResourceTimeline(),e._refresh()}_nonworkingDayValidator(e,t){return this._nonworkingDateTimeValidator(e,t)}_nonworkingTimeValidator(e,t){return this._nonworkingDateTimeValidator(e,t,!0)}_nonworkingDateTimeValidator(e,t,i){const r=this,[n,s,a]=i?[0,23,24]:[0,6,7];let o=[];function l(e){let t=Math.max(n,Math.min(s,parseInt(e[0]))),i=Math.max(n,Math.min(s,parseInt(e[1])));if(!isNaN(t)&&!isNaN(i)){for(;t!==i;)o.push(t),t=t===s?n:++t;o.push(t)}return o}for(let e=0;e<t.length;e++){const i=t[e];"number"!=typeof i||isNaN(i)?"string"==typeof i?o=l(i.split("-").map((e=>parseInt(e)))):Array.isArray(i)&&(o=l(i)):o.push(Math.max(n,Math.min(s,parseInt(i))))}return o.length===a&&(o.pop(),r.warn(r.localize("invalidNonworkingRange",{elementType:r.nodeName.toLowerCase(),property:i?"nonworkingHours":"nonworkingDays"}))),o}});